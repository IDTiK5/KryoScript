--[[
    AdvancedUILibrary v2.0
    Professional Roblox UI Framework
    
    Features:
    - Complete Theme System with Dark/Light/Custom themes
    - Full Configuration Save/Load System
    - All UI Elements with smooth animations
    - Cross-platform support (PC/Mobile/Tablet)
    - Performance optimized for low-end devices
    - Memory leak prevention with proper cleanup
    
    Author: Claude Opus
    License: MIT
]]

-- Services
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")

-- Player Reference
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

-- Device Detection
local IsMobile = UserInputService.TouchEnabled and not UserInputService.KeyboardEnabled
local IsTablet = UserInputService.TouchEnabled and UserInputService.KeyboardEnabled

-- Library Table
local AdvancedUILibrary = {}
AdvancedUILibrary.__index = AdvancedUILibrary

-- Version Info
AdvancedUILibrary.Version = "2.0.0"
AdvancedUILibrary.BuildDate = "2025"

--[[
    =====================================================
    UTILITY MODULE
    =====================================================
]]

local Utility = {}

-- Generate unique IDs
function Utility.GenerateUID()
    local template = "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx"
    return string.gsub(template, "[xy]", function(c)
        local v = (c == "x") and math.random(0, 0xf) or math.random(8, 0xb)
        return string.format("%x", v)
    end)
end

-- Deep copy tables
function Utility.DeepCopy(original)
    local copy = {}
    for k, v in pairs(original) do
        if type(v) == "table" then
            copy[k] = Utility.DeepCopy(v)
        else
            copy[k] = v
        end
    end
    return copy
end

-- Merge tables
function Utility.MergeTables(base, override)
    local result = Utility.DeepCopy(base)
    for k, v in pairs(override) do
        if type(v) == "table" and type(result[k]) == "table" then
            result[k] = Utility.MergeTables(result[k], v)
        else
            result[k] = v
        end
    end
    return result
end

-- Clamp value
function Utility.Clamp(value, min, max)
    return math.max(min, math.min(max, value))
end

-- Lerp
function Utility.Lerp(a, b, t)
    return a + (b - a) * t
end

-- Round to decimal places
function Utility.Round(value, decimals)
    local mult = 10 ^ (decimals or 0)
    return math.floor(value * mult + 0.5) / mult
end

-- Create instance with properties
function Utility.Create(className, properties)
    local instance = Instance.new(className)
    for property, value in pairs(properties or {}) do
        if property ~= "Parent" then
            if typeof(instance[property]) == "RBXScriptSignal" then
                instance[property]:Connect(value)
            else
                instance[property] = value
            end
        end
    end
    if properties and properties.Parent then
        instance.Parent = properties.Parent
    end
    return instance
end

-- Safe file operations
function Utility.SafeWriteFile(path, content)
    local success, err = pcall(function()
        writefile(path, content)
    end)
    return success, err
end

function Utility.SafeReadFile(path)
    local success, result = pcall(function()
        return readfile(path)
    end)
    if success then
        return result
    end
    return nil
end

function Utility.SafeMakeFolder(path)
    local success = pcall(function()
        if not isfolder(path) then
            makefolder(path)
        end
    end)
    return success
end

function Utility.SafeIsFolder(path)
    local success, result = pcall(function()
        return isfolder(path)
    end)
    if success then
        return result
    end
    return false
end

function Utility.SafeIsFile(path)
    local success, result = pcall(function()
        return isfile(path)
    end)
    if success then
        return result
    end
    return false
end

function Utility.SafeListFiles(path)
    local success, result = pcall(function()
        return listfiles(path)
    end)
    if success then
        return result
    end
    return {}
end

function Utility.SafeDeleteFile(path)
    local success = pcall(function()
        delfile(path)
    end)
    return success
end

--[[
    =====================================================
    ANIMATION SYSTEM
    =====================================================
]]

local AnimationManager = {}
AnimationManager.TweenCache = {}
AnimationManager.ActiveTweens = {}

-- Default tween info presets
AnimationManager.Presets = {
    Quick = TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
    Normal = TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
    Smooth = TweenInfo.new(0.35, Enum.EasingStyle.Quint, Enum.EasingDirection.Out),
    Bounce = TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out),
    Elastic = TweenInfo.new(0.5, Enum.EasingStyle.Elastic, Enum.EasingDirection.Out),
    Linear = TweenInfo.new(0.2, Enum.EasingStyle.Linear, Enum.EasingDirection.InOut),
    Fade = TweenInfo.new(0.3, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut),
    SlideIn = TweenInfo.new(0.4, Enum.EasingStyle.Quart, Enum.EasingDirection.Out),
    SlideOut = TweenInfo.new(0.3, Enum.EasingStyle.Quart, Enum.EasingDirection.In),
    Ripple = TweenInfo.new(0.6, Enum.EasingStyle.Sine, Enum.EasingDirection.Out),
}

-- Create and play tween with caching
function AnimationManager:Tween(instance, preset, properties, callback)
    if not instance or not instance.Parent then return end
    
    local tweenInfo = type(preset) == "string" and self.Presets[preset] or preset
    
    -- Cancel existing tween on this instance
    local instanceId = tostring(instance)
    if self.ActiveTweens[instanceId] then
        self.ActiveTweens[instanceId]:Cancel()
    end
    
    local tween = TweenService:Create(instance, tweenInfo, properties)
    self.ActiveTweens[instanceId] = tween
    
    if callback then
        tween.Completed:Connect(function()
            self.ActiveTweens[instanceId] = nil
            callback()
        end)
    else
        tween.Completed:Connect(function()
            self.ActiveTweens[instanceId] = nil
        end)
    end
    
    tween:Play()
    return tween
end

-- Cancel tween for instance
function AnimationManager:CancelTween(instance)
    local instanceId = tostring(instance)
    if self.ActiveTweens[instanceId] then
        self.ActiveTweens[instanceId]:Cancel()
        self.ActiveTweens[instanceId] = nil
    end
end

-- Cleanup all tweens
function AnimationManager:Cleanup()
    for id, tween in pairs(self.ActiveTweens) do
        tween:Cancel()
    end
    self.ActiveTweens = {}
end

-- Hover animation helper
function AnimationManager:ApplyHoverEffect(element, normalProps, hoverProps, preset)
    preset = preset or "Quick"
    
    local connections = {}
    
    connections[#connections + 1] = element.MouseEnter:Connect(function()
        self:Tween(element, preset, hoverProps)
    end)
    
    connections[#connections + 1] = element.MouseLeave:Connect(function()
        self:Tween(element, preset, normalProps)
    end)
    
    return connections
end

-- Click animation helper
function AnimationManager:ApplyClickEffect(element, clickProps, normalProps, preset)
    preset = preset or "Quick"
    
    local connections = {}
    
    connections[#connections + 1] = element.MouseButton1Down:Connect(function()
        self:Tween(element, preset, clickProps)
    end)
    
    connections[#connections + 1] = element.MouseButton1Up:Connect(function()
        self:Tween(element, preset, normalProps)
    end)
    
    return connections
end

--[[
    =====================================================
    THEME MANAGER
    =====================================================
]]

local ThemeManager = {}
ThemeManager.CurrentTheme = nil
ThemeManager.RegisteredElements = {}
ThemeManager.ThemeChangedCallbacks = {}

-- Default themes
ThemeManager.Themes = {
    Dark = {
        Name = "Dark",
        Background = Color3.fromRGB(20, 20, 25),
        SecondaryBackground = Color3.fromRGB(28, 28, 35),
        TertiaryBackground = Color3.fromRGB(35, 35, 45),
        Stroke = Color3.fromRGB(50, 50, 60),
        StrokeHighlight = Color3.fromRGB(70, 70, 85),
        Accent = Color3.fromRGB(0, 170, 255),
        AccentDark = Color3.fromRGB(0, 130, 200),
        AccentLight = Color3.fromRGB(50, 190, 255),
        Text = Color3.fromRGB(240, 240, 245),
        SubText = Color3.fromRGB(160, 160, 175),
        DimText = Color3.fromRGB(100, 100, 115),
        ElementBackground = Color3.fromRGB(38, 38, 48),
        ElementBackgroundHover = Color3.fromRGB(48, 48, 60),
        ElementBackgroundActive = Color3.fromRGB(55, 55, 70),
        Hover = Color3.fromRGB(45, 45, 55),
        Success = Color3.fromRGB(50, 205, 100),
        Warning = Color3.fromRGB(255, 190, 50),
        Error = Color3.fromRGB(255, 85, 85),
        Info = Color3.fromRGB(80, 170, 255),
        Shadow = Color3.fromRGB(0, 0, 0),
        Divider = Color3.fromRGB(55, 55, 65),
        ScrollBar = Color3.fromRGB(60, 60, 75),
        ScrollBarHover = Color3.fromRGB(80, 80, 95),
        TabInactive = Color3.fromRGB(30, 30, 38),
        TabActive = Color3.fromRGB(40, 40, 50),
        ToggleBackground = Color3.fromRGB(50, 50, 60),
        ToggleBackgroundEnabled = Color3.fromRGB(0, 170, 255),
        SliderBackground = Color3.fromRGB(45, 45, 55),
        SliderFill = Color3.fromRGB(0, 170, 255),
        DropdownBackground = Color3.fromRGB(32, 32, 42),
        InputBackground = Color3.fromRGB(25, 25, 32),
        InputBorder = Color3.fromRGB(55, 55, 70),
        InputBorderFocused = Color3.fromRGB(0, 170, 255),
        NotificationBackground = Color3.fromRGB(25, 25, 32),
    },
    
    Light = {
        Name = "Light",
        Background = Color3.fromRGB(245, 245, 250),
        SecondaryBackground = Color3.fromRGB(235, 235, 242),
        TertiaryBackground = Color3.fromRGB(225, 225, 235),
        Stroke = Color3.fromRGB(200, 200, 210),
        StrokeHighlight = Color3.fromRGB(180, 180, 195),
        Accent = Color3.fromRGB(0, 120, 215),
        AccentDark = Color3.fromRGB(0, 90, 170),
        AccentLight = Color3.fromRGB(50, 150, 230),
        Text = Color3.fromRGB(25, 25, 30),
        SubText = Color3.fromRGB(80, 80, 95),
        DimText = Color3.fromRGB(130, 130, 145),
        ElementBackground = Color3.fromRGB(255, 255, 255),
        ElementBackgroundHover = Color3.fromRGB(245, 245, 250),
        ElementBackgroundActive = Color3.fromRGB(235, 235, 242),
        Hover = Color3.fromRGB(240, 240, 248),
        Success = Color3.fromRGB(40, 180, 85),
        Warning = Color3.fromRGB(230, 165, 30),
        Error = Color3.fromRGB(220, 60, 60),
        Info = Color3.fromRGB(50, 140, 230),
        Shadow = Color3.fromRGB(180, 180, 195),
        Divider = Color3.fromRGB(210, 210, 220),
        ScrollBar = Color3.fromRGB(190, 190, 205),
        ScrollBarHover = Color3.fromRGB(170, 170, 185),
        TabInactive = Color3.fromRGB(240, 240, 248),
        TabActive = Color3.fromRGB(255, 255, 255),
        ToggleBackground = Color3.fromRGB(200, 200, 212),
        ToggleBackgroundEnabled = Color3.fromRGB(0, 120, 215),
        SliderBackground = Color3.fromRGB(210, 210, 222),
        SliderFill = Color3.fromRGB(0, 120, 215),
        DropdownBackground = Color3.fromRGB(255, 255, 255),
        InputBackground = Color3.fromRGB(255, 255, 255),
        InputBorder = Color3.fromRGB(200, 200, 212),
        InputBorderFocused = Color3.fromRGB(0, 120, 215),
        NotificationBackground = Color3.fromRGB(255, 255, 255),
    },
    
    Midnight = {
        Name = "Midnight",
        Background = Color3.fromRGB(12, 12, 18),
        SecondaryBackground = Color3.fromRGB(18, 18, 26),
        TertiaryBackground = Color3.fromRGB(24, 24, 34),
        Stroke = Color3.fromRGB(40, 40, 55),
        StrokeHighlight = Color3.fromRGB(55, 55, 75),
        Accent = Color3.fromRGB(130, 100, 255),
        AccentDark = Color3.fromRGB(100, 70, 220),
        AccentLight = Color3.fromRGB(160, 130, 255),
        Text = Color3.fromRGB(235, 235, 245),
        SubText = Color3.fromRGB(150, 150, 170),
        DimText = Color3.fromRGB(95, 95, 115),
        ElementBackground = Color3.fromRGB(28, 28, 40),
        ElementBackgroundHover = Color3.fromRGB(38, 38, 52),
        ElementBackgroundActive = Color3.fromRGB(45, 45, 62),
        Hover = Color3.fromRGB(35, 35, 48),
        Success = Color3.fromRGB(80, 200, 120),
        Warning = Color3.fromRGB(255, 180, 60),
        Error = Color3.fromRGB(255, 95, 95),
        Info = Color3.fromRGB(100, 160, 255),
        Shadow = Color3.fromRGB(0, 0, 0),
        Divider = Color3.fromRGB(45, 45, 60),
        ScrollBar = Color3.fromRGB(50, 50, 68),
        ScrollBarHover = Color3.fromRGB(70, 70, 90),
        TabInactive = Color3.fromRGB(20, 20, 30),
        TabActive = Color3.fromRGB(30, 30, 42),
        ToggleBackground = Color3.fromRGB(45, 45, 58),
        ToggleBackgroundEnabled = Color3.fromRGB(130, 100, 255),
        SliderBackground = Color3.fromRGB(38, 38, 52),
        SliderFill = Color3.fromRGB(130, 100, 255),
        DropdownBackground = Color3.fromRGB(22, 22, 32),
        InputBackground = Color3.fromRGB(16, 16, 24),
        InputBorder = Color3.fromRGB(45, 45, 60),
        InputBorderFocused = Color3.fromRGB(130, 100, 255),
        NotificationBackground = Color3.fromRGB(18, 18, 26),
    },
    
    Ocean = {
        Name = "Ocean",
        Background = Color3.fromRGB(15, 25, 35),
        SecondaryBackground = Color3.fromRGB(20, 32, 45),
        TertiaryBackground = Color3.fromRGB(28, 42, 58),
        Stroke = Color3.fromRGB(45, 65, 85),
        StrokeHighlight = Color3.fromRGB(60, 85, 110),
        Accent = Color3.fromRGB(0, 200, 180),
        AccentDark = Color3.fromRGB(0, 160, 145),
        AccentLight = Color3.fromRGB(50, 220, 200),
        Text = Color3.fromRGB(230, 240, 245),
        SubText = Color3.fromRGB(145, 170, 190),
        DimText = Color3.fromRGB(90, 115, 135),
        ElementBackground = Color3.fromRGB(25, 40, 55),
        ElementBackgroundHover = Color3.fromRGB(32, 50, 68),
        ElementBackgroundActive = Color3.fromRGB(40, 60, 80),
        Hover = Color3.fromRGB(30, 45, 62),
        Success = Color3.fromRGB(60, 210, 130),
        Warning = Color3.fromRGB(255, 190, 70),
        Error = Color3.fromRGB(255, 100, 100),
        Info = Color3.fromRGB(80, 180, 255),
        Shadow = Color3.fromRGB(5, 10, 15),
        Divider = Color3.fromRGB(50, 70, 90),
        ScrollBar = Color3.fromRGB(55, 78, 100),
        ScrollBarHover = Color3.fromRGB(75, 100, 125),
        TabInactive = Color3.fromRGB(18, 30, 42),
        TabActive = Color3.fromRGB(28, 45, 62),
        ToggleBackground = Color3.fromRGB(40, 58, 75),
        ToggleBackgroundEnabled = Color3.fromRGB(0, 200, 180),
        SliderBackground = Color3.fromRGB(35, 52, 70),
        SliderFill = Color3.fromRGB(0, 200, 180),
        DropdownBackground = Color3.fromRGB(22, 36, 50),
        InputBackground = Color3.fromRGB(18, 28, 40),
        InputBorder = Color3.fromRGB(50, 70, 90),
        InputBorderFocused = Color3.fromRGB(0, 200, 180),
        NotificationBackground = Color3.fromRGB(20, 32, 45),
    },
    
    Rose = {
        Name = "Rose",
        Background = Color3.fromRGB(28, 18, 22),
        SecondaryBackground = Color3.fromRGB(38, 25, 30),
        TertiaryBackground = Color3.fromRGB(48, 32, 40),
        Stroke = Color3.fromRGB(70, 50, 58),
        StrokeHighlight = Color3.fromRGB(95, 70, 80),
        Accent = Color3.fromRGB(255, 100, 130),
        AccentDark = Color3.fromRGB(220, 70, 100),
        AccentLight = Color3.fromRGB(255, 140, 165),
        Text = Color3.fromRGB(250, 240, 245),
        SubText = Color3.fromRGB(180, 160, 170),
        DimText = Color3.fromRGB(120, 100, 110),
        ElementBackground = Color3.fromRGB(42, 30, 36),
        ElementBackgroundHover = Color3.fromRGB(55, 40, 48),
        ElementBackgroundActive = Color3.fromRGB(65, 48, 58),
        Hover = Color3.fromRGB(50, 36, 44),
        Success = Color3.fromRGB(100, 210, 140),
        Warning = Color3.fromRGB(255, 200, 80),
        Error = Color3.fromRGB(255, 90, 90),
        Info = Color3.fromRGB(120, 180, 255),
        Shadow = Color3.fromRGB(10, 5, 8),
        Divider = Color3.fromRGB(60, 45, 52),
        ScrollBar = Color3.fromRGB(70, 55, 62),
        ScrollBarHover = Color3.fromRGB(90, 72, 82),
        TabInactive = Color3.fromRGB(32, 22, 28),
        TabActive = Color3.fromRGB(45, 32, 40),
        ToggleBackground = Color3.fromRGB(55, 42, 50),
        ToggleBackgroundEnabled = Color3.fromRGB(255, 100, 130),
        SliderBackground = Color3.fromRGB(50, 38, 45),
        SliderFill = Color3.fromRGB(255, 100, 130),
        DropdownBackground = Color3.fromRGB(35, 24, 30),
        InputBackground = Color3.fromRGB(25, 16, 20),
        InputBorder = Color3.fromRGB(60, 45, 52),
        InputBorderFocused = Color3.fromRGB(255, 100, 130),
        NotificationBackground = Color3.fromRGB(35, 24, 30),
    },
}

-- Initialize with default theme
function ThemeManager:Initialize(themeName)
    themeName = themeName or "Dark"
    if type(themeName) == "table" then
        self.CurrentTheme = Utility.MergeTables(self.Themes.Dark, themeName)
    elseif self.Themes[themeName] then
        self.CurrentTheme = Utility.DeepCopy(self.Themes[themeName])
    else
        self.CurrentTheme = Utility.DeepCopy(self.Themes.Dark)
    end
end

-- Get current theme
function ThemeManager:GetTheme()
    return self.CurrentTheme
end

-- Get theme property
function ThemeManager:Get(property)
    if self.CurrentTheme and self.CurrentTheme[property] then
        return self.CurrentTheme[property]
    end
    return self.Themes.Dark[property]
end

-- Set theme
function ThemeManager:SetTheme(theme)
    if type(theme) == "string" then
        if self.Themes[theme] then
            self.CurrentTheme = Utility.DeepCopy(self.Themes[theme])
        else
            warn("AdvancedUILibrary: Unknown theme '" .. theme .. "'")
            return false
        end
    elseif type(theme) == "table" then
        self.CurrentTheme = Utility.MergeTables(self.Themes.Dark, theme)
    else
        return false
    end
    
    self:UpdateAllElements()
    self:FireThemeChanged()
    return true
end

-- Set accent color
function ThemeManager:SetAccentColor(color)
    if typeof(color) == "Color3" then
        self.CurrentTheme.Accent = color
        -- Generate accent variants
        local h, s, v = color:ToHSV()
        self.CurrentTheme.AccentDark = Color3.fromHSV(h, s, math.max(0, v - 0.15))
        self.CurrentTheme.AccentLight = Color3.fromHSV(h, math.max(0, s - 0.1), math.min(1, v + 0.1))
        self.CurrentTheme.ToggleBackgroundEnabled = color
        self.CurrentTheme.SliderFill = color
        self.CurrentTheme.InputBorderFocused = color
        
        self:UpdateAllElements()
        self:FireThemeChanged()
        return true
    end
    return false
end

-- Register element for theme updates
function ThemeManager:RegisterElement(element, updateCallback)
    local id = Utility.GenerateUID()
    self.RegisteredElements[id] = {
        Element = element,
        Callback = updateCallback
    }
    
    -- Return unregister function
    return function()
        self.RegisteredElements[id] = nil
    end
end

-- Update all registered elements
function ThemeManager:UpdateAllElements()
    for id, data in pairs(self.RegisteredElements) do
        if data.Element and data.Element.Parent then
            local success, err = pcall(data.Callback, self.CurrentTheme)
            if not success then
                warn("AdvancedUILibrary: Theme update failed for element - " .. tostring(err))
            end
        else
            self.RegisteredElements[id] = nil
        end
    end
end

-- Register theme changed callback
function ThemeManager:OnThemeChanged(callback)
    local id = Utility.GenerateUID()
    self.ThemeChangedCallbacks[id] = callback
    
    return function()
        self.ThemeChangedCallbacks[id] = nil
    end
end

-- Fire theme changed event
function ThemeManager:FireThemeChanged()
    for id, callback in pairs(self.ThemeChangedCallbacks) do
        local success, err = pcall(callback, self.CurrentTheme)
        if not success then
            warn("AdvancedUILibrary: Theme changed callback failed - " .. tostring(err))
        end
    end
end

-- Add custom theme
function ThemeManager:AddTheme(name, themeData)
    if type(name) == "string" and type(themeData) == "table" then
        self.Themes[name] = Utility.MergeTables(self.Themes.Dark, themeData)
        self.Themes[name].Name = name
        return true
    end
    return false
end

-- Get all theme names
function ThemeManager:GetThemeNames()
    local names = {}
    for name, _ in pairs(self.Themes) do
        table.insert(names, name)
    end
    return names
end

--[[
    =====================================================
    CONFIGURATION MANAGER
    =====================================================
]]

local ConfigManager = {}
ConfigManager.ConfigFolder = "AdvancedUILibrary"
ConfigManager.CurrentConfig = nil
ConfigManager.AutoSave = false
ConfigManager.AutoSaveInterval = 30
ConfigManager.Elements = {}
ConfigManager.LastAutoSave = 0

-- Initialize config system
function ConfigManager:Initialize(folder, autoSave)
    self.ConfigFolder = folder or "AdvancedUILibrary"
    self.AutoSave = autoSave or false
    
    -- Create config folder
    Utility.SafeMakeFolder(self.ConfigFolder)
    
    -- Start auto-save if enabled
    if self.AutoSave then
        self:StartAutoSave()
    end
end

-- Register element for config
function ConfigManager:RegisterElement(id, element, getValueFunc, setValueFunc)
    self.Elements[id] = {
        Element = element,
        GetValue = getValueFunc,
        SetValue = setValueFunc
    }
end

-- Unregister element
function ConfigManager:UnregisterElement(id)
    self.Elements[id] = nil
end

-- Get current config data
function ConfigManager:GetConfigData()
    local data = {
        Theme = ThemeManager.CurrentTheme and ThemeManager.CurrentTheme.Name or "Dark",
        Elements = {}
    }
    
    for id, elementData in pairs(self.Elements) do
        if elementData.GetValue then
            local success, value = pcall(elementData.GetValue)
            if success then
                data.Elements[id] = value
            end
        end
    end
    
    return data
end

-- Apply config data
function ConfigManager:ApplyConfigData(data)
    if not data then return false end
    
    -- Apply theme
    if data.Theme then
        ThemeManager:SetTheme(data.Theme)
    end
    
    -- Apply element values
    if data.Elements then
        for id, value in pairs(data.Elements) do
            if self.Elements[id] and self.Elements[id].SetValue then
                local success, err = pcall(self.Elements[id].SetValue, value)
                if not success then
                    warn("AdvancedUILibrary: Failed to apply config value for '" .. id .. "' - " .. tostring(err))
                end
            end
        end
    end
    
    return true
end

-- Save config to file
function ConfigManager:SaveConfig(name)
    name = name or "default"
    local path = self.ConfigFolder .. "/" .. name .. ".json"
    
    local data = self:GetConfigData()
    local success, encoded = pcall(function()
        return HttpService:JSONEncode(data)
    end)
    
    if not success then
        warn("AdvancedUILibrary: Failed to encode config data")
        return false
    end
    
    local writeSuccess, err = Utility.SafeWriteFile(path, encoded)
    if not writeSuccess then
        warn("AdvancedUILibrary: Failed to save config - " .. tostring(err))
        return false
    end
    
    self.CurrentConfig = name
    return true
end

-- Load config from file
function ConfigManager:LoadConfig(name)
    name = name or "default"
    local path = self.ConfigFolder .. "/" .. name .. ".json"
    
    if not Utility.SafeIsFile(path) then
        warn("AdvancedUILibrary: Config file not found - " .. name)
        return false
    end
    
    local content = Utility.SafeReadFile(path)
    if not content then
        warn("AdvancedUILibrary: Failed to read config file")
        return false
    end
    
    local success, data = pcall(function()
        return HttpService:JSONDecode(content)
    end)
    
    if not success then
        warn("AdvancedUILibrary: Failed to decode config data")
        return false
    end
    
    self:ApplyConfigData(data)
    self.CurrentConfig = name
    return true
end

-- Get all configs
function ConfigManager:GetConfigs()
    local configs = {}
    local files = Utility.SafeListFiles(self.ConfigFolder)
    
    for _, file in ipairs(files) do
        local name = file:match("([^/\\]+)%.json$")
        if name then
            table.insert(configs, name)
        end
    end
    
    return configs
end

-- Delete config
function ConfigManager:DeleteConfig(name)
    local path = self.ConfigFolder .. "/" .. name .. ".json"
    return Utility.SafeDeleteFile(path)
end

-- Start auto-save
function ConfigManager:StartAutoSave()
    if self._autoSaveConnection then
        self._autoSaveConnection:Disconnect()
    end
    
    self._autoSaveConnection = RunService.Heartbeat:Connect(function()
        local now = tick()
        if now - self.LastAutoSave >= self.AutoSaveInterval then
            if self.CurrentConfig then
                self:SaveConfig(self.CurrentConfig)
            end
            self.LastAutoSave = now
        end
    end)
end

-- Stop auto-save
function ConfigManager:StopAutoSave()
    if self._autoSaveConnection then
        self._autoSaveConnection:Disconnect()
        self._autoSaveConnection = nil
    end
end

-- Cleanup
function ConfigManager:Cleanup()
    self:StopAutoSave()
    self.Elements = {}
end

--[[
    =====================================================
    NOTIFICATION SYSTEM
    =====================================================
]]

local NotificationManager = {}
NotificationManager.Notifications = {}
NotificationManager.Container = nil
NotificationManager.MaxNotifications = 5

-- Initialize notification container
function NotificationManager:Initialize(parent)
    if self.Container then
        self.Container:Destroy()
    end
    
    self.Container = Utility.Create("Frame", {
        Name = "NotificationContainer",
        Parent = parent,
        BackgroundTransparency = 1,
        AnchorPoint = Vector2.new(1, 1),
        Position = UDim2.new(1, -20, 1, -20),
        Size = UDim2.new(0, 320, 0, 400),
        ClipsDescendants = false,
    })
    
    Utility.Create("UIListLayout", {
        Parent = self.Container,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 10),
        VerticalAlignment = Enum.VerticalAlignment.Bottom,
        HorizontalAlignment = Enum.HorizontalAlignment.Right,
    })
end

-- Create notification
function NotificationManager:Notify(options)
    options = options or {}
    local title = options.Title or "Notification"
    local message = options.Message or ""
    local duration = options.Duration or 5
    local type = options.Type or "Info" -- Info, Success, Warning, Error
    local callback = options.Callback
    
    local theme = ThemeManager:GetTheme()
    
    -- Get type color
    local typeColors = {
        Info = theme.Info,
        Success = theme.Success,
        Warning = theme.Warning,
        Error = theme.Error,
    }
    local accentColor = typeColors[type] or theme.Accent
    
    -- Get type icon
    local typeIcons = {
        Info = "ℹ",
        Success = "✓",
        Warning = "⚠",
        Error = "✕",
    }
    local icon = typeIcons[type] or "ℹ"
    
    -- Create notification frame
    local notificationFrame = Utility.Create("Frame", {
        Name = "Notification",
        Parent = self.Container,
        BackgroundColor3 = theme.NotificationBackground,
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        ClipsDescendants = true,
        LayoutOrder = tick(),
    })
    
    Utility.Create("UICorner", {
        Parent = notificationFrame,
        CornerRadius = UDim.new(0, 10),
    })
    
    Utility.Create("UIStroke", {
        Parent = notificationFrame,
        Color = theme.Stroke,
        Thickness = 1,
        Transparency = 0.5,
    })
    
    -- Accent bar
    local accentBar = Utility.Create("Frame", {
        Parent = notificationFrame,
        BackgroundColor3 = accentColor,
        Size = UDim2.new(0, 4, 1, 0),
        Position = UDim2.new(0, 0, 0, 0),
        BorderSizePixel = 0,
    })
    
    Utility.Create("UICorner", {
        Parent = accentBar,
        CornerRadius = UDim.new(0, 2),
    })
    
    -- Content container
    local contentFrame = Utility.Create("Frame", {
        Parent = notificationFrame,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, -16, 0, 0),
        Position = UDim2.new(0, 12, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
    })
    
    Utility.Create("UIPadding", {
        Parent = contentFrame,
        PaddingTop = UDim.new(0, 12),
        PaddingBottom = UDim.new(0, 12),
        PaddingLeft = UDim.new(0, 4),
        PaddingRight = UDim.new(0, 4),
    })
    
    Utility.Create("UIListLayout", {
        Parent = contentFrame,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 4),
    })
    
    -- Title row
    local titleRow = Utility.Create("Frame", {
        Parent = contentFrame,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 22),
        LayoutOrder = 1,
    })
    
    -- Icon
    Utility.Create("TextLabel", {
        Parent = titleRow,
        BackgroundTransparency = 1,
        Size = UDim2.new(0, 22, 0, 22),
        Text = icon,
        TextColor3 = accentColor,
        TextSize = 16,
        Font = Enum.Font.GothamBold,
    })
    
    -- Title text
    Utility.Create("TextLabel", {
        Parent = titleRow,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 28, 0, 0),
        Size = UDim2.new(1, -55, 1, 0),
        Text = title,
        TextColor3 = theme.Text,
        TextSize = 14,
        Font = Enum.Font.GothamBold,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextTruncate = Enum.TextTruncate.AtEnd,
    })
    
    -- Close button
    local closeButton = Utility.Create("TextButton", {
        Parent = titleRow,
        BackgroundTransparency = 1,
        AnchorPoint = Vector2.new(1, 0),
        Position = UDim2.new(1, 0, 0, 0),
        Size = UDim2.new(0, 22, 0, 22),
        Text = "×",
        TextColor3 = theme.SubText,
        TextSize = 18,
        Font = Enum.Font.GothamBold,
    })
    
    -- Message
    if message ~= "" then
        Utility.Create("TextLabel", {
            Parent = contentFrame,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 0, 0),
            AutomaticSize = Enum.AutomaticSize.Y,
            Text = message,
            TextColor3 = theme.SubText,
            TextSize = 12,
            Font = Enum.Font.Gotham,
            TextXAlignment = Enum.TextXAlignment.Left,
            TextWrapped = true,
            LayoutOrder = 2,
        })
    end
    
    -- Progress bar
    local progressContainer = Utility.Create("Frame", {
        Parent = contentFrame,
        BackgroundColor3 = theme.SliderBackground,
        Size = UDim2.new(1, 0, 0, 3),
        LayoutOrder = 3,
    })
    
    Utility.Create("UICorner", {
        Parent = progressContainer,
        CornerRadius = UDim.new(0, 2),
    })
    
    local progressFill = Utility.Create("Frame", {
        Parent = progressContainer,
        BackgroundColor3 = accentColor,
        Size = UDim2.new(1, 0, 1, 0),
    })
    
    Utility.Create("UICorner", {
        Parent = progressFill,
        CornerRadius = UDim.new(0, 2),
    })
    
    -- Store notification data
    local notificationData = {
        Frame = notificationFrame,
        CreatedAt = tick(),
        Duration = duration,
    }
    
    table.insert(self.Notifications, notificationData)
    
    -- Limit notifications
    while #self.Notifications > self.MaxNotifications do
        local oldest = table.remove(self.Notifications, 1)
        if oldest.Frame and oldest.Frame.Parent then
            oldest.Frame:Destroy()
        end
    end
    
    -- Animate in
    notificationFrame.Position = UDim2.new(1, 50, 0, 0)
    notificationFrame.BackgroundTransparency = 1
    
    AnimationManager:Tween(notificationFrame, "SlideIn", {
        Position = UDim2.new(0, 0, 0, 0),
        BackgroundTransparency = 0,
    })
    
    -- Progress animation
    AnimationManager:Tween(progressFill, TweenInfo.new(duration, Enum.EasingStyle.Linear), {
        Size = UDim2.new(0, 0, 1, 0),
    })
    
    -- Close function
    local function closeNotification()
        if notificationFrame.Parent then
            AnimationManager:Tween(notificationFrame, "SlideOut", {
                Position = UDim2.new(1, 50, 0, 0),
                BackgroundTransparency = 1,
            }, function()
                notificationFrame:Destroy()
                for i, data in ipairs(self.Notifications) do
                    if data.Frame == notificationFrame then
                        table.remove(self.Notifications, i)
                        break
                    end
                end
            end)
        end
    end
    
    -- Close button click
    closeButton.MouseButton1Click:Connect(closeNotification)
    
    -- Auto close
    task.delay(duration, closeNotification)
    
    -- Callback
    if callback then
        notificationFrame.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                callback()
            end
        end)
    end
    
    -- Register for theme updates
    ThemeManager:RegisterElement(notificationFrame, function(newTheme)
        notificationFrame.BackgroundColor3 = newTheme.NotificationBackground
    end)
    
    return notificationData
end

-- Clear all notifications
function NotificationManager:ClearAll()
    for _, data in ipairs(self.Notifications) do
        if data.Frame and data.Frame.Parent then
            data.Frame:Destroy()
        end
    end
    self.Notifications = {}
end

--[[
    =====================================================
    UI ELEMENT CLASSES
    =====================================================
]]

--[[
    BUTTON ELEMENT
]]
local ButtonElement = {}
ButtonElement.__index = ButtonElement

function ButtonElement.new(parent, options)
    local self = setmetatable({}, ButtonElement)
    
    self.Options = options or {}
    self.Name = options.Name or "Button"
    self.Callback = options.Callback or function() end
    self.Connections = {}
    
    local theme = ThemeManager:GetTheme()
    
    -- Main frame
    self.Frame = Utility.Create("Frame", {
        Parent = parent,
        BackgroundColor3 = theme.ElementBackground,
        Size = UDim2.new(1, 0, 0, 36),
        ClipsDescendants = true,
    })
    
    Utility.Create("UICorner", {
        Parent = self.Frame,
        CornerRadius = UDim.new(0, 8),
    })
    
    -- Button
    self.Button = Utility.Create("TextButton", {
        Parent = self.Frame,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        Text = "",
        AutoButtonColor = false,
    })
    
    -- Ripple container
    self.RippleContainer = Utility.Create("Frame", {
        Parent = self.Frame,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        ClipsDescendants = true,
        ZIndex = 0,
    })
    
    Utility.Create("UICorner", {
        Parent = self.RippleContainer,
        CornerRadius = UDim.new(0, 8),
    })
    
    -- Button label
    self.Label = Utility.Create("TextLabel", {
        Parent = self.Frame,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, -20, 1, 0),
        Position = UDim2.new(0, 10, 0, 0),
        Text = self.Name,
        TextColor3 = theme.Text,
        TextSize = 13,
        Font = Enum.Font.GothamMedium,
        TextXAlignment = Enum.TextXAlignment.Center,
    })
    
    -- Hover effect
    self.Connections[#self.Connections + 1] = self.Button.MouseEnter:Connect(function()
        AnimationManager:Tween(self.Frame, "Quick", {
            BackgroundColor3 = theme.ElementBackgroundHover,
        })
    end)
    
    self.Connections[#self.Connections + 1] = self.Button.MouseLeave:Connect(function()
        AnimationManager:Tween(self.Frame, "Quick", {
            BackgroundColor3 = theme.ElementBackground,
        })
    end)
    
    -- Click effect with ripple
    self.Connections[#self.Connections + 1] = self.Button.MouseButton1Click:Connect(function()
        self:CreateRipple()
        AnimationManager:Tween(self.Frame, "Quick", {
            BackgroundColor3 = theme.ElementBackgroundActive,
        }, function()
            AnimationManager:Tween(self.Frame, "Quick", {
                BackgroundColor3 = theme.ElementBackground,
            })
        end)
        
        task.spawn(function()
            self.Callback()
        end)
    end)
    
    -- Register for theme updates
    self.ThemeUnregister = ThemeManager:RegisterElement(self.Frame, function(newTheme)
        self.Frame.BackgroundColor3 = newTheme.ElementBackground
        self.Label.TextColor3 = newTheme.Text
    end)
    
    return self
end

function ButtonElement:CreateRipple()
    local theme = ThemeManager:GetTheme()
    local mouse = UserInputService:GetMouseLocation()
    local framePos = self.Frame.AbsolutePosition
    local relativePos = mouse - framePos
    
    local ripple = Utility.Create("Frame", {
        Parent = self.RippleContainer,
        BackgroundColor3 = theme.Accent,
        BackgroundTransparency = 0.7,
        AnchorPoint = Vector2.new(0.5, 0.5),
        Position = UDim2.new(0, relativePos.X, 0, relativePos.Y),
        Size = UDim2.new(0, 0, 0, 0),
    })
    
    Utility.Create("UICorner", {
        Parent = ripple,
        CornerRadius = UDim.new(1, 0),
    })
    
    local maxSize = math.max(self.Frame.AbsoluteSize.X, self.Frame.AbsoluteSize.Y) * 2
    
    AnimationManager:Tween(ripple, "Ripple", {
        Size = UDim2.new(0, maxSize, 0, maxSize),
        BackgroundTransparency = 1,
    }, function()
        ripple:Destroy()
    end)
end

function ButtonElement:SetText(text)
    self.Name = text
    self.Label.Text = text
end

function ButtonElement:Destroy()
    if self.ThemeUnregister then
        self.ThemeUnregister()
    end
    for _, connection in ipairs(self.Connections) do
        connection:Disconnect()
    end
    self.Frame:Destroy()
end

--[[
    TOGGLE ELEMENT
]]
local ToggleElement = {}
ToggleElement.__index = ToggleElement

function ToggleElement.new(parent, options)
    local self = setmetatable({}, ToggleElement)
    
    self.Options = options or {}
    self.Name = options.Name or "Toggle"
    self.Default = options.Default or false
    self.Callback = options.Callback or function() end
    self.State = self.Default
    self.Connections = {}
    self.ConfigId = options.ConfigId
    
    local theme = ThemeManager:GetTheme()
    
    -- Main frame
    self.Frame = Utility.Create("Frame", {
        Parent = parent,
        BackgroundColor3 = theme.ElementBackground,
        Size = UDim2.new(1, 0, 0, 40),
    })
    
    Utility.Create("UICorner", {
        Parent = self.Frame,
        CornerRadius = UDim.new(0, 8),
    })
    
    -- Button overlay
    self.Button = Utility.Create("TextButton", {
        Parent = self.Frame,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        Text = "",
        AutoButtonColor = false,
    })
    
    -- Label
    self.Label = Utility.Create("TextLabel", {
        Parent = self.Frame,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, -70, 1, 0),
        Position = UDim2.new(0, 12, 0, 0),
        Text = self.Name,
        TextColor3 = theme.Text,
        TextSize = 13,
        Font = Enum.Font.GothamMedium,
        TextXAlignment = Enum.TextXAlignment.Left,
    })
    
    -- Toggle container
    self.ToggleContainer = Utility.Create("Frame", {
        Parent = self.Frame,
        BackgroundColor3 = self.State and theme.ToggleBackgroundEnabled or theme.ToggleBackground,
        AnchorPoint = Vector2.new(1, 0.5),
        Position = UDim2.new(1, -12, 0.5, 0),
        Size = UDim2.new(0, 44, 0, 24),
    })
    
    Utility.Create("UICorner", {
        Parent = self.ToggleContainer,
        CornerRadius = UDim.new(1, 0),
    })
    
    -- Toggle knob
    self.Knob = Utility.Create("Frame", {
        Parent = self.ToggleContainer,
        BackgroundColor3 = Color3.fromRGB(255, 255, 255),
        AnchorPoint = Vector2.new(0, 0.5),
        Position = self.State and UDim2.new(1, -22, 0.5, 0) or UDim2.new(0, 2, 0.5, 0),
        Size = UDim2.new(0, 20, 0, 20),
    })
    
    Utility.Create("UICorner", {
        Parent = self.Knob,
        CornerRadius = UDim.new(1, 0),
    })
    
    -- Knob shadow
    Utility.Create("ImageLabel", {
        Parent = self.Knob,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 8, 1, 8),
        Position = UDim2.new(0.5, 0, 0.5, 2),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Image = "rbxassetid://5554236805",
        ImageColor3 = Color3.fromRGB(0, 0, 0),
        ImageTransparency = 0.6,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(23, 23, 277, 277),
    })
    
    -- Hover effect
    self.Connections[#self.Connections + 1] = self.Button.MouseEnter:Connect(function()
        AnimationManager:Tween(self.Frame, "Quick", {
            BackgroundColor3 = theme.ElementBackgroundHover,
        })
    end)
    
    self.Connections[#self.Connections + 1] = self.Button.MouseLeave:Connect(function()
        AnimationManager:Tween(self.Frame, "Quick", {
            BackgroundColor3 = theme.ElementBackground,
        })
    end)
    
    -- Click handler
    self.Connections[#self.Connections + 1] = self.Button.MouseButton1Click:Connect(function()
        self:Toggle()
    end)
    
    -- Register for config
    if self.ConfigId then
        ConfigManager:RegisterElement(self.ConfigId, self, function()
            return self.State
        end, function(value)
            self:Set(value)
        end)
    end
    
    -- Register for theme updates
    self.ThemeUnregister = ThemeManager:RegisterElement(self.Frame, function(newTheme)
        self.Frame.BackgroundColor3 = newTheme.ElementBackground
        self.Label.TextColor3 = newTheme.Text
        self.ToggleContainer.BackgroundColor3 = self.State and newTheme.ToggleBackgroundEnabled or newTheme.ToggleBackground
    end)
    
    return self
end

function ToggleElement:Toggle()
    self:Set(not self.State)
end

function ToggleElement:Set(state)
    self.State = state
    local theme = ThemeManager:GetTheme()
    
    AnimationManager:Tween(self.ToggleContainer, "Smooth", {
        BackgroundColor3 = self.State and theme.ToggleBackgroundEnabled or theme.ToggleBackground,
    })
    
    AnimationManager:Tween(self.Knob, "Bounce", {
        Position = self.State and UDim2.new(1, -22, 0.5, 0) or UDim2.new(0, 2, 0.5, 0),
    })
    
    task.spawn(function()
        self.Callback(self.State)
    end)
end

function ToggleElement:GetState()
    return self.State
end

function ToggleElement:Destroy()
    if self.ThemeUnregister then
        self.ThemeUnregister()
    end
    if self.ConfigId then
        ConfigManager:UnregisterElement(self.ConfigId)
    end
    for _, connection in ipairs(self.Connections) do
        connection:Disconnect()
    end
    self.Frame:Destroy()
end

--[[
    SLIDER ELEMENT
]]
local SliderElement = {}
SliderElement.__index = SliderElement

function SliderElement.new(parent, options)
    local self = setmetatable({}, SliderElement)
    
    self.Options = options or {}
    self.Name = options.Name or "Slider"
    self.Min = options.Min or 0
    self.Max = options.Max or 100
    self.Default = options.Default or self.Min
    self.Increment = options.Increment or 1
    self.Suffix = options.Suffix or ""
    self.Callback = options.Callback or function() end
    self.Value = self.Default
    self.Connections = {}
    self.Dragging = false
    self.ConfigId = options.ConfigId
    
    local theme = ThemeManager:GetTheme()
    
    -- Main frame
    self.Frame = Utility.Create("Frame", {
        Parent = parent,
        BackgroundColor3 = theme.ElementBackground,
        Size = UDim2.new(1, 0, 0, 50),
    })
    
    Utility.Create("UICorner", {
        Parent = self.Frame,
        CornerRadius = UDim.new(0, 8),
    })
    
    -- Header container
    local headerContainer = Utility.Create("Frame", {
        Parent = self.Frame,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, -24, 0, 20),
        Position = UDim2.new(0, 12, 0, 8),
    })
    
    -- Label
    self.Label = Utility.Create("TextLabel", {
        Parent = headerContainer,
        BackgroundTransparency = 1,
        Size = UDim2.new(0.7, 0, 1, 0),
        Text = self.Name,
        TextColor3 = theme.Text,
        TextSize = 13,
        Font = Enum.Font.GothamMedium,
        TextXAlignment = Enum.TextXAlignment.Left,
    })
    
    -- Value label
    self.ValueLabel = Utility.Create("TextLabel", {
        Parent = headerContainer,
        BackgroundTransparency = 1,
        Size = UDim2.new(0.3, 0, 1, 0),
        Position = UDim2.new(0.7, 0, 0, 0),
        Text = tostring(self.Value) .. self.Suffix,
        TextColor3 = theme.SubText,
        TextSize = 12,
        Font = Enum.Font.Gotham,
        TextXAlignment = Enum.TextXAlignment.Right,
    })
    
    -- Slider container
    self.SliderContainer = Utility.Create("Frame", {
        Parent = self.Frame,
        BackgroundColor3 = theme.SliderBackground,
        Size = UDim2.new(1, -24, 0, 6),
        Position = UDim2.new(0, 12, 0, 34),
    })
    
    Utility.Create("UICorner", {
        Parent = self.SliderContainer,
        CornerRadius = UDim.new(1, 0),
    })
    
    -- Slider fill
    local fillPercent = (self.Value - self.Min) / (self.Max - self.Min)
    self.SliderFill = Utility.Create("Frame", {
        Parent = self.SliderContainer,
        BackgroundColor3 = theme.SliderFill,
        Size = UDim2.new(fillPercent, 0, 1, 0),
    })
    
    Utility.Create("UICorner", {
        Parent = self.SliderFill,
        CornerRadius = UDim.new(1, 0),
    })
    
    -- Slider knob
    self.SliderKnob = Utility.Create("Frame", {
        Parent = self.SliderContainer,
        BackgroundColor3 = Color3.fromRGB(255, 255, 255),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Position = UDim2.new(fillPercent, 0, 0.5, 0),
        Size = UDim2.new(0, 14, 0, 14),
        ZIndex = 2,
    })
    
    Utility.Create("UICorner", {
        Parent = self.SliderKnob,
        CornerRadius = UDim.new(1, 0),
    })
    
    Utility.Create("UIStroke", {
        Parent = self.SliderKnob,
        Color = theme.Accent,
        Thickness = 2,
    })
    
    -- Invisible button for input
    self.InputButton = Utility.Create("TextButton", {
        Parent = self.Frame,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 20),
        Position = UDim2.new(0, 0, 0, 28),
        Text = "",
        AutoButtonColor = false,
    })
    
    -- Input handlers
    self.Connections[#self.Connections + 1] = self.InputButton.MouseButton1Down:Connect(function()
        self.Dragging = true
        self:UpdateSlider()
    end)
    
    self.Connections[#self.Connections + 1] = UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            self.Dragging = false
        end
    end)
    
    self.Connections[#self.Connections + 1] = UserInputService.InputChanged:Connect(function(input)
        if self.Dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            self:UpdateSlider()
        end
    end)
    
    -- Hover effect
    self.Connections[#self.Connections + 1] = self.Frame.MouseEnter:Connect(function()
        AnimationManager:Tween(self.Frame, "Quick", {
            BackgroundColor3 = theme.ElementBackgroundHover,
        })
    end)
    
    self.Connections[#self.Connections + 1] = self.Frame.MouseLeave:Connect(function()
        AnimationManager:Tween(self.Frame, "Quick", {
            BackgroundColor3 = theme.ElementBackground,
        })
    end)
    
    -- Register for config
    if self.ConfigId then
        ConfigManager:RegisterElement(self.ConfigId, self, function()
            return self.Value
        end, function(value)
            self:Set(value)
        end)
    end
    
    -- Register for theme updates
    self.ThemeUnregister = ThemeManager:RegisterElement(self.Frame, function(newTheme)
        self.Frame.BackgroundColor3 = newTheme.ElementBackground
        self.Label.TextColor3 = newTheme.Text
        self.ValueLabel.TextColor3 = newTheme.SubText
        self.SliderContainer.BackgroundColor3 = newTheme.SliderBackground
        self.SliderFill.BackgroundColor3 = newTheme.SliderFill
    end)
    
    return self
end

function SliderElement:UpdateSlider()
    local mouse = UserInputService:GetMouseLocation()
    local containerPos = self.SliderContainer.AbsolutePosition
    local containerSize = self.SliderContainer.AbsoluteSize
    
    local relativeX = mouse.X - containerPos.X
    local percent = Utility.Clamp(relativeX / containerSize.X, 0, 1)
    
    local rawValue = self.Min + (self.Max - self.Min) * percent
    local steppedValue = math.floor(rawValue / self.Increment + 0.5) * self.Increment
    steppedValue = Utility.Clamp(steppedValue, self.Min, self.Max)
    
    self:SetVisual(steppedValue)
    
    if steppedValue ~= self.Value then
        self.Value = steppedValue
        task.spawn(function()
            self.Callback(self.Value)
        end)
    end
end

function SliderElement:SetVisual(value)
    local percent = (value - self.Min) / (self.Max - self.Min)
    
    self.SliderFill.Size = UDim2.new(percent, 0, 1, 0)
    self.SliderKnob.Position = UDim2.new(percent, 0, 0.5, 0)
    self.ValueLabel.Text = tostring(Utility.Round(value, 2)) .. self.Suffix
end

function SliderElement:Set(value)
    value = Utility.Clamp(value, self.Min, self.Max)
    value = math.floor(value / self.Increment + 0.5) * self.Increment
    
    self.Value = value
    self:SetVisual(value)
    
    task.spawn(function()
        self.Callback(self.Value)
    end)
end

function SliderElement:GetValue()
    return self.Value
end

function SliderElement:Destroy()
    if self.ThemeUnregister then
        self.ThemeUnregister()
    end
    if self.ConfigId then
        ConfigManager:UnregisterElement(self.ConfigId)
    end
    for _, connection in ipairs(self.Connections) do
        connection:Disconnect()
    end
    self.Frame:Destroy()
end

--[[
    DROPDOWN ELEMENT
]]
local DropdownElement = {}
DropdownElement.__index = DropdownElement

function DropdownElement.new(parent, options)
    local self = setmetatable({}, DropdownElement)
    
    self.Options = options or {}
    self.Name = options.Name or "Dropdown"
    self.Items = options.Items or {}
    self.Default = options.Default
    self.Multi = options.Multi or false
    self.Callback = options.Callback or function() end
    self.Selected = self.Multi and {} or nil
    self.IsOpen = false
    self.Connections = {}
    self.ItemFrames = {}
    self.ConfigId = options.ConfigId
    
    if self.Default then
        if self.Multi then
            if type(self.Default) == "table" then
                for _, item in ipairs(self.Default) do
                    self.Selected[item] = true
                end
            end
        else
            self.Selected = self.Default
        end
    end
    
    local theme = ThemeManager:GetTheme()
    
    -- Main frame
    self.Frame = Utility.Create("Frame", {
        Parent = parent,
        BackgroundColor3 = theme.ElementBackground,
        Size = UDim2.new(1, 0, 0, 40),
        ClipsDescendants = false,
        ZIndex = 5,
    })
    
    Utility.Create("UICorner", {
        Parent = self.Frame,
        CornerRadius = UDim.new(0, 8),
    })
    
    -- Header
    self.Header = Utility.Create("TextButton", {
        Parent = self.Frame,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 40),
        Text = "",
        AutoButtonColor = false,
        ZIndex = 5,
    })
    
    -- Label
    self.Label = Utility.Create("TextLabel", {
        Parent = self.Header,
        BackgroundTransparency = 1,
        Size = UDim2.new(0.4, 0, 1, 0),
        Position = UDim2.new(0, 12, 0, 0),
        Text = self.Name,
        TextColor3 = theme.Text,
        TextSize = 13,
        Font = Enum.Font.GothamMedium,
        TextXAlignment = Enum.TextXAlignment.Left,
        ZIndex = 5,
    })
    
    -- Selected display
    self.SelectedDisplay = Utility.Create("TextLabel", {
        Parent = self.Header,
        BackgroundTransparency = 1,
        Size = UDim2.new(0.5, -30, 1, 0),
        Position = UDim2.new(0.4, 0, 0, 0),
        Text = self:GetDisplayText(),
        TextColor3 = theme.SubText,
        TextSize = 12,
        Font = Enum.Font.Gotham,
        TextXAlignment = Enum.TextXAlignment.Right,
        TextTruncate = Enum.TextTruncate.AtEnd,
        ZIndex = 5,
    })
    
    -- Arrow icon
    self.Arrow = Utility.Create("TextLabel", {
        Parent = self.Header,
        BackgroundTransparency = 1,
        AnchorPoint = Vector2.new(1, 0.5),
        Position = UDim2.new(1, -12, 0.5, 0),
        Size = UDim2.new(0, 16, 0, 16),
        Text = "▼",
        TextColor3 = theme.SubText,
        TextSize = 10,
        Font = Enum.Font.GothamBold,
        ZIndex = 5,
    })
    
    -- Dropdown container
    self.DropdownContainer = Utility.Create("Frame", {
        Parent = self.Frame,
        BackgroundColor3 = theme.DropdownBackground,
        Size = UDim2.new(1, 0, 0, 0),
        Position = UDim2.new(0, 0, 1, 4),
        ClipsDescendants = true,
        Visible = false,
        ZIndex = 10,
    })
    
    Utility.Create("UICorner", {
        Parent = self.DropdownContainer,
        CornerRadius = UDim.new(0, 8),
    })
    
    Utility.Create("UIStroke", {
        Parent = self.DropdownContainer,
        Color = theme.Stroke,
        Thickness = 1,
    })
    
    -- Scrolling frame for items
    self.ItemsScroll = Utility.Create("ScrollingFrame", {
        Parent = self.DropdownContainer,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        CanvasSize = UDim2.new(0, 0, 0, 0),
        ScrollBarThickness = 4,
        ScrollBarImageColor3 = theme.ScrollBar,
        AutomaticCanvasSize = Enum.AutomaticSize.Y,
        ZIndex = 10,
    })
    
    Utility.Create("UIListLayout", {
        Parent = self.ItemsScroll,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 2),
    })
    
    Utility.Create("UIPadding", {
        Parent = self.ItemsScroll,
        PaddingTop = UDim.new(0, 4),
        PaddingBottom = UDim.new(0, 4),
        PaddingLeft = UDim.new(0, 4),
        PaddingRight = UDim.new(0, 4),
    })
    
    -- Populate items
    self:RefreshItems()
    
    -- Toggle dropdown
    self.Connections[#self.Connections + 1] = self.Header.MouseButton1Click:Connect(function()
        self:Toggle()
    end)
    
    -- Hover effect
    self.Connections[#self.Connections + 1] = self.Header.MouseEnter:Connect(function()
        AnimationManager:Tween(self.Frame, "Quick", {
            BackgroundColor3 = theme.ElementBackgroundHover,
        })
    end)
    
    self.Connections[#self.Connections + 1] = self.Header.MouseLeave:Connect(function()
        AnimationManager:Tween(self.Frame, "Quick", {
            BackgroundColor3 = theme.ElementBackground,
        })
    end)
    
    -- Close on click outside
    self.Connections[#self.Connections + 1] = UserInputService.InputBegan:Connect(function(input)
        if self.IsOpen and (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) then
            local mousePos = UserInputService:GetMouseLocation()
            local framePos = self.Frame.AbsolutePosition
            local frameSize = self.Frame.AbsoluteSize
            local dropdownSize = self.DropdownContainer.AbsoluteSize
            
            local totalHeight = frameSize.Y + dropdownSize.Y + 4
            
            if mousePos.X < framePos.X or mousePos.X > framePos.X + frameSize.X or
               mousePos.Y < framePos.Y or mousePos.Y > framePos.Y + totalHeight then
                self:Close()
            end
        end
    end)
    
    -- Register for config
    if self.ConfigId then
        ConfigManager:RegisterElement(self.ConfigId, self, function()
            if self.Multi then
                local selected = {}
                for item, isSelected in pairs(self.Selected) do
                    if isSelected then
                        table.insert(selected, item)
                    end
                end
                return selected
            else
                return self.Selected
            end
        end, function(value)
            if self.Multi then
                self.Selected = {}
                if type(value) == "table" then
                    for _, item in ipairs(value) do
                        self.Selected[item] = true
                    end
                end
            else
                self.Selected = value
            end
            self:RefreshItems()
            self.SelectedDisplay.Text = self:GetDisplayText()
        end)
    end
    
    -- Register for theme updates
    self.ThemeUnregister = ThemeManager:RegisterElement(self.Frame, function(newTheme)
        self.Frame.BackgroundColor3 = newTheme.ElementBackground
        self.Label.TextColor3 = newTheme.Text
        self.SelectedDisplay.TextColor3 = newTheme.SubText
        self.Arrow.TextColor3 = newTheme.SubText
        self.DropdownContainer.BackgroundColor3 = newTheme.DropdownBackground
    end)
    
    return self
end

function DropdownElement:GetDisplayText()
    if self.Multi then
        local selected = {}
        for item, isSelected in pairs(self.Selected) do
            if isSelected then
                table.insert(selected, item)
            end
        end
        if #selected == 0 then
            return "None selected"
        elseif #selected <= 2 then
            return table.concat(selected, ", ")
        else
            return #selected .. " selected"
        end
    else
        return self.Selected or "Select..."
    end
end

function DropdownElement:RefreshItems()
    -- Clear existing items
    for _, frame in ipairs(self.ItemFrames) do
        frame:Destroy()
    end
    self.ItemFrames = {}
    
    local theme = ThemeManager:GetTheme()
    
    for i, item in ipairs(self.Items) do
        local isSelected = self.Multi and self.Selected[item] or self.Selected == item
        
        local itemFrame = Utility.Create("TextButton", {
            Parent = self.ItemsScroll,
            BackgroundColor3 = isSelected and theme.Accent or theme.ElementBackground,
            BackgroundTransparency = isSelected and 0 or 1,
            Size = UDim2.new(1, 0, 0, 30),
            Text = "",
            AutoButtonColor = false,
            LayoutOrder = i,
            ZIndex = 10,
        })
        
        Utility.Create("UICorner", {
            Parent = itemFrame,
            CornerRadius = UDim.new(0, 6),
        })
        
        local itemLabel = Utility.Create("TextLabel", {
            Parent = itemFrame,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, -16, 1, 0),
            Position = UDim2.new(0, 8, 0, 0),
            Text = item,
            TextColor3 = isSelected and Color3.fromRGB(255, 255, 255) or theme.Text,
            TextSize = 12,
            Font = Enum.Font.Gotham,
            TextXAlignment = Enum.TextXAlignment.Left,
            ZIndex = 10,
        })
        
        -- Checkmark for multi-select
        if self.Multi then
            local checkmark = Utility.Create("TextLabel", {
                Parent = itemFrame,
                BackgroundTransparency = 1,
                AnchorPoint = Vector2.new(1, 0.5),
                Position = UDim2.new(1, -8, 0.5, 0),
                Size = UDim2.new(0, 16, 0, 16),
                Text = isSelected and "✓" or "",
                TextColor3 = Color3.fromRGB(255, 255, 255),
                TextSize = 12,
                Font = Enum.Font.GothamBold,
                ZIndex = 10,
            })
        end
        
        -- Hover effect
        itemFrame.MouseEnter:Connect(function()
            if not (self.Multi and self.Selected[item] or self.Selected == item) then
                AnimationManager:Tween(itemFrame, "Quick", {
                    BackgroundTransparency = 0,
                    BackgroundColor3 = theme.Hover,
                })
            end
        end)
        
        itemFrame.MouseLeave:Connect(function()
            local selected = self.Multi and self.Selected[item] or self.Selected == item
            if not selected then
                AnimationManager:Tween(itemFrame, "Quick", {
                    BackgroundTransparency = 1,
                })
            end
        end)
        
        -- Click handler
        itemFrame.MouseButton1Click:Connect(function()
            if self.Multi then
                self.Selected[item] = not self.Selected[item]
                self:RefreshItems()
                self.SelectedDisplay.Text = self:GetDisplayText()
                
                local selectedItems = {}
                for i, isSelected in pairs(self.Selected) do
                    if isSelected then
                        table.insert(selectedItems, i)
                    end
                end
                
                task.spawn(function()
                    self.Callback(selectedItems)
                end)
            else
                self.Selected = item
                self:RefreshItems()
                self.SelectedDisplay.Text = self:GetDisplayText()
                self:Close()
                
                task.spawn(function()
                    self.Callback(item)
                end)
            end
        end)
        
        table.insert(self.ItemFrames, itemFrame)
    end
end

function DropdownElement:Toggle()
    if self.IsOpen then
        self:Close()
    else
        self:Open()
    end
end

function DropdownElement:Open()
    self.IsOpen = true
    self.DropdownContainer.Visible = true
    
    local itemHeight = 30
    local padding = 8
    local spacing = 2
    local maxHeight = 180
    local contentHeight = #self.Items * itemHeight + (#self.Items - 1) * spacing + padding
    local targetHeight = math.min(contentHeight, maxHeight)
    
    AnimationManager:Tween(self.Arrow, "Quick", {
        Rotation = 180,
    })
    
    AnimationManager:Tween(self.DropdownContainer, "Smooth", {
        Size = UDim2.new(1, 0, 0, targetHeight),
    })
end

function DropdownElement:Close()
    self.IsOpen = false
    
    AnimationManager:Tween(self.Arrow, "Quick", {
        Rotation = 0,
    })
    
    AnimationManager:Tween(self.DropdownContainer, "Smooth", {
        Size = UDim2.new(1, 0, 0, 0),
    }, function()
        self.DropdownContainer.Visible = false
    end)
end

function DropdownElement:SetItems(items)
    self.Items = items
    self:RefreshItems()
end

function DropdownElement:SetValue(value)
    if self.Multi then
        self.Selected = {}
        if type(value) == "table" then
            for _, item in ipairs(value) do
                self.Selected[item] = true
            end
        end
    else
        self.Selected = value
    end
    self:RefreshItems()
    self.SelectedDisplay.Text = self:GetDisplayText()
end

function DropdownElement:GetValue()
    if self.Multi then
        local selected = {}
        for item, isSelected in pairs(self.Selected) do
            if isSelected then
                table.insert(selected, item)
            end
        end
        return selected
    else
        return self.Selected
    end
end

function DropdownElement:Destroy()
    if self.ThemeUnregister then
        self.ThemeUnregister()
    end
    if self.ConfigId then
        ConfigManager:UnregisterElement(self.ConfigId)
    end
    for _, connection in ipairs(self.Connections) do
        connection:Disconnect()
    end
    self.Frame:Destroy()
end

--[[
    TEXTBOX ELEMENT
]]
local TextboxElement = {}
TextboxElement.__index = TextboxElement

function TextboxElement.new(parent, options)
    local self = setmetatable({}, TextboxElement)
    
    self.Options = options or {}
    self.Name = options.Name or "Textbox"
    self.Default = options.Default or ""
    self.Placeholder = options.Placeholder or "Enter text..."
    self.ClearOnFocus = options.ClearOnFocus or false
    self.Callback = options.Callback or function() end
    self.Value = self.Default
    self.Connections = {}
    self.ConfigId = options.ConfigId
    
    local theme = ThemeManager:GetTheme()
    
    -- Main frame
    self.Frame = Utility.Create("Frame", {
        Parent = parent,
        BackgroundColor3 = theme.ElementBackground,
        Size = UDim2.new(1, 0, 0, 60),
    })
    
    Utility.Create("UICorner", {
        Parent = self.Frame,
        CornerRadius = UDim.new(0, 8),
    })
    
    -- Label
    self.Label = Utility.Create("TextLabel", {
        Parent = self.Frame,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, -24, 0, 20),
        Position = UDim2.new(0, 12, 0, 8),
        Text = self.Name,
        TextColor3 = theme.Text,
        TextSize = 13,
        Font = Enum.Font.GothamMedium,
        TextXAlignment = Enum.TextXAlignment.Left,
    })
    
    -- Input container
    self.InputContainer = Utility.Create("Frame", {
        Parent = self.Frame,
        BackgroundColor3 = theme.InputBackground,
        Size = UDim2.new(1, -24, 0, 28),
        Position = UDim2.new(0, 12, 0, 26),
    })
    
    Utility.Create("UICorner", {
        Parent = self.InputContainer,
        CornerRadius = UDim.new(0, 6),
    })
    
    self.InputStroke = Utility.Create("UIStroke", {
        Parent = self.InputContainer,
        Color = theme.InputBorder,
        Thickness = 1,
    })
    
    -- Text input
    self.Input = Utility.Create("TextBox", {
        Parent = self.InputContainer,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, -16, 1, 0),
        Position = UDim2.new(0, 8, 0, 0),
        Text = self.Value,
        PlaceholderText = self.Placeholder,
        PlaceholderColor3 = theme.DimText,
        TextColor3 = theme.Text,
        TextSize = 12,
        Font = Enum.Font.Gotham,
        TextXAlignment = Enum.TextXAlignment.Left,
        ClearTextOnFocus = self.ClearOnFocus,
    })
    
    -- Focus handlers
    self.Connections[#self.Connections + 1] = self.Input.Focused:Connect(function()
        AnimationManager:Tween(self.InputStroke, "Quick", {
            Color = theme.InputBorderFocused,
        })
    end)
    
    self.Connections[#self.Connections + 1] = self.Input.FocusLost:Connect(function(enterPressed)
        AnimationManager:Tween(self.InputStroke, "Quick", {
            Color = theme.InputBorder,
        })
        
        self.Value = self.Input.Text
        
        task.spawn(function()
            self.Callback(self.Value, enterPressed)
        end)
    end)
    
    -- Hover effect
    self.Connections[#self.Connections + 1] = self.Frame.MouseEnter:Connect(function()
        AnimationManager:Tween(self.Frame, "Quick", {
            BackgroundColor3 = theme.ElementBackgroundHover,
        })
    end)
    
    self.Connections[#self.Connections + 1] = self.Frame.MouseLeave:Connect(function()
        AnimationManager:Tween(self.Frame, "Quick", {
            BackgroundColor3 = theme.ElementBackground,
        })
    end)
    
    -- Register for config
    if self.ConfigId then
        ConfigManager:RegisterElement(self.ConfigId, self, function()
            return self.Value
        end, function(value)
            self:Set(value)
        end)
    end
    
    -- Register for theme updates
    self.ThemeUnregister = ThemeManager:RegisterElement(self.Frame, function(newTheme)
        self.Frame.BackgroundColor3 = newTheme.ElementBackground
        self.Label.TextColor3 = newTheme.Text
        self.InputContainer.BackgroundColor3 = newTheme.InputBackground
        self.InputStroke.Color = newTheme.InputBorder
        self.Input.TextColor3 = newTheme.Text
        self.Input.PlaceholderColor3 = newTheme.DimText
    end)
    
    return self
end

function TextboxElement:Set(value)
    self.Value = tostring(value)
    self.Input.Text = self.Value
end

function TextboxElement:GetValue()
    return self.Value
end

function TextboxElement:Destroy()
    if self.ThemeUnregister then
        self.ThemeUnregister()
    end
    if self.ConfigId then
        ConfigManager:UnregisterElement(self.ConfigId)
    end
    for _, connection in ipairs(self.Connections) do
        connection:Disconnect()
    end
    self.Frame:Destroy()
end

--[[
    KEYBIND ELEMENT
]]
local KeybindElement = {}
KeybindElement.__index = KeybindElement

function KeybindElement.new(parent, options)
    local self = setmetatable({}, KeybindElement)
    
    self.Options = options or {}
    self.Name = options.Name or "Keybind"
    self.Default = options.Default
    self.Callback = options.Callback or function() end
    self.OnChanged = options.OnChanged or function() end
    self.Key = self.Default
    self.Listening = false
    self.Connections = {}
    self.ConfigId = options.ConfigId
    
    local theme = ThemeManager:GetTheme()
    
    -- Main frame
    self.Frame = Utility.Create("Frame", {
        Parent = parent,
        BackgroundColor3 = theme.ElementBackground,
        Size = UDim2.new(1, 0, 0, 40),
    })
    
    Utility.Create("UICorner", {
        Parent = self.Frame,
        CornerRadius = UDim.new(0, 8),
    })
    
    -- Button overlay
    self.Button = Utility.Create("TextButton", {
        Parent = self.Frame,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        Text = "",
        AutoButtonColor = false,
    })
    
    -- Label
    self.Label = Utility.Create("TextLabel", {
        Parent = self.Frame,
        BackgroundTransparency = 1,
        Size = UDim2.new(0.6, 0, 1, 0),
        Position = UDim2.new(0, 12, 0, 0),
        Text = self.Name,
        TextColor3 = theme.Text,
        TextSize = 13,
        Font = Enum.Font.GothamMedium,
        TextXAlignment = Enum.TextXAlignment.Left,
    })
    
    -- Keybind display
    self.KeyDisplay = Utility.Create("Frame", {
        Parent = self.Frame,
        BackgroundColor3 = theme.InputBackground,
        AnchorPoint = Vector2.new(1, 0.5),
        Position = UDim2.new(1, -12, 0.5, 0),
        Size = UDim2.new(0, 70, 0, 26),
    })
    
    Utility.Create("UICorner", {
        Parent = self.KeyDisplay,
        CornerRadius = UDim.new(0, 6),
    })
    
    self.KeyDisplayStroke = Utility.Create("UIStroke", {
        Parent = self.KeyDisplay,
        Color = theme.InputBorder,
        Thickness = 1,
    })
    
    self.KeyLabel = Utility.Create("TextLabel", {
        Parent = self.KeyDisplay,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        Text = self.Key and self.Key.Name or "None",
        TextColor3 = theme.SubText,
        TextSize = 11,
        Font = Enum.Font.GothamMedium,
    })
    
    -- Click to change
    self.Connections[#self.Connections + 1] = self.Button.MouseButton1Click:Connect(function()
        self:StartListening()
    end)
    
    -- Key input listener
    self.Connections[#self.Connections + 1] = UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if self.Listening then
            if input.UserInputType == Enum.UserInputType.Keyboard then
                if input.KeyCode == Enum.KeyCode.Escape then
                    self:StopListening(nil)
                else
                    self:StopListening(input.KeyCode)
                end
            elseif input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.MouseButton2 then
                -- Check if clicking outside
                local mousePos = UserInputService:GetMouseLocation()
                local framePos = self.Frame.AbsolutePosition
                local frameSize = self.Frame.AbsoluteSize
                
                if mousePos.X < framePos.X or mousePos.X > framePos.X + frameSize.X or
                   mousePos.Y < framePos.Y or mousePos.Y > framePos.Y + frameSize.Y then
                    self:StopListening(nil)
                end
            end
        elseif self.Key and input.UserInputType == Enum.UserInputType.Keyboard and input.KeyCode == self.Key then
            if not gameProcessed then
                task.spawn(function()
                    self.Callback(self.Key)
                end)
            end
        end
    end)
    
    -- Hover effect
    self.Connections[#self.Connections + 1] = self.Button.MouseEnter:Connect(function()
        AnimationManager:Tween(self.Frame, "Quick", {
            BackgroundColor3 = theme.ElementBackgroundHover,
        })
    end)
    
    self.Connections[#self.Connections + 1] = self.Button.MouseLeave:Connect(function()
        AnimationManager:Tween(self.Frame, "Quick", {
            BackgroundColor3 = theme.ElementBackground,
        })
    end)
    
    -- Register for config
    if self.ConfigId then
        ConfigManager:RegisterElement(self.ConfigId, self, function()
            return self.Key and self.Key.Name or nil
        end, function(value)
            if value then
                local key = Enum.KeyCode[value]
                if key then
                    self:Set(key)
                end
            else
                self:Set(nil)
            end
        end)
    end
    
    -- Register for theme updates
    self.ThemeUnregister = ThemeManager:RegisterElement(self.Frame, function(newTheme)
        self.Frame.BackgroundColor3 = newTheme.ElementBackground
        self.Label.TextColor3 = newTheme.Text
        self.KeyDisplay.BackgroundColor3 = newTheme.InputBackground
        self.KeyDisplayStroke.Color = newTheme.InputBorder
        self.KeyLabel.TextColor3 = newTheme.SubText
    end)
    
    return self
end

function KeybindElement:StartListening()
    self.Listening = true
    local theme = ThemeManager:GetTheme()
    
    self.KeyLabel.Text = "..."
    AnimationManager:Tween(self.KeyDisplayStroke, "Quick", {
        Color = theme.Accent,
    })
end

function KeybindElement:StopListening(key)
    self.Listening = false
    local theme = ThemeManager:GetTheme()
    
    if key then
        self.Key = key
        self.KeyLabel.Text = key.Name
        
        task.spawn(function()
            self.OnChanged(key)
        end)
    else
        self.KeyLabel.Text = self.Key and self.Key.Name or "None"
    end
    
    AnimationManager:Tween(self.KeyDisplayStroke, "Quick", {
        Color = theme.InputBorder,
    })
end

function KeybindElement:Set(key)
    self.Key = key
    self.KeyLabel.Text = key and key.Name or "None"
end

function KeybindElement:GetKey()
    return self.Key
end

function KeybindElement:Destroy()
    if self.ThemeUnregister then
        self.ThemeUnregister()
    end
    if self.ConfigId then
        ConfigManager:UnregisterElement(self.ConfigId)
    end
    for _, connection in ipairs(self.Connections) do
        connection:Disconnect()
    end
    self.Frame:Destroy()
end

--[[
    LABEL ELEMENT
]]
local LabelElement = {}
LabelElement.__index = LabelElement

function LabelElement.new(parent, options)
    local self = setmetatable({}, LabelElement)
    
    self.Options = options or {}
    self.Text = options.Text or "Label"
    self.Connections = {}
    
    local theme = ThemeManager:GetTheme()
    
    -- Main frame
    self.Frame = Utility.Create("Frame", {
        Parent = parent,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 24),
    })
    
    -- Label
    self.Label = Utility.Create("TextLabel", {
        Parent = self.Frame,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, -24, 1, 0),
        Position = UDim2.new(0, 12, 0, 0),
        Text = self.Text,
        TextColor3 = theme.SubText,
        TextSize = 12,
        Font = Enum.Font.Gotham,
        TextXAlignment = Enum.TextXAlignment.Left,
    })
    
    -- Register for theme updates
    self.ThemeUnregister = ThemeManager:RegisterElement(self.Frame, function(newTheme)
        self.Label.TextColor3 = newTheme.SubText
    end)
    
    return self
end

function LabelElement:SetText(text)
    self.Text = text
    self.Label.Text = text
end

function LabelElement:Destroy()
    if self.ThemeUnregister then
        self.ThemeUnregister()
    end
    for _, connection in ipairs(self.Connections) do
        connection:Disconnect()
    end
    self.Frame:Destroy()
end

--[[
    PARAGRAPH ELEMENT
]]
local ParagraphElement = {}
ParagraphElement.__index = ParagraphElement

function ParagraphElement.new(parent, options)
    local self = setmetatable({}, ParagraphElement)
    
    self.Options = options or {}
    self.Title = options.Title or "Paragraph"
    self.Content = options.Content or ""
    self.Connections = {}
    
    local theme = ThemeManager:GetTheme()
    
    -- Main frame
    self.Frame = Utility.Create("Frame", {
        Parent = parent,
        BackgroundColor3 = theme.ElementBackground,
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
    })
    
    Utility.Create("UICorner", {
        Parent = self.Frame,
        CornerRadius = UDim.new(0, 8),
    })
    
    Utility.Create("UIPadding", {
        Parent = self.Frame,
        PaddingTop = UDim.new(0, 10),
        PaddingBottom = UDim.new(0, 10),
        PaddingLeft = UDim.new(0, 12),
        PaddingRight = UDim.new(0, 12),
    })
    
    Utility.Create("UIListLayout", {
        Parent = self.Frame,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 4),
    })
    
    -- Title
    self.TitleLabel = Utility.Create("TextLabel", {
        Parent = self.Frame,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 18),
        Text = self.Title,
        TextColor3 = theme.Text,
        TextSize = 14,
        Font = Enum.Font.GothamBold,
        TextXAlignment = Enum.TextXAlignment.Left,
        LayoutOrder = 1,
    })
    
    -- Content
    self.ContentLabel = Utility.Create("TextLabel", {
        Parent = self.Frame,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        Text = self.Content,
        TextColor3 = theme.SubText,
        TextSize = 12,
        Font = Enum.Font.Gotham,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextWrapped = true,
        LayoutOrder = 2,
    })
    
    -- Register for theme updates
    self.ThemeUnregister = ThemeManager:RegisterElement(self.Frame, function(newTheme)
        self.Frame.BackgroundColor3 = newTheme.ElementBackground
        self.TitleLabel.TextColor3 = newTheme.Text
        self.ContentLabel.TextColor3 = newTheme.SubText
    end)
    
    return self
end

function ParagraphElement:SetTitle(title)
    self.Title = title
    self.TitleLabel.Text = title
end

function ParagraphElement:SetContent(content)
    self.Content = content
    self.ContentLabel.Text = content
end

function ParagraphElement:Destroy()
    if self.ThemeUnregister then
        self.ThemeUnregister()
    end
    for _, connection in ipairs(self.Connections) do
        connection:Disconnect()
    end
    self.Frame:Destroy()
end

--[[
    COLOR PICKER ELEMENT
]]
local ColorPickerElement = {}
ColorPickerElement.__index = ColorPickerElement

function ColorPickerElement.new(parent, options)
    local self = setmetatable({}, ColorPickerElement)
    
    self.Options = options or {}
    self.Name = options.Name or "Color Picker"
    self.Default = options.Default or Color3.fromRGB(255, 255, 255)
    self.Callback = options.Callback or function() end
    self.Color = self.Default
    self.IsOpen = false
    self.Connections = {}
    self.ConfigId = options.ConfigId
    
    -- HSV values
    local h, s, v = self.Color:ToHSV()
    self.Hue = h
    self.Saturation = s
    self.Value = v
    
    local theme = ThemeManager:GetTheme()
    
    -- Main frame
    self.Frame = Utility.Create("Frame", {
        Parent = parent,
        BackgroundColor3 = theme.ElementBackground,
        Size = UDim2.new(1, 0, 0, 40),
        ClipsDescendants = false,
        ZIndex = 6,
    })
    
    Utility.Create("UICorner", {
        Parent = self.Frame,
        CornerRadius = UDim.new(0, 8),
    })
    
    -- Header button
    self.Header = Utility.Create("TextButton", {
        Parent = self.Frame,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 40),
        Text = "",
        AutoButtonColor = false,
        ZIndex = 6,
    })
    
    -- Label
    self.Label = Utility.Create("TextLabel", {
        Parent = self.Header,
        BackgroundTransparency = 1,
        Size = UDim2.new(0.6, 0, 1, 0),
        Position = UDim2.new(0, 12, 0, 0),
        Text = self.Name,
        TextColor3 = theme.Text,
        TextSize = 13,
        Font = Enum.Font.GothamMedium,
        TextXAlignment = Enum.TextXAlignment.Left,
        ZIndex = 6,
    })
    
    -- Color preview
    self.ColorPreview = Utility.Create("Frame", {
        Parent = self.Header,
        BackgroundColor3 = self.Color,
        AnchorPoint = Vector2.new(1, 0.5),
        Position = UDim2.new(1, -12, 0.5, 0),
        Size = UDim2.new(0, 40, 0, 24),
        ZIndex = 6,
    })
    
    Utility.Create("UICorner", {
        Parent = self.ColorPreview,
        CornerRadius = UDim.new(0, 6),
    })
    
    Utility.Create("UIStroke", {
        Parent = self.ColorPreview,
        Color = theme.Stroke,
        Thickness = 1,
    })
    
    -- Picker container
    self.PickerContainer = Utility.Create("Frame", {
        Parent = self.Frame,
        BackgroundColor3 = theme.DropdownBackground,
        Size = UDim2.new(1, 0, 0, 0),
        Position = UDim2.new(0, 0, 1, 4),
        ClipsDescendants = true,
        Visible = false,
        ZIndex = 15,
    })
    
    Utility.Create("UICorner", {
        Parent = self.PickerContainer,
        CornerRadius = UDim.new(0, 8),
    })
    
    Utility.Create("UIStroke", {
        Parent = self.PickerContainer,
        Color = theme.Stroke,
        Thickness = 1,
    })
    
    Utility.Create("UIPadding", {
        Parent = self.PickerContainer,
        PaddingTop = UDim.new(0, 10),
        PaddingBottom = UDim.new(0, 10),
        PaddingLeft = UDim.new(0, 10),
        PaddingRight = UDim.new(0, 10),
    })
    
    -- Saturation/Value picker
    self.SVPicker = Utility.Create("ImageButton", {
        Parent = self.PickerContainer,
        BackgroundColor3 = Color3.fromHSV(self.Hue, 1, 1),
        Size = UDim2.new(1, -30, 0, 120),
        AutoButtonColor = false,
        ZIndex = 15,
    })
    
    Utility.Create("UICorner", {
        Parent = self.SVPicker,
        CornerRadius = UDim.new(0, 6),
    })
    
    -- Saturation gradient (white to transparent)
    Utility.Create("UIGradient", {
        Parent = self.SVPicker,
        Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 255, 255)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 255, 255)),
        }),
        Transparency = NumberSequence.new({
            NumberSequenceKeypoint.new(0, 0),
            NumberSequenceKeypoint.new(1, 1),
        }),
    })
    
    -- Value overlay (black gradient)
    self.ValueOverlay = Utility.Create("Frame", {
        Parent = self.SVPicker,
        BackgroundColor3 = Color3.fromRGB(0, 0, 0),
        Size = UDim2.new(1, 0, 1, 0),
        ZIndex = 15,
    })
    
    Utility.Create("UICorner", {
        Parent = self.ValueOverlay,
        CornerRadius = UDim.new(0, 6),
    })
    
    Utility.Create("UIGradient", {
        Parent = self.ValueOverlay,
        Rotation = 90,
        Transparency = NumberSequence.new({
            NumberSequenceKeypoint.new(0, 1),
            NumberSequenceKeypoint.new(1, 0),
        }),
    })
    
    -- SV cursor
    self.SVCursor = Utility.Create("Frame", {
        Parent = self.SVPicker,
        BackgroundColor3 = Color3.fromRGB(255, 255, 255),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Position = UDim2.new(self.Saturation, 0, 1 - self.Value, 0),
        Size = UDim2.new(0, 12, 0, 12),
        ZIndex = 16,
    })
    
    Utility.Create("UICorner", {
        Parent = self.SVCursor,
        CornerRadius = UDim.new(1, 0),
    })
    
    Utility.Create("UIStroke", {
        Parent = self.SVCursor,
        Color = Color3.fromRGB(0, 0, 0),
        Thickness = 2,
    })
    
    -- Hue slider
    self.HueSlider = Utility.Create("ImageButton", {
        Parent = self.PickerContainer,
        BackgroundColor3 = Color3.fromRGB(255, 255, 255),
        AnchorPoint = Vector2.new(1, 0),
        Position = UDim2.new(1, 0, 0, 0),
        Size = UDim2.new(0, 20, 0, 120),
        AutoButtonColor = false,
        ZIndex = 15,
    })
    
    Utility.Create("UICorner", {
        Parent = self.HueSlider,
        CornerRadius = UDim.new(0, 6),
    })
    
    Utility.Create("UIGradient", {
        Parent = self.HueSlider,
        Rotation = 90,
        Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, Color3.fromHSV(0, 1, 1)),
            ColorSequenceKeypoint.new(0.167, Color3.fromHSV(0.167, 1, 1)),
            ColorSequenceKeypoint.new(0.333, Color3.fromHSV(0.333, 1, 1)),
            ColorSequenceKeypoint.new(0.5, Color3.fromHSV(0.5, 1, 1)),
            ColorSequenceKeypoint.new(0.667, Color3.fromHSV(0.667, 1, 1)),
            ColorSequenceKeypoint.new(0.833, Color3.fromHSV(0.833, 1, 1)),
            ColorSequenceKeypoint.new(1, Color3.fromHSV(1, 1, 1)),
        }),
    })
    
    -- Hue cursor
    self.HueCursor = Utility.Create("Frame", {
        Parent = self.HueSlider,
        BackgroundColor3 = Color3.fromRGB(255, 255, 255),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Position = UDim2.new(0.5, 0, self.Hue, 0),
        Size = UDim2.new(1, 4, 0, 6),
        ZIndex = 16,
    })
    
    Utility.Create("UICorner", {
        Parent = self.HueCursor,
        CornerRadius = UDim.new(0, 3),
    })
    
    Utility.Create("UIStroke", {
        Parent = self.HueCursor,
        Color = Color3.fromRGB(0, 0, 0),
        Thickness = 1,
    })
    
    -- RGB input container
    self.RGBContainer = Utility.Create("Frame", {
        Parent = self.PickerContainer,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 28),
        Position = UDim2.new(0, 0, 0, 130),
        ZIndex = 15,
    })
    
    -- Create RGB inputs
    local rgbLabels = {"R", "G", "B"}
    local rgbValues = {math.floor(self.Color.R * 255), math.floor(self.Color.G * 255), math.floor(self.Color.B * 255)}
    self.RGBInputs = {}
    
    for i, label in ipairs(rgbLabels) do
        local inputContainer = Utility.Create("Frame", {
            Parent = self.RGBContainer,
            BackgroundColor3 = theme.InputBackground,
            Size = UDim2.new(0.3, -5, 1, 0),
            Position = UDim2.new((i - 1) * 0.333 + 0.015, 0, 0, 0),
            ZIndex = 15,
        })
        
        Utility.Create("UICorner", {
            Parent = inputContainer,
            CornerRadius = UDim.new(0, 4),
        })
        
        Utility.Create("UIStroke", {
            Parent = inputContainer,
            Color = theme.InputBorder,
            Thickness = 1,
        })
        
        local inputLabel = Utility.Create("TextLabel", {
            Parent = inputContainer,
            BackgroundTransparency = 1,
            Size = UDim2.new(0, 16, 1, 0),
            Position = UDim2.new(0, 4, 0, 0),
            Text = label,
            TextColor3 = theme.DimText,
            TextSize = 10,
            Font = Enum.Font.GothamMedium,
            ZIndex = 15,
        })
        
        local input = Utility.Create("TextBox", {
            Parent = inputContainer,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, -24, 1, 0),
            Position = UDim2.new(0, 20, 0, 0),
            Text = tostring(rgbValues[i]),
            TextColor3 = theme.Text,
            TextSize = 11,
            Font = Enum.Font.Gotham,
            TextXAlignment = Enum.TextXAlignment.Right,
            ZIndex = 15,
        })
        
        self.RGBInputs[label] = input
        
        self.Connections[#self.Connections + 1] = input.FocusLost:Connect(function()
            local value = tonumber(input.Text) or 0
            value = Utility.Clamp(math.floor(value), 0, 255)
            input.Text = tostring(value)
            
            local r = tonumber(self.RGBInputs["R"].Text) or 0
            local g = tonumber(self.RGBInputs["G"].Text) or 0
            local b = tonumber(self.RGBInputs["B"].Text) or 0
            
            self:SetColor(Color3.fromRGB(r, g, b))
        end)
    end
    
    -- Hex input
    self.HexContainer = Utility.Create("Frame", {
        Parent = self.PickerContainer,
        BackgroundColor3 = theme.InputBackground,
        Size = UDim2.new(1, 0, 0, 28),
        Position = UDim2.new(0, 0, 0, 165),
        ZIndex = 15,
    })
    
    Utility.Create("UICorner", {
        Parent = self.HexContainer,
        CornerRadius = UDim.new(0, 4),
    })
    
    Utility.Create("UIStroke", {
        Parent = self.HexContainer,
        Color = theme.InputBorder,
        Thickness = 1,
    })
    
    Utility.Create("TextLabel", {
        Parent = self.HexContainer,
        BackgroundTransparency = 1,
        Size = UDim2.new(0, 20, 1, 0),
        Position = UDim2.new(0, 8, 0, 0),
        Text = "#",
        TextColor3 = theme.DimText,
        TextSize = 12,
        Font = Enum.Font.GothamMedium,
        ZIndex = 15,
    })
    
    self.HexInput = Utility.Create("TextBox", {
        Parent = self.HexContainer,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, -32, 1, 0),
        Position = UDim2.new(0, 28, 0, 0),
        Text = self:ColorToHex(self.Color),
        TextColor3 = theme.Text,
        TextSize = 12,
        Font = Enum.Font.Gotham,
        TextXAlignment = Enum.TextXAlignment.Left,
        ZIndex = 15,
    })
    
    self.Connections[#self.Connections + 1] = self.HexInput.FocusLost:Connect(function()
        local hex = self.HexInput.Text:gsub("#", "")
        if #hex == 6 then
            local r = tonumber(hex:sub(1, 2), 16) or 0
            local g = tonumber(hex:sub(3, 4), 16) or 0
            local b = tonumber(hex:sub(5, 6), 16) or 0
            self:SetColor(Color3.fromRGB(r, g, b))
        else
            self.HexInput.Text = self:ColorToHex(self.Color)
        end
    end)
    
    -- Input handlers for SV picker
    local svDragging = false
    self.Connections[#self.Connections + 1] = self.SVPicker.MouseButton1Down:Connect(function()
        svDragging = true
        self:UpdateSV()
    end)
    
    self.Connections[#self.Connections + 1] = UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            svDragging = false
        end
    end)
    
    self.Connections[#self.Connections + 1] = UserInputService.InputChanged:Connect(function(input)
        if svDragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            self:UpdateSV()
        end
    end)
    
    -- Input handlers for Hue slider
    local hueDragging = false
    self.Connections[#self.Connections + 1] = self.HueSlider.MouseButton1Down:Connect(function()
        hueDragging = true
        self:UpdateHue()
    end)
    
    self.Connections[#self.Connections + 1] = UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            hueDragging = false
        end
    end)
    
    self.Connections[#self.Connections + 1] = UserInputService.InputChanged:Connect(function(input)
        if hueDragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            self:UpdateHue()
        end
    end)
    
    -- Toggle picker
    self.Connections[#self.Connections + 1] = self.Header.MouseButton1Click:Connect(function()
        self:Toggle()
    end)
    
    -- Hover effect
    self.Connections[#self.Connections + 1] = self.Header.MouseEnter:Connect(function()
        AnimationManager:Tween(self.Frame, "Quick", {
            BackgroundColor3 = theme.ElementBackgroundHover,
        })
    end)
    
    self.Connections[#self.Connections + 1] = self.Header.MouseLeave:Connect(function()
        AnimationManager:Tween(self.Frame, "Quick", {
            BackgroundColor3 = theme.ElementBackground,
        })
    end)
    
    -- Close on click outside
    self.Connections[#self.Connections + 1] = UserInputService.InputBegan:Connect(function(input)
        if self.IsOpen and (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) then
            local mousePos = UserInputService:GetMouseLocation()
            local framePos = self.Frame.AbsolutePosition
            local frameSize = self.Frame.AbsoluteSize
            local pickerPos = self.PickerContainer.AbsolutePosition
            local pickerSize = self.PickerContainer.AbsoluteSize
            
            local inFrame = mousePos.X >= framePos.X and mousePos.X <= framePos.X + frameSize.X and
                           mousePos.Y >= framePos.Y and mousePos.Y <= framePos.Y + frameSize.Y
            local inPicker = mousePos.X >= pickerPos.X and mousePos.X <= pickerPos.X + pickerSize.X and
                            mousePos.Y >= pickerPos.Y and mousePos.Y <= pickerPos.Y + pickerSize.Y
            
            if not inFrame and not inPicker then
                self:Close()
            end
        end
    end)
    
    -- Register for config
    if self.ConfigId then
        ConfigManager:RegisterElement(self.ConfigId, self, function()
            return {
                R = math.floor(self.Color.R * 255),
                G = math.floor(self.Color.G * 255),
                B = math.floor(self.Color.B * 255),
            }
        end, function(value)
            if type(value) == "table" then
                self:SetColor(Color3.fromRGB(value.R or 255, value.G or 255, value.B or 255))
            end
        end)
    end
    
    -- Register for theme updates
    self.ThemeUnregister = ThemeManager:RegisterElement(self.Frame, function(newTheme)
        self.Frame.BackgroundColor3 = newTheme.ElementBackground
        self.Label.TextColor3 = newTheme.Text
        self.PickerContainer.BackgroundColor3 = newTheme.DropdownBackground
    end)
    
    return self
end

function ColorPickerElement:ColorToHex(color)
    return string.format("%02X%02X%02X", 
        math.floor(color.R * 255), 
        math.floor(color.G * 255), 
        math.floor(color.B * 255)
    )
end

function ColorPickerElement:UpdateSV()
    local mouse = UserInputService:GetMouseLocation()
    local pos = self.SVPicker.AbsolutePosition
    local size = self.SVPicker.AbsoluteSize
    
    local relX = Utility.Clamp((mouse.X - pos.X) / size.X, 0, 1)
    local relY = Utility.Clamp((mouse.Y - pos.Y) / size.Y, 0, 1)
    
    self.Saturation = relX
    self.Value = 1 - relY
    
    self.SVCursor.Position = UDim2.new(relX, 0, relY, 0)
    
    self:ApplyColor()
end

function ColorPickerElement:UpdateHue()
    local mouse = UserInputService:GetMouseLocation()
    local pos = self.HueSlider.AbsolutePosition
    local size = self.HueSlider.AbsoluteSize
    
    local relY = Utility.Clamp((mouse.Y - pos.Y) / size.Y, 0, 1)
    
    self.Hue = relY
    
    self.HueCursor.Position = UDim2.new(0.5, 0, relY, 0)
    self.SVPicker.BackgroundColor3 = Color3.fromHSV(self.Hue, 1, 1)
    
    self:ApplyColor()
end

function ColorPickerElement:ApplyColor()
    self.Color = Color3.fromHSV(self.Hue, self.Saturation, self.Value)
    self.ColorPreview.BackgroundColor3 = self.Color
    
    -- Update RGB inputs
    self.RGBInputs["R"].Text = tostring(math.floor(self.Color.R * 255))
    self.RGBInputs["G"].Text = tostring(math.floor(self.Color.G * 255))
    self.RGBInputs["B"].Text = tostring(math.floor(self.Color.B * 255))
    
    -- Update hex input
    self.HexInput.Text = self:ColorToHex(self.Color)
    
    task.spawn(function()
        self.Callback(self.Color)
    end)
end

function ColorPickerElement:SetColor(color)
    self.Color = color
    self.Hue, self.Saturation, self.Value = color:ToHSV()
    
    self.ColorPreview.BackgroundColor3 = color
    self.SVPicker.BackgroundColor3 = Color3.fromHSV(self.Hue, 1, 1)
    self.SVCursor.Position = UDim2.new(self.Saturation, 0, 1 - self.Value, 0)
    self.HueCursor.Position = UDim2.new(0.5, 0, self.Hue, 0)
    
    -- Update inputs
    self.RGBInputs["R"].Text = tostring(math.floor(color.R * 255))
    self.RGBInputs["G"].Text = tostring(math.floor(color.G * 255))
    self.RGBInputs["B"].Text = tostring(math.floor(color.B * 255))
    self.HexInput.Text = self:ColorToHex(color)
    
    task.spawn(function()
        self.Callback(color)
    end)
end

function ColorPickerElement:Toggle()
    if self.IsOpen then
        self:Close()
    else
        self:Open()
    end
end

function ColorPickerElement:Open()
    self.IsOpen = true
    self.PickerContainer.Visible = true
    
    AnimationManager:Tween(self.PickerContainer, "Smooth", {
        Size = UDim2.new(1, 0, 0, 200),
    })
end

function ColorPickerElement:Close()
    self.IsOpen = false
    
    AnimationManager:Tween(self.PickerContainer, "Smooth", {
        Size = UDim2.new(1, 0, 0, 0),
    }, function()
        self.PickerContainer.Visible = false
    end)
end

function ColorPickerElement:GetColor()
    return self.Color
end

function ColorPickerElement:Destroy()
    if self.ThemeUnregister then
        self.ThemeUnregister()
    end
    if self.ConfigId then
        ConfigManager:UnregisterElement(self.ConfigId)
    end
    for _, connection in ipairs(self.Connections) do
        connection:Disconnect()
    end
    self.Frame:Destroy()
end

--[[
    PROGRESS BAR ELEMENT
]]
local ProgressBarElement = {}
ProgressBarElement.__index = ProgressBarElement

function ProgressBarElement.new(parent, options)
    local self = setmetatable({}, ProgressBarElement)
    
    self.Options = options or {}
    self.Name = options.Name or "Progress"
    self.Default = options.Default or 0
    self.Max = options.Max or 100
    self.ShowPercentage = options.ShowPercentage ~= false
    self.Value = self.Default
    self.Connections = {}
    
    local theme = ThemeManager:GetTheme()
    
    -- Main frame
    self.Frame = Utility.Create("Frame", {
        Parent = parent,
        BackgroundColor3 = theme.ElementBackground,
        Size = UDim2.new(1, 0, 0, 50),
    })
    
    Utility.Create("UICorner", {
        Parent = self.Frame,
        CornerRadius = UDim.new(0, 8),
    })
    
    -- Header container
    local headerContainer = Utility.Create("Frame", {
        Parent = self.Frame,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, -24, 0, 20),
        Position = UDim2.new(0, 12, 0, 8),
    })
    
    -- Label
    self.Label = Utility.Create("TextLabel", {
        Parent = headerContainer,
        BackgroundTransparency = 1,
        Size = UDim2.new(0.7, 0, 1, 0),
        Text = self.Name,
        TextColor3 = theme.Text,
        TextSize = 13,
        Font = Enum.Font.GothamMedium,
        TextXAlignment = Enum.TextXAlignment.Left,
    })
    
    -- Percentage label
    self.PercentLabel = Utility.Create("TextLabel", {
        Parent = headerContainer,
        BackgroundTransparency = 1,
        Size = UDim2.new(0.3, 0, 1, 0),
        Position = UDim2.new(0.7, 0, 0, 0),
        Text = self.ShowPercentage and (math.floor(self.Value / self.Max * 100) .. "%") or tostring(self.Value),
        TextColor3 = theme.SubText,
        TextSize = 12,
        Font = Enum.Font.Gotham,
        TextXAlignment = Enum.TextXAlignment.Right,
    })
    
    -- Progress container
    self.ProgressContainer = Utility.Create("Frame", {
        Parent = self.Frame,
        BackgroundColor3 = theme.SliderBackground,
        Size = UDim2.new(1, -24, 0, 8),
        Position = UDim2.new(0, 12, 0, 34),
    })
    
    Utility.Create("UICorner", {
        Parent = self.ProgressContainer,
        CornerRadius = UDim.new(1, 0),
    })
    
    -- Progress fill
    local fillPercent = self.Value / self.Max
    self.ProgressFill = Utility.Create("Frame", {
        Parent = self.ProgressContainer,
        BackgroundColor3 = theme.Accent,
        Size = UDim2.new(fillPercent, 0, 1, 0),
    })
    
    Utility.Create("UICorner", {
        Parent = self.ProgressFill,
        CornerRadius = UDim.new(1, 0),
    })
    
    -- Gradient for progress
    Utility.Create("UIGradient", {
        Parent = self.ProgressFill,
        Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, theme.Accent),
            ColorSequenceKeypoint.new(1, theme.AccentLight),
        }),
    })
    
    -- Register for theme updates
    self.ThemeUnregister = ThemeManager:RegisterElement(self.Frame, function(newTheme)
        self.Frame.BackgroundColor3 = newTheme.ElementBackground
        self.Label.TextColor3 = newTheme.Text
        self.PercentLabel.TextColor3 = newTheme.SubText
        self.ProgressContainer.BackgroundColor3 = newTheme.SliderBackground
        self.ProgressFill.BackgroundColor3 = newTheme.Accent
    end)
    
    return self
end

function ProgressBarElement:SetValue(value)
    self.Value = Utility.Clamp(value, 0, self.Max)
    local fillPercent = self.Value / self.Max
    
    AnimationManager:Tween(self.ProgressFill, "Smooth", {
        Size = UDim2.new(fillPercent, 0, 1, 0),
    })
    
    if self.ShowPercentage then
        self.PercentLabel.Text = math.floor(fillPercent * 100) .. "%"
    else
        self.PercentLabel.Text = tostring(math.floor(self.Value))
    end
end

function ProgressBarElement:GetValue()
    return self.Value
end

function ProgressBarElement:SetMax(max)
    self.Max = max
    self:SetValue(self.Value)
end

function ProgressBarElement:Destroy()
    if self.ThemeUnregister then
        self.ThemeUnregister()
    end
    for _, connection in ipairs(self.Connections) do
        connection:Disconnect()
    end
    self.Frame:Destroy()
end

--[[
    SEARCH BAR ELEMENT
]]
local SearchBarElement = {}
SearchBarElement.__index = SearchBarElement

function SearchBarElement.new(parent, options)
    local self = setmetatable({}, SearchBarElement)
    
    self.Options = options or {}
    self.Placeholder = options.Placeholder or "Search..."
    self.Callback = options.Callback or function() end
    self.Value = ""
    self.Connections = {}
    
    local theme = ThemeManager:GetTheme()
    
    -- Main frame
    self.Frame = Utility.Create("Frame", {
        Parent = parent,
        BackgroundColor3 = theme.InputBackground,
        Size = UDim2.new(1, 0, 0, 36),
    })
    
    Utility.Create("UICorner", {
        Parent = self.Frame,
        CornerRadius = UDim.new(0, 8),
    })
    
    self.FrameStroke = Utility.Create("UIStroke", {
        Parent = self.Frame,
        Color = theme.InputBorder,
        Thickness = 1,
    })
    
    -- Search icon
    self.SearchIcon = Utility.Create("TextLabel", {
        Parent = self.Frame,
        BackgroundTransparency = 1,
        Size = UDim2.new(0, 24, 0, 24),
        Position = UDim2.new(0, 10, 0.5, 0),
        AnchorPoint = Vector2.new(0, 0.5),
        Text = "🔍",
        TextColor3 = theme.DimText,
        TextSize = 14,
        Font = Enum.Font.Gotham,
    })
    
    -- Input
    self.Input = Utility.Create("TextBox", {
        Parent = self.Frame,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, -70, 1, 0),
        Position = UDim2.new(0, 38, 0, 0),
        Text = "",
        PlaceholderText = self.Placeholder,
        PlaceholderColor3 = theme.DimText,
        TextColor3 = theme.Text,
        TextSize = 13,
        Font = Enum.Font.Gotham,
        TextXAlignment = Enum.TextXAlignment.Left,
        ClearTextOnFocus = false,
    })
    
    -- Clear button
    self.ClearButton = Utility.Create("TextButton", {
        Parent = self.Frame,
        BackgroundTransparency = 1,
        AnchorPoint = Vector2.new(1, 0.5),
        Position = UDim2.new(1, -8, 0.5, 0),
        Size = UDim2.new(0, 24, 0, 24),
        Text = "×",
        TextColor3 = theme.DimText,
        TextSize = 16,
        Font = Enum.Font.GothamBold,
        Visible = false,
    })
    
    -- Input events
    self.Connections[#self.Connections + 1] = self.Input:GetPropertyChangedSignal("Text"):Connect(function()
        self.Value = self.Input.Text
        self.ClearButton.Visible = #self.Value > 0
        
        task.spawn(function()
            self.Callback(self.Value)
        end)
    end)
    
    self.Connections[#self.Connections + 1] = self.Input.Focused:Connect(function()
        AnimationManager:Tween(self.FrameStroke, "Quick", {
            Color = theme.InputBorderFocused,
        })
    end)
    
    self.Connections[#self.Connections + 1] = self.Input.FocusLost:Connect(function()
        AnimationManager:Tween(self.FrameStroke, "Quick", {
            Color = theme.InputBorder,
        })
    end)
    
    -- Clear button
    self.Connections[#self.Connections + 1] = self.ClearButton.MouseButton1Click:Connect(function()
        self.Input.Text = ""
        self.Input:CaptureFocus()
    end)
    
    -- Register for theme updates
    self.ThemeUnregister = ThemeManager:RegisterElement(self.Frame, function(newTheme)
        self.Frame.BackgroundColor3 = newTheme.InputBackground
        self.FrameStroke.Color = newTheme.InputBorder
        self.SearchIcon.TextColor3 = newTheme.DimText
        self.Input.TextColor3 = newTheme.Text
        self.Input.PlaceholderColor3 = newTheme.DimText
        self.ClearButton.TextColor3 = newTheme.DimText
    end)
    
    return self
end

function SearchBarElement:SetValue(value)
    self.Input.Text = value
end

function SearchBarElement:GetValue()
    return self.Value
end

function SearchBarElement:Clear()
    self.Input.Text = ""
end

function SearchBarElement:Destroy()
    if self.ThemeUnregister then
        self.ThemeUnregister()
    end
    for _, connection in ipairs(self.Connections) do
        connection:Disconnect()
    end
    self.Frame:Destroy()
end

--[[
    IMAGE ELEMENT
]]
local ImageElement = {}
ImageElement.__index = ImageElement

function ImageElement.new(parent, options)
    local self = setmetatable({}, ImageElement)
    
    self.Options = options or {}
    self.Image = options.Image or ""
    self.Size = options.Size or UDim2.new(1, 0, 0, 100)
    self.Connections = {}
    
    local theme = ThemeManager:GetTheme()
    
    -- Main frame
    self.Frame = Utility.Create("Frame", {
        Parent = parent,
        BackgroundColor3 = theme.ElementBackground,
        Size = self.Size,
    })
    
    Utility.Create("UICorner", {
        Parent = self.Frame,
        CornerRadius = UDim.new(0, 8),
    })
    
    -- Image
    self.ImageLabel = Utility.Create("ImageLabel", {
        Parent = self.Frame,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, -20, 1, -20),
        Position = UDim2.new(0.5, 0, 0.5, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Image = self.Image,
        ScaleType = Enum.ScaleType.Fit,
    })
    
    Utility.Create("UICorner", {
        Parent = self.ImageLabel,
        CornerRadius = UDim.new(0, 6),
    })
    
    -- Register for theme updates
    self.ThemeUnregister = ThemeManager:RegisterElement(self.Frame, function(newTheme)
        self.Frame.BackgroundColor3 = newTheme.ElementBackground
    end)
    
    return self
end

function ImageElement:SetImage(image)
    self.Image = image
    self.ImageLabel.Image = image
end

function ImageElement:Destroy()
    if self.ThemeUnregister then
        self.ThemeUnregister()
    end
    for _, connection in ipairs(self.Connections) do
        connection:Disconnect()
    end
    self.Frame:Destroy()
end

--[[
    DIVIDER ELEMENT
]]
local DividerElement = {}
DividerElement.__index = DividerElement

function DividerElement.new(parent, options)
    local self = setmetatable({}, DividerElement)
    
    self.Options = options or {}
    self.Text = options.Text
    self.Connections = {}
    
    local theme = ThemeManager:GetTheme()
    
    -- Main frame
    self.Frame = Utility.Create("Frame", {
        Parent = parent,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, self.Text and 30 or 16),
    })
    
    if self.Text then
        -- Left line
        self.LeftLine = Utility.Create("Frame", {
            Parent = self.Frame,
            BackgroundColor3 = theme.Divider,
            Size = UDim2.new(0.3, -10, 0, 1),
            Position = UDim2.new(0, 12, 0.5, 0),
            AnchorPoint = Vector2.new(0, 0.5),
        })
        
        -- Text
        self.TextLabel = Utility.Create("TextLabel", {
            Parent = self.Frame,
            BackgroundTransparency = 1,
            Size = UDim2.new(0.4, 0, 1, 0),
            Position = UDim2.new(0.3, 0, 0, 0),
            Text = self.Text,
            TextColor3 = theme.DimText,
            TextSize = 11,
            Font = Enum.Font.GothamMedium,
        })
        
        -- Right line
        self.RightLine = Utility.Create("Frame", {
            Parent = self.Frame,
            BackgroundColor3 = theme.Divider,
            Size = UDim2.new(0.3, -10, 0, 1),
            Position = UDim2.new(1, -12, 0.5, 0),
            AnchorPoint = Vector2.new(1, 0.5),
        })
    else
        -- Simple line
        self.Line = Utility.Create("Frame", {
            Parent = self.Frame,
            BackgroundColor3 = theme.Divider,
            Size = UDim2.new(1, -24, 0, 1),
            Position = UDim2.new(0.5, 0, 0.5, 0),
            AnchorPoint = Vector2.new(0.5, 0.5),
        })
    end
    
    -- Register for theme updates
    self.ThemeUnregister = ThemeManager:RegisterElement(self.Frame, function(newTheme)
        if self.Text then
            self.LeftLine.BackgroundColor3 = newTheme.Divider
            self.RightLine.BackgroundColor3 = newTheme.Divider
            self.TextLabel.TextColor3 = newTheme.DimText
        else
            self.Line.BackgroundColor3 = newTheme.Divider
        end
    end)
    
    return self
end

function DividerElement:Destroy()
    if self.ThemeUnregister then
        self.ThemeUnregister()
    end
    for _, connection in ipairs(self.Connections) do
        connection:Disconnect()
    end
    self.Frame:Destroy()
end

--[[
    =====================================================
    SECTION CLASS
    =====================================================
]]

local Section = {}
Section.__index = Section

function Section.new(parent, options)
    local self = setmetatable({}, Section)
    
    self.Options = options or {}
    self.Name = options.Name or "Section"
    self.Elements = {}
    self.Connections = {}
    
    local theme = ThemeManager:GetTheme()
    
    -- Main frame
    self.Frame = Utility.Create("Frame", {
        Parent = parent,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
    })
    
    Utility.Create("UIListLayout", {
        Parent = self.Frame,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 8),
    })
    
    -- Section header
    self.Header = Utility.Create("TextLabel", {
        Parent = self.Frame,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 24),
        Text = self.Name:upper(),
        TextColor3 = theme.DimText,
        TextSize = 11,
        Font = Enum.Font.GothamBold,
        TextXAlignment = Enum.TextXAlignment.Left,
        LayoutOrder = 0,
    })
    
    Utility.Create("UIPadding", {
        Parent = self.Header,
        PaddingLeft = UDim.new(0, 4),
    })
    
    -- Elements container
    self.ElementsContainer = Utility.Create("Frame", {
        Parent = self.Frame,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        LayoutOrder = 1,
    })
    
    Utility.Create("UIListLayout", {
        Parent = self.ElementsContainer,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 6),
    })
    
    -- Register for theme updates
    self.ThemeUnregister = ThemeManager:RegisterElement(self.Frame, function(newTheme)
        self.Header.TextColor3 = newTheme.DimText
    end)
    
    return self
end

function Section:AddButton(name, callback)
    local element = ButtonElement.new(self.ElementsContainer, {
        Name = name,
        Callback = callback,
    })
    element.Frame.LayoutOrder = #self.Elements + 1
    table.insert(self.Elements, element)
    return element
end

function Section:AddToggle(name, default, callback, configId)
    local element = ToggleElement.new(self.ElementsContainer, {
        Name = name,
        Default = default,
        Callback = callback,
        ConfigId = configId,
    })
    element.Frame.LayoutOrder = #self.Elements + 1
    table.insert(self.Elements, element)
    return element
end

function Section:AddSlider(name, min, max, default, callback, options)
    options = options or {}
    local element = SliderElement.new(self.ElementsContainer, {
        Name = name,
        Min = min,
        Max = max,
        Default = default,
        Increment = options.Increment or 1,
        Suffix = options.Suffix or "",
        Callback = callback,
        ConfigId = options.ConfigId,
    })
    element.Frame.LayoutOrder = #self.Elements + 1
    table.insert(self.Elements, element)
    return element
end

function Section:AddDropdown(name, items, callback, options)
    options = options or {}
    local element = DropdownElement.new(self.ElementsContainer, {
        Name = name,
        Items = items,
        Default = options.Default,
        Multi = options.Multi or false,
        Callback = callback,
        ConfigId = options.ConfigId,
    })
    element.Frame.LayoutOrder = #self.Elements + 1
    table.insert(self.Elements, element)
    return element
end

function Section:AddTextbox(name, options)
    options = options or {}
    local element = TextboxElement.new(self.ElementsContainer, {
        Name = name,
        Default = options.Default or "",
        Placeholder = options.Placeholder or "Enter text...",
        ClearOnFocus = options.ClearOnFocus or false,
        Callback = options.Callback or function() end,
        ConfigId = options.ConfigId,
    })
    element.Frame.LayoutOrder = #self.Elements + 1
    table.insert(self.Elements, element)
    return element
end

function Section:AddKeybind(name, options)
    options = options or {}
    local element = KeybindElement.new(self.ElementsContainer, {
        Name = name,
        Default = options.Default,
        Callback = options.Callback or function() end,
        OnChanged = options.OnChanged or function() end,
        ConfigId = options.ConfigId,
    })
    element.Frame.LayoutOrder = #self.Elements + 1
    table.insert(self.Elements, element)
    return element
end

function Section:AddLabel(text)
    local element = LabelElement.new(self.ElementsContainer, {
        Text = text,
    })
    element.Frame.LayoutOrder = #self.Elements + 1
    table.insert(self.Elements, element)
    return element
end

function Section:AddParagraph(title, content)
    local element = ParagraphElement.new(self.ElementsContainer, {
        Title = title,
        Content = content,
    })
    element.Frame.LayoutOrder = #self.Elements + 1
    table.insert(self.Elements, element)
    return element
end

function Section:AddColorPicker(name, default, callback, configId)
    local element = ColorPickerElement.new(self.ElementsContainer, {
        Name = name,
        Default = default or Color3.fromRGB(255, 255, 255),
        Callback = callback or function() end,
        ConfigId = configId,
    })
    element.Frame.LayoutOrder = #self.Elements + 1
    table.insert(self.Elements, element)
    return element
end

function Section:AddProgressBar(name, options)
    options = options or {}
    local element = ProgressBarElement.new(self.ElementsContainer, {
        Name = name,
        Default = options.Default or 0,
        Max = options.Max or 100,
        ShowPercentage = options.ShowPercentage ~= false,
    })
    element.Frame.LayoutOrder = #self.Elements + 1
    table.insert(self.Elements, element)
    return element
end

function Section:AddSearchBar(options)
    options = options or {}
    local element = SearchBarElement.new(self.ElementsContainer, {
        Placeholder = options.Placeholder or "Search...",
        Callback = options.Callback or function() end,
    })
    element.Frame.LayoutOrder = #self.Elements + 1
    table.insert(self.Elements, element)
    return element
end

function Section:AddImage(image, size)
    local element = ImageElement.new(self.ElementsContainer, {
        Image = image,
        Size = size or UDim2.new(1, 0, 0, 100),
    })
    element.Frame.LayoutOrder = #self.Elements + 1
    table.insert(self.Elements, element)
    return element
end

function Section:AddDivider(text)
    local element = DividerElement.new(self.ElementsContainer, {
        Text = text,
    })
    element.Frame.LayoutOrder = #self.Elements + 1
    table.insert(self.Elements, element)
    return element
end

function Section:Destroy()
    if self.ThemeUnregister then
        self.ThemeUnregister()
    end
    for _, element in ipairs(self.Elements) do
        element:Destroy()
    end
    for _, connection in ipairs(self.Connections) do
        connection:Disconnect()
    end
    self.Frame:Destroy()
end

--[[
    =====================================================
    TAB CLASS
    =====================================================
]]

local Tab = {}
Tab.__index = Tab

function Tab.new(parent, tabButtonParent, options, isFirst)
    local self = setmetatable({}, Tab)
    
    self.Options = options or {}
    self.Name = options.Name or "Tab"
    self.Icon = options.Icon
    self.Sections = {}
    self.Connections = {}
    self.IsActive = isFirst or false
    
    local theme = ThemeManager:GetTheme()
    
    -- Tab button
    self.TabButton = Utility.Create("TextButton", {
        Parent = tabButtonParent,
        BackgroundColor3 = self.IsActive and theme.TabActive or theme.TabInactive,
        Size = UDim2.new(1, 0, 0, 36),
        Text = "",
        AutoButtonColor = false,
    })
    
    Utility.Create("UICorner", {
        Parent = self.TabButton,
        CornerRadius = UDim.new(0, 8),
    })
    
    -- Active indicator
    self.ActiveIndicator = Utility.Create("Frame", {
        Parent = self.TabButton,
        BackgroundColor3 = theme.Accent,
        Size = UDim2.new(0, 3, 0.6, 0),
        Position = UDim2.new(0, 0, 0.2, 0),
        Visible = self.IsActive,
    })
    
    Utility.Create("UICorner", {
        Parent = self.ActiveIndicator,
        CornerRadius = UDim.new(0, 2),
    })
    
    -- Tab icon (if provided)
    local labelOffset = 12
    if self.Icon then
        self.TabIcon = Utility.Create("TextLabel", {
            Parent = self.TabButton,
            BackgroundTransparency = 1,
            Size = UDim2.new(0, 20, 0, 20),
            Position = UDim2.new(0, 12, 0.5, 0),
            AnchorPoint = Vector2.new(0, 0.5),
            Text = self.Icon,
            TextColor3 = self.IsActive and theme.Text or theme.SubText,
            TextSize = 14,
            Font = Enum.Font.Gotham,
        })
        labelOffset = 38
    end
    
    -- Tab label
    self.TabLabel = Utility.Create("TextLabel", {
        Parent = self.TabButton,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, -labelOffset - 10, 1, 0),
        Position = UDim2.new(0, labelOffset, 0, 0),
        Text = self.Name,
        TextColor3 = self.IsActive and theme.Text or theme.SubText,
        TextSize = 13,
        Font = Enum.Font.GothamMedium,
        TextXAlignment = Enum.TextXAlignment.Left,
    })
    
    -- Tab content container
    self.ContentFrame = Utility.Create("ScrollingFrame", {
        Parent = parent,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        CanvasSize = UDim2.new(0, 0, 0, 0),
        ScrollBarThickness = 4,
        ScrollBarImageColor3 = theme.ScrollBar,
        AutomaticCanvasSize = Enum.AutomaticSize.Y,
        Visible = self.IsActive,
    })
    
    Utility.Create("UIListLayout", {
        Parent = self.ContentFrame,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 16),
    })
    
    Utility.Create("UIPadding", {
        Parent = self.ContentFrame,
        PaddingTop = UDim.new(0, 12),
        PaddingBottom = UDim.new(0, 12),
        PaddingLeft = UDim.new(0, 12),
        PaddingRight = UDim.new(0, 12),
    })
    
    -- Hover effect
    self.Connections[#self.Connections + 1] = self.TabButton.MouseEnter:Connect(function()
        if not self.IsActive then
            AnimationManager:Tween(self.TabButton, "Quick", {
                BackgroundColor3 = theme.Hover,
            })
        end
    end)
    
    self.Connections[#self.Connections + 1] = self.TabButton.MouseLeave:Connect(function()
        if not self.IsActive then
            AnimationManager:Tween(self.TabButton, "Quick", {
                BackgroundColor3 = theme.TabInactive,
            })
        end
    end)
    
    -- Register for theme updates
    self.ThemeUnregister = ThemeManager:RegisterElement(self.TabButton, function(newTheme)
        self.TabButton.BackgroundColor3 = self.IsActive and newTheme.TabActive or newTheme.TabInactive
        self.TabLabel.TextColor3 = self.IsActive and newTheme.Text or newTheme.SubText
        self.ActiveIndicator.BackgroundColor3 = newTheme.Accent
        if self.TabIcon then
            self.TabIcon.TextColor3 = self.IsActive and newTheme.Text or newTheme.SubText
        end
        self.ContentFrame.ScrollBarImageColor3 = newTheme.ScrollBar
    end)
    
    return self
end

function Tab:SetActive(active)
    self.IsActive = active
    local theme = ThemeManager:GetTheme()
    
    self.ContentFrame.Visible = active
    self.ActiveIndicator.Visible = active
    
    AnimationManager:Tween(self.TabButton, "Quick", {
        BackgroundColor3 = active and theme.TabActive or theme.TabInactive,
    })
    
    AnimationManager:Tween(self.TabLabel, "Quick", {
        TextColor3 = active and theme.Text or theme.SubText,
    })
    
    if self.TabIcon then
        AnimationManager:Tween(self.TabIcon, "Quick", {
            TextColor3 = active and theme.Text or theme.SubText,
        })
    end
end

function Tab:CreateSection(name)
    local section = Section.new(self.ContentFrame, {
        Name = name,
    })
    section.Frame.LayoutOrder = #self.Sections + 1
    table.insert(self.Sections, section)
    return section
end

function Tab:GetButtonClickedSignal()
    return self.TabButton.MouseButton1Click
end

function Tab:Destroy()
    if self.ThemeUnregister then
        self.ThemeUnregister()
    end
    for _, section in ipairs(self.Sections) do
        section:Destroy()
    end
    for _, connection in ipairs(self.Connections) do
        connection:Disconnect()
    end
    self.TabButton:Destroy()
    self.ContentFrame:Destroy()
end

--[[
    =====================================================
    WINDOW CLASS
    =====================================================
]]

local Window = {}
Window.__index = Window

function Window.new(screenGui, options)
    local self = setmetatable({}, Window)
    
    self.Options = options or {}
    self.Title = options.Title or "Window"
    self.Subtitle = options.Subtitle or ""
    self.Size = options.Size or UDim2.new(0, 550, 0, 400)
    self.MinSize = options.MinSize or Vector2.new(400, 300)
    self.Keybind = options.Keybind or Enum.KeyCode.RightShift
    self.Tabs = {}
    self.ActiveTab = nil
    self.Connections = {}
    self.IsVisible = true
    self.IsDragging = false
    self.DragStart = nil
    self.StartPos = nil
    self.IsMinimized = false
    
    local theme = ThemeManager:GetTheme()
    
    -- Main window frame
    self.Frame = Utility.Create("Frame", {
        Parent = screenGui,
        BackgroundColor3 = theme.Background,
        Size = self.Size,
        Position = UDim2.new(0.5, 0, 0.5, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        ClipsDescendants = true,
    })
    
    Utility.Create("UICorner", {
        Parent = self.Frame,
        CornerRadius = UDim.new(0, 12),
    })
    
    -- Shadow
    self.Shadow = Utility.Create("ImageLabel", {
        Parent = self.Frame,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 50, 1, 50),
        Position = UDim2.new(0.5, 0, 0.5, 5),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Image = "rbxassetid://5554236805",
        ImageColor3 = theme.Shadow,
        ImageTransparency = 0.5,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(23, 23, 277, 277),
        ZIndex = -1,
    })
    
    -- Title bar
    self.TitleBar = Utility.Create("Frame", {
        Parent = self.Frame,
        BackgroundColor3 = theme.SecondaryBackground,
        Size = UDim2.new(1, 0, 0, 50),
    })
    
    Utility.Create("UICorner", {
        Parent = self.TitleBar,
        CornerRadius = UDim.new(0, 12),
    })
    
    -- Bottom cover for title bar corners
    Utility.Create("Frame", {
        Parent = self.TitleBar,
        BackgroundColor3 = theme.SecondaryBackground,
        Size = UDim2.new(1, 0, 0, 12),
        Position = UDim2.new(0, 0, 1, -12),
    })
    
    -- Title text container
    local titleContainer = Utility.Create("Frame", {
        Parent = self.TitleBar,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, -100, 1, 0),
        Position = UDim2.new(0, 16, 0, 0),
    })
    
    -- Title
    self.TitleLabel = Utility.Create("TextLabel", {
        Parent = titleContainer,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 24),
        Position = UDim2.new(0, 0, 0, self.Subtitle ~= "" and 8 or 13),
        Text = self.Title,
        TextColor3 = theme.Text,
        TextSize = 16,
        Font = Enum.Font.GothamBold,
        TextXAlignment = Enum.TextXAlignment.Left,
    })
    
    -- Subtitle
    if self.Subtitle ~= "" then
        self.SubtitleLabel = Utility.Create("TextLabel", {
            Parent = titleContainer,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 0, 16),
            Position = UDim2.new(0, 0, 0, 30),
            Text = self.Subtitle,
            TextColor3 = theme.SubText,
            TextSize = 12,
            Font = Enum.Font.Gotham,
            TextXAlignment = Enum.TextXAlignment.Left,
        })
    end
    
    -- Window controls container
    local controlsContainer = Utility.Create("Frame", {
        Parent = self.TitleBar,
        BackgroundTransparency = 1,
        AnchorPoint = Vector2.new(1, 0.5),
        Position = UDim2.new(1, -12, 0.5, 0),
        Size = UDim2.new(0, 80, 0, 30),
    })
    
    Utility.Create("UIListLayout", {
        Parent = controlsContainer,
        FillDirection = Enum.FillDirection.Horizontal,
        HorizontalAlignment = Enum.HorizontalAlignment.Right,
        Padding = UDim.new(0, 8),
    })
    
    -- Minimize button
    self.MinimizeButton = Utility.Create("TextButton", {
        Parent = controlsContainer,
        BackgroundColor3 = theme.ElementBackground,
        Size = UDim2.new(0, 30, 0, 30),
        Text = "—",
        TextColor3 = theme.SubText,
        TextSize = 14,
        Font = Enum.Font.GothamBold,
        AutoButtonColor = false,
        LayoutOrder = 1,
    })
    
    Utility.Create("UICorner", {
        Parent = self.MinimizeButton,
        CornerRadius = UDim.new(0, 6),
    })
    
    -- Close button
    self.CloseButton = Utility.Create("TextButton", {
        Parent = controlsContainer,
        BackgroundColor3 = theme.ElementBackground,
        Size = UDim2.new(0, 30, 0, 30),
        Text = "×",
        TextColor3 = theme.SubText,
        TextSize = 18,
        Font = Enum.Font.GothamBold,
        AutoButtonColor = false,
        LayoutOrder = 2,
    })
    
    Utility.Create("UICorner", {
        Parent = self.CloseButton,
        CornerRadius = UDim.new(0, 6),
    })
    
    -- Content container
    self.ContentContainer = Utility.Create("Frame", {
        Parent = self.Frame,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, -50),
        Position = UDim2.new(0, 0, 0, 50),
    })
    
    -- Sidebar
    self.Sidebar = Utility.Create("Frame", {
        Parent = self.ContentContainer,
        BackgroundColor3 = theme.SecondaryBackground,
        Size = UDim2.new(0, 160, 1, 0),
    })
    
    -- Tab buttons container
    self.TabButtonsContainer = Utility.Create("ScrollingFrame", {
        Parent = self.Sidebar,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, -20),
        Position = UDim2.new(0, 0, 0, 10),
        CanvasSize = UDim2.new(0, 0, 0, 0),
        ScrollBarThickness = 2,
        ScrollBarImageColor3 = theme.ScrollBar,
        AutomaticCanvasSize = Enum.AutomaticSize.Y,
    })
    
    Utility.Create("UIListLayout", {
        Parent = self.TabButtonsContainer,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 4),
    })
    
    Utility.Create("UIPadding", {
        Parent = self.TabButtonsContainer,
        PaddingTop = UDim.new(0, 0),
        PaddingBottom = UDim.new(0, 10),
        PaddingLeft = UDim.new(0, 8),
        PaddingRight = UDim.new(0, 8),
    })
    
    -- Tab content area
    self.TabContentArea = Utility.Create("Frame", {
        Parent = self.ContentContainer,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, -160, 1, 0),
        Position = UDim2.new(0, 160, 0, 0),
    })
    
    -- Dragging functionality
    self.Connections[#self.Connections + 1] = self.TitleBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            self.IsDragging = true
            self.DragStart = input.Position
            self.StartPos = self.Frame.Position
        end
    end)
    
    self.Connections[#self.Connections + 1] = UserInputService.InputChanged:Connect(function(input)
        if self.IsDragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local delta = input.Position - self.DragStart
            self.Frame.Position = UDim2.new(
                self.StartPos.X.Scale,
                self.StartPos.X.Offset + delta.X,
                self.StartPos.Y.Scale,
                self.StartPos.Y.Offset + delta.Y
            )
        end
    end)
    
    self.Connections[#self.Connections + 1] = UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            self.IsDragging = false
        end
    end)
    
    -- Minimize button handler
    self.Connections[#self.Connections + 1] = self.MinimizeButton.MouseButton1Click:Connect(function()
        self:ToggleMinimize()
    end)
    
    -- Minimize button hover
    self.Connections[#self.Connections + 1] = self.MinimizeButton.MouseEnter:Connect(function()
        AnimationManager:Tween(self.MinimizeButton, "Quick", {
            BackgroundColor3 = theme.Warning,
        })
        AnimationManager:Tween(self.MinimizeButton, "Quick", {
            TextColor3 = Color3.fromRGB(255, 255, 255),
        })
    end)
    
    self.Connections[#self.Connections + 1] = self.MinimizeButton.MouseLeave:Connect(function()
        AnimationManager:Tween(self.MinimizeButton, "Quick", {
            BackgroundColor3 = theme.ElementBackground,
        })
        AnimationManager:Tween(self.MinimizeButton, "Quick", {
            TextColor3 = theme.SubText,
        })
    end)
    
    -- Close button handler
    self.Connections[#self.Connections + 1] = self.CloseButton.MouseButton1Click:Connect(function()
        self:Hide()
    end)
    
    -- Close button hover
    self.Connections[#self.Connections + 1] = self.CloseButton.MouseEnter:Connect(function()
        AnimationManager:Tween(self.CloseButton, "Quick", {
            BackgroundColor3 = theme.Error,
        })
        AnimationManager:Tween(self.CloseButton, "Quick", {
            TextColor3 = Color3.fromRGB(255, 255, 255),
        })
    end)
    
    self.Connections[#self.Connections + 1] = self.CloseButton.MouseLeave:Connect(function()
        AnimationManager:Tween(self.CloseButton, "Quick", {
            BackgroundColor3 = theme.ElementBackground,
        })
        AnimationManager:Tween(self.CloseButton, "Quick", {
            TextColor3 = theme.SubText,
        })
    end)
    
    -- Keybind toggle
    self.Connections[#self.Connections + 1] = UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if not gameProcessed and input.UserInputType == Enum.UserInputType.Keyboard then
            if input.KeyCode == self.Keybind then
                self:Toggle()
            end
        end
    end)
    
    -- Register for theme updates
    self.ThemeUnregister = ThemeManager:RegisterElement(self.Frame, function(newTheme)
        self.Frame.BackgroundColor3 = newTheme.Background
        self.Shadow.ImageColor3 = newTheme.Shadow
        self.TitleBar.BackgroundColor3 = newTheme.SecondaryBackground
        self.TitleLabel.TextColor3 = newTheme.Text
        if self.SubtitleLabel then
            self.SubtitleLabel.TextColor3 = newTheme.SubText
        end
        self.Sidebar.BackgroundColor3 = newTheme.SecondaryBackground
        self.MinimizeButton.BackgroundColor3 = newTheme.ElementBackground
        self.MinimizeButton.TextColor3 = newTheme.SubText
        self.CloseButton.BackgroundColor3 = newTheme.ElementBackground
        self.CloseButton.TextColor3 = newTheme.SubText
    end)
    
    return self
end

function Window:CreateTab(name, icon)
    local isFirst = #self.Tabs == 0
    local tab = Tab.new(self.TabContentArea, self.TabButtonsContainer, {
        Name = name,
        Icon = icon,
    }, isFirst)
    
    tab.TabButton.LayoutOrder = #self.Tabs + 1
    
    -- Tab click handler
    self.Connections[#self.Connections + 1] = tab:GetButtonClickedSignal():Connect(function()
        self:SelectTab(tab)
    end)
    
    if isFirst then
        self.ActiveTab = tab
    end
    
    table.insert(self.Tabs, tab)
    return tab
end

function Window:SelectTab(tab)
    if self.ActiveTab then
        self.ActiveTab:SetActive(false)
    end
    
    tab:SetActive(true)
    self.ActiveTab = tab
end

function Window:Show()
    self.IsVisible = true
    self.Frame.Visible = true
    
    -- Animate in
    self.Frame.Size = UDim2.new(0, 0, 0, 0)
    self.Frame.BackgroundTransparency = 1
    
    AnimationManager:Tween(self.Frame, "Bounce", {
        Size = self.Size,
        BackgroundTransparency = 0,
    })
end

function Window:Hide()
    self.IsVisible = false
    
    AnimationManager:Tween(self.Frame, "Quick", {
        Size = UDim2.new(0, 0, 0, 0),
        BackgroundTransparency = 1,
    }, function()
        self.Frame.Visible = false
        self.Frame.Size = self.Size
        self.Frame.BackgroundTransparency = 0
    end)
end

function Window:Toggle()
    if self.IsVisible then
        self:Hide()
    else
        self:Show()
    end
end

function Window:ToggleMinimize()
    self.IsMinimized = not self.IsMinimized
    
    if self.IsMinimized then
        AnimationManager:Tween(self.Frame, "Smooth", {
            Size = UDim2.new(0, self.Size.X.Offset, 0, 50),
        })
        self.ContentContainer.Visible = false
        self.MinimizeButton.Text = "+"
    else
        AnimationManager:Tween(self.Frame, "Smooth", {
            Size = self.Size,
        })
        self.ContentContainer.Visible = true
        self.MinimizeButton.Text = "—"
    end
end

function Window:SetTitle(title)
    self.Title = title
    self.TitleLabel.Text = title
end

function Window:SetSubtitle(subtitle)
    self.Subtitle = subtitle
    if self.SubtitleLabel then
        self.SubtitleLabel.Text = subtitle
    end
end

function Window:Destroy()
    if self.ThemeUnregister then
        self.ThemeUnregister()
    end
    for _, tab in ipairs(self.Tabs) do
        tab:Destroy()
    end
    for _, connection in ipairs(self.Connections) do
        connection:Disconnect()
    end
    self.Frame:Destroy()
end

--[[
    =====================================================
    MOBILE TOGGLE BUTTON
    =====================================================
]]

local MobileToggle = {}
MobileToggle.__index = MobileToggle

function MobileToggle.new(screenGui, window)
    local self = setmetatable({}, MobileToggle)
    
    self.Window = window
    self.Connections = {}
    self.IsDragging = false
    
    local theme = ThemeManager:GetTheme()
    
    -- Toggle button
    self.Button = Utility.Create("ImageButton", {
        Parent = screenGui,
        BackgroundColor3 = theme.Accent,
        Size = UDim2.new(0, 50, 0, 50),
        Position = UDim2.new(0, 20, 0.5, 0),
        AnchorPoint = Vector2.new(0, 0.5),
        AutoButtonColor = false,
        Visible = IsMobile or IsTablet,
    })
    
    Utility.Create("UICorner", {
        Parent = self.Button,
        CornerRadius = UDim.new(1, 0),
    })
    
    -- Icon
    self.Icon = Utility.Create("TextLabel", {
        Parent = self.Button,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        Text = "☰",
        TextColor3 = Color3.fromRGB(255, 255, 255),
        TextSize = 24,
        Font = Enum.Font.GothamBold,
    })
    
    -- Shadow
    Utility.Create("ImageLabel", {
        Parent = self.Button,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 20, 1, 20),
        Position = UDim2.new(0.5, 0, 0.5, 3),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Image = "rbxassetid://5554236805",
        ImageColor3 = Color3.fromRGB(0, 0, 0),
        ImageTransparency = 0.6,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(23, 23, 277, 277),
        ZIndex = -1,
    })
    
    -- Click handler
    self.Connections[#self.Connections + 1] = self.Button.MouseButton1Click:Connect(function()
        if not self.IsDragging then
            window:Toggle()
        end
    end)
    
    -- Drag functionality
    local dragStart, startPos
    
    self.Connections[#self.Connections + 1] = self.Button.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch then
            dragStart = input.Position
            startPos = self.Button.Position
        end
    end)
    
    self.Connections[#self.Connections + 1] = UserInputService.InputChanged:Connect(function(input)
        if dragStart and input.UserInputType == Enum.UserInputType.Touch then
            local delta = input.Position - dragStart
            if delta.Magnitude > 10 then
                self.IsDragging = true
                self.Button.Position = UDim2.new(
                    startPos.X.Scale,
                    startPos.X.Offset + delta.X,
                    startPos.Y.Scale,
                    startPos.Y.Offset + delta.Y
                )
            end
        end
    end)
    
    self.Connections[#self.Connections + 1] = UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch then
            dragStart = nil
            task.delay(0.1, function()
                self.IsDragging = false
            end)
        end
    end)
    
    -- Register for theme updates
    self.ThemeUnregister = ThemeManager:RegisterElement(self.Button, function(newTheme)
        self.Button.BackgroundColor3 = newTheme.Accent
    end)
    
    return self
end

function MobileToggle:SetVisible(visible)
    self.Button.Visible = visible
end

function MobileToggle:Destroy()
    if self.ThemeUnregister then
        self.ThemeUnregister()
    end
    for _, connection in ipairs(self.Connections) do
        connection:Disconnect()
    end
    self.Button:Destroy()
end

--[[
    =====================================================
    MAIN LIBRARY
    =====================================================
]]

function AdvancedUILibrary:CreateWindow(options)
    options = options or {}
    
    -- Initialize theme
    if options.Theme then
        ThemeManager:Initialize(options.Theme)
    else
        ThemeManager:Initialize("Dark")
    end
    
    -- Set accent color if provided
    if options.AccentColor then
        ThemeManager:SetAccentColor(options.AccentColor)
    end
    
    -- Initialize config system
    if options.SaveConfig then
        ConfigManager:Initialize(options.ConfigFolder or "AdvancedUILibrary", options.AutoSave)
    end
    
    -- Create ScreenGui
    local screenGui = Utility.Create("ScreenGui", {
        Name = "AdvancedUILibrary_" .. Utility.GenerateUID(),
        ResetOnSpawn = false,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
    })
    
    -- Try to parent to CoreGui, fallback to PlayerGui
    local success = pcall(function()
        screenGui.Parent = CoreGui
    end)
    
    if not success then
        screenGui.Parent = PlayerGui
    end
    
    -- Store reference
    self.ScreenGui = screenGui
    
    -- Initialize notification system
    NotificationManager:Initialize(screenGui)
    
    -- Create window
    local window = Window.new(screenGui, {
        Title = options.Title or "Advanced UI Library",
        Subtitle = options.Subtitle or "",
        Size = options.Size or UDim2.new(0, 550, 0, 400),
        Keybind = options.Keybind or Enum.KeyCode.RightShift,
    })
    
    -- Create mobile toggle
    if IsMobile or IsTablet then
        self.MobileToggle = MobileToggle.new(screenGui, window)
    end
    
    -- Store window reference
    self.Window = window
    
    return window
end

-- Theme API
function AdvancedUILibrary:SetTheme(theme)
    return ThemeManager:SetTheme(theme)
end

function AdvancedUILibrary:SetAccentColor(color)
    return ThemeManager:SetAccentColor(color)
end

function AdvancedUILibrary:GetTheme()
    return ThemeManager:GetTheme()
end

function AdvancedUILibrary:GetThemeNames()
    return ThemeManager:GetThemeNames()
end

function AdvancedUILibrary:AddTheme(name, themeData)
    return ThemeManager:AddTheme(name, themeData)
end

function AdvancedUILibrary:OnThemeChanged(callback)
    return ThemeManager:OnThemeChanged(callback)
end

-- Config API
function AdvancedUILibrary:SaveConfig(name)
    return ConfigManager:SaveConfig(name)
end

function AdvancedUILibrary:LoadConfig(name)
    return ConfigManager:LoadConfig(name)
end

function AdvancedUILibrary:GetConfigs()
    return ConfigManager:GetConfigs()
end

function AdvancedUILibrary:DeleteConfig(name)
    return ConfigManager:DeleteConfig(name)
end

-- Notification API
function AdvancedUILibrary:Notify(options)
    return NotificationManager:Notify(options)
end

function AdvancedUILibrary:ClearNotifications()
    NotificationManager:ClearAll()
end

-- Utility API
function AdvancedUILibrary:IsMobile()
    return IsMobile
end

function AdvancedUILibrary:IsTablet()
    return IsTablet
end

-- Cleanup
function AdvancedUILibrary:Destroy()
    AnimationManager:Cleanup()
    ConfigManager:Cleanup()
    NotificationManager:ClearAll()
    
    if self.Window then
        self.Window:Destroy()
    end
    
    if self.MobileToggle then
        self.MobileToggle:Destroy()
    end
    
    if self.ScreenGui then
        self.ScreenGui:Destroy()
    end
end

--[[
    =====================================================
    USAGE EXAMPLE
    =====================================================
]]

-- Example usage (uncomment to test)
--[[
local UILib = AdvancedUILibrary

-- Create main window
local Window = UILib:CreateWindow({
    Title = "Advanced Settings Panel",
    Subtitle = "v2.0 - Professional UI Framework",
    Theme = "Dark",
    AccentColor = Color3.fromRGB(0, 170, 255),
    Keybind = Enum.KeyCode.RightShift,
    SaveConfig = true,
    ConfigFolder = "AdvancedUILibrary",
    AutoSave = true,
})

-- Create Gameplay tab
local GameplayTab = Window:CreateTab("Gameplay", "🎮")

local ControlsSection = GameplayTab:CreateSection("Controls")

ControlsSection:AddToggle("Enable Sprint", true, function(state)
    print("Sprint:", state)
end, "gameplay_sprint")

ControlsSection:AddSlider("Mouse Sensitivity", 0.1, 5, 1, function(value)
    print("Sensitivity:", value)
end, {
    Increment = 0.1,
    Suffix = "x",
    ConfigId = "gameplay_sensitivity",
})

ControlsSection:AddKeybind("Sprint Key", {
    Default = Enum.KeyCode.LeftShift,
    Callback = function(key)
        print("Sprint pressed!")
    end,
    OnChanged = function(key)
        print("Sprint key changed to:", key.Name)
    end,
    ConfigId = "gameplay_sprintkey",
})

ControlsSection:AddDropdown("Difficulty", {"Easy", "Normal", "Hard", "Expert"}, function(value)
    print("Difficulty:", value)
end, {
    Default = "Normal",
    ConfigId = "gameplay_difficulty",
})

local GraphicsSection = GameplayTab:CreateSection("Graphics")

GraphicsSection:AddSlider("Render Distance", 100, 1000, 500, function(value)
    print("Render Distance:", value)
end, {
    Suffix = " studs",
    ConfigId = "graphics_renderdistance",
})

GraphicsSection:AddDropdown("Quality Preset", {"Low", "Medium", "High", "Ultra"}, function(value)
    print("Quality:", value)
end, {
    Default = "High",
    ConfigId = "graphics_quality",
})

GraphicsSection:AddToggle("Enable Shadows", true, function(state)
    print("Shadows:", state)
end, "graphics_shadows")

GraphicsSection:AddColorPicker("Ambient Color", Color3.fromRGB(180, 180, 200), function(color)
    print("Ambient:", color)
end, "graphics_ambient")

-- Create Audio tab
local AudioTab = Window:CreateTab("Audio", "🔊")

local VolumeSection = AudioTab:CreateSection("Volume")

VolumeSection:AddSlider("Master Volume", 0, 100, 80, function(value)
    print("Master:", value .. "%")
end, {
    Suffix = "%",
    ConfigId = "audio_master",
})

VolumeSection:AddSlider("Music Volume", 0, 100, 70, function(value)
    print("Music:", value .. "%")
end, {
    Suffix = "%",
    ConfigId = "audio_music",
})

VolumeSection:AddSlider("SFX Volume", 0, 100, 90, function(value)
    print("SFX:", value .. "%")
end, {
    Suffix = "%",
    ConfigId = "audio_sfx",
})

VolumeSection:AddToggle("Enable 3D Audio", true, function(state)
    print("3D Audio:", state)
end, "audio_3d")

-- Create Interface tab
local InterfaceTab = Window:CreateTab("Interface", "⚙")

local ThemeSection = InterfaceTab:CreateSection("Theme")

ThemeSection:AddDropdown("Color Theme", UILib:GetThemeNames(), function(value)
    UILib:SetTheme(value)
end, {
    Default = "Dark",
})

ThemeSection:AddColorPicker("Accent Color", Color3.fromRGB(0, 170, 255), function(color)
    UILib:SetAccentColor(color)
end, "interface_accent")

local HUDSection = InterfaceTab:CreateSection("HUD")

HUDSection:AddToggle("Show FPS Counter", true, function(state)
    print("FPS Counter:", state)
end, "hud_fps")

HUDSection:AddToggle("Show Ping", true, function(state)
    print("Ping:", state)
end, "hud_ping")

HUDSection:AddSlider("HUD Scale", 0.5, 2, 1, function(value)
    print("HUD Scale:", value)
end, {
    Increment = 0.1,
    Suffix = "x",
    ConfigId = "hud_scale",
})

HUDSection:AddDropdown("Crosshair Style", {"Default", "Dot", "Circle", "Cross", "None"}, function(value)
    print("Crosshair:", value)
end, {
    Default = "Default",
    ConfigId = "hud_crosshair",
})

-- Create Info tab
local InfoTab = Window:CreateTab("Info", "ℹ")

local AboutSection = InfoTab:CreateSection("About")

AboutSection:AddParagraph("Advanced UI Library", "This is a professional, high-performance UI framework for Roblox. Features include smooth animations, theme support, configuration saving, and cross-platform compatibility.")

AboutSection:AddDivider("Statistics")

local statsProgress = AboutSection:AddProgressBar("Memory Usage", {
    Default = 45,
    Max = 100,
    ShowPercentage = true,
})

AboutSection:AddLabel("Version: 2.0.0")
AboutSection:AddLabel("Author: Claude Opus")

AboutSection:AddDivider()

AboutSection:AddButton("Check for Updates", function()
    UILib:Notify({
        Title = "Update Check",
        Message = "You are running the latest version!",
        Type = "Success",
        Duration = 3,
    })
end)

AboutSection:AddButton("Report Bug", function()
    UILib:Notify({
        Title = "Bug Report",
        Message = "Bug reporting is not available in this demo.",
        Type = "Warning",
        Duration = 3,
    })
end)

-- Config section
local ConfigSection = InfoTab:CreateSection("Configuration")

ConfigSection:AddTextbox("Config Name", {
    Default = "default",
    Placeholder = "Enter config name...",
    Callback = function(value)
        print("Config name:", value)
    end,
})

ConfigSection:AddButton("Save Config", function()
    local success = UILib:SaveConfig("default")
    UILib:Notify({
        Title = success and "Config Saved" or "Save Failed",
        Message = success and "Configuration saved successfully!" or "Failed to save configuration.",
        Type = success and "Success" or "Error",
        Duration = 3,
    })
end)

ConfigSection:AddButton("Load Config", function()
    local success = UILib:LoadConfig("default")
    UILib:Notify({
        Title = success and "Config Loaded" or "Load Failed",
        Message = success and "Configuration loaded successfully!" or "Failed to load configuration.",
        Type = success and "Success" or "Error",
        Duration = 3,
    })
end)

-- Show welcome notification
task.delay(1, function()
    UILib:Notify({
        Title = "Welcome!",
        Message = "Press RightShift to toggle the menu. Enjoy the Advanced UI Library!",
        Type = "Info",
        Duration = 5,
    })
end)

-- Simulate progress bar updates
task.spawn(function()
    while true do
        task.wait(2)
        local memUsage = math.random(30, 80)
        statsProgress:SetValue(memUsage)
    end
end)
]]

return AdvancedUILibrary
