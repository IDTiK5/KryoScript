local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")

local Player = Players.LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")

local UILibrary = {}
UILibrary.__index = UILibrary

local ThemeManager = {}
ThemeManager.__index = ThemeManager

local ConfigManager = {}
ConfigManager.__index = ConfigManager

local LayerManager = {}
LayerManager.__index = LayerManager

local NotificationManager = {}
NotificationManager.__index = NotificationManager

local WindowManager = {}
WindowManager.__index = WindowManager

local ActiveElementPanel = {}
ActiveElementPanel.__index = ActiveElementPanel

local Themes = {
    Dark = {
        Primary = Color3.fromRGB(25, 25, 35),
        Secondary = Color3.fromRGB(35, 35, 50),
        Tertiary = Color3.fromRGB(45, 45, 65),
        Accent = Color3.fromRGB(100, 120, 255),
        AccentDark = Color3.fromRGB(70, 90, 200),
        Text = Color3.fromRGB(255, 255, 255),
        TextDark = Color3.fromRGB(180, 180, 200),
        TextDisabled = Color3.fromRGB(100, 100, 120),
        Border = Color3.fromRGB(60, 60, 80),
        Success = Color3.fromRGB(80, 200, 120),
        Warning = Color3.fromRGB(255, 180, 60),
        Error = Color3.fromRGB(255, 80, 80),
        Shadow = Color3.fromRGB(0, 0, 0),
        Overlay = Color3.fromRGB(0, 0, 0)
    },
    Light = {
        Primary = Color3.fromRGB(245, 245, 250),
        Secondary = Color3.fromRGB(235, 235, 245),
        Tertiary = Color3.fromRGB(225, 225, 240),
        Accent = Color3.fromRGB(80, 100, 235),
        AccentDark = Color3.fromRGB(60, 80, 200),
        Text = Color3.fromRGB(20, 20, 30),
        TextDark = Color3.fromRGB(80, 80, 100),
        TextDisabled = Color3.fromRGB(150, 150, 170),
        Border = Color3.fromRGB(200, 200, 220),
        Success = Color3.fromRGB(60, 180, 100),
        Warning = Color3.fromRGB(235, 160, 40),
        Error = Color3.fromRGB(235, 60, 60),
        Shadow = Color3.fromRGB(0, 0, 0),
        Overlay = Color3.fromRGB(0, 0, 0)
    }
}

local Utility = {}

function Utility.Create(className, properties)
    local instance = Instance.new(className)
    for property, value in pairs(properties or {}) do
        if property ~= "Parent" then
            instance[property] = value
        end
    end
    if properties and properties.Parent then
        instance.Parent = properties.Parent
    end
    return instance
end

function Utility.Tween(instance, properties, duration, easingStyle, easingDirection)
    local tweenInfo = TweenInfo.new(
        duration or 0.2,
        easingStyle or Enum.EasingStyle.Quart,
        easingDirection or Enum.EasingDirection.Out
    )
    local tween = TweenService:Create(instance, tweenInfo, properties)
    tween:Play()
    return tween
end

function Utility.Ripple(button, x, y)
    local ripple = Utility.Create("Frame", {
        Name = "Ripple",
        BackgroundColor3 = Color3.fromRGB(255, 255, 255),
        BackgroundTransparency = 0.7,
        BorderSizePixel = 0,
        Position = UDim2.new(0, x - button.AbsolutePosition.X, 0, y - button.AbsolutePosition.Y),
        Size = UDim2.new(0, 0, 0, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        ZIndex = button.ZIndex + 1,
        Parent = button
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(1, 0),
        Parent = ripple
    })
    
    local maxSize = math.max(button.AbsoluteSize.X, button.AbsoluteSize.Y) * 2
    
    Utility.Tween(ripple, {Size = UDim2.new(0, maxSize, 0, maxSize)}, 0.4)
    Utility.Tween(ripple, {BackgroundTransparency = 1}, 0.4).Completed:Connect(function()
        ripple:Destroy()
    end)
end

function Utility.DeepCopy(original)
    local copy = {}
    for key, value in pairs(original) do
        if type(value) == "table" then
            copy[key] = Utility.DeepCopy(value)
        else
            copy[key] = value
        end
    end
    return copy
end

function Utility.Lerp(a, b, t)
    return a + (b - a) * t
end

function Utility.ClampNumber(value, min, max)
    return math.max(min, math.min(max, value))
end

function Utility.Round(value, decimals)
    local mult = 10 ^ (decimals or 0)
    return math.floor(value * mult + 0.5) / mult
end

function Utility.ColorToHex(color)
    return string.format("#%02X%02X%02X", 
        math.floor(color.R * 255), 
        math.floor(color.G * 255), 
        math.floor(color.B * 255)
    )
end

function Utility.HexToColor(hex)
    hex = hex:gsub("#", "")
    return Color3.fromRGB(
        tonumber(hex:sub(1, 2), 16) or 0,
        tonumber(hex:sub(3, 4), 16) or 0,
        tonumber(hex:sub(5, 6), 16) or 0
    )
end

function Utility.HSVToRGB(h, s, v)
    local r, g, b
    local i = math.floor(h * 6)
    local f = h * 6 - i
    local p = v * (1 - s)
    local q = v * (1 - f * s)
    local t = v * (1 - (1 - f) * s)
    
    i = i % 6
    
    if i == 0 then r, g, b = v, t, p
    elseif i == 1 then r, g, b = q, v, p
    elseif i == 2 then r, g, b = p, v, t
    elseif i == 3 then r, g, b = p, q, v
    elseif i == 4 then r, g, b = t, p, v
    elseif i == 5 then r, g, b = v, p, q
    end
    
    return Color3.new(r, g, b)
end

function Utility.RGBToHSV(color)
    local r, g, b = color.R, color.G, color.B
    local max, min = math.max(r, g, b), math.min(r, g, b)
    local h, s, v
    v = max
    
    local d = max - min
    if max == 0 then
        s = 0
    else
        s = d / max
    end
    
    if max == min then
        h = 0
    else
        if max == r then
            h = (g - b) / d
            if g < b then h = h + 6 end
        elseif max == g then
            h = (b - r) / d + 2
        elseif max == b then
            h = (r - g) / d + 4
        end
        h = h / 6
    end
    
    return h, s, v
end

function ThemeManager.new()
    local self = setmetatable({}, ThemeManager)
    self.CurrentTheme = "Dark"
    self.Themes = Utility.DeepCopy(Themes)
    self.Connections = {}
    self.Elements = {}
    return self
end

function ThemeManager:GetColor(colorName)
    return self.Themes[self.CurrentTheme][colorName]
end

function ThemeManager:SetTheme(themeName)
    if self.Themes[themeName] then
        self.CurrentTheme = themeName
        self:UpdateAllElements()
    end
end

function ThemeManager:RegisterElement(element, updateCallback)
    table.insert(self.Elements, {Element = element, Callback = updateCallback})
end

function ThemeManager:UnregisterElement(element)
    for i, entry in ipairs(self.Elements) do
        if entry.Element == element then
            table.remove(self.Elements, i)
            break
        end
    end
end

function ThemeManager:UpdateAllElements()
    for _, entry in ipairs(self.Elements) do
        if entry.Callback then
            entry.Callback()
        end
    end
end

function ThemeManager:CreateCustomTheme(name, colors)
    self.Themes[name] = colors
end

function ConfigManager.new(libraryInstance)
    local self = setmetatable({}, ConfigManager)
    self.Library = libraryInstance
    self.Configs = {}
    self.CurrentConfig = nil
    self.AutoSaveEnabled = false
    self.SaveFolder = "UILibraryConfigs"
    self.Elements = {}
    self.LastLoadedConfig = nil
    return self
end

function ConfigManager:RegisterElement(id, element)
    self.Elements[id] = element
end

function ConfigManager:UnregisterElement(id)
    self.Elements[id] = nil
end

function ConfigManager:SerializeValue(value)
    if typeof(value) == "Color3" then
        return {
            Type = "Color3",
            R = value.R,
            G = value.G,
            B = value.B
        }
    elseif typeof(value) == "Vector2" then
        return {
            Type = "Vector2",
            X = value.X,
            Y = value.Y
        }
    elseif typeof(value) == "Vector3" then
        return {
            Type = "Vector3",
            X = value.X,
            Y = value.Y,
            Z = value.Z
        }
    elseif typeof(value) == "UDim2" then
        return {
            Type = "UDim2",
            XScale = value.X.Scale,
            XOffset = value.X.Offset,
            YScale = value.Y.Scale,
            YOffset = value.Y.Offset
        }
    elseif typeof(value) == "EnumItem" then
        return {
            Type = "EnumItem",
            EnumType = tostring(value.EnumType),
            Name = value.Name
        }
    else
        return value
    end
end

function ConfigManager:DeserializeValue(data)
    if type(data) == "table" and data.Type then
        if data.Type == "Color3" then
            return Color3.new(data.R, data.G, data.B)
        elseif data.Type == "Vector2" then
            return Vector2.new(data.X, data.Y)
        elseif data.Type == "Vector3" then
            return Vector3.new(data.X, data.Y, data.Z)
        elseif data.Type == "UDim2" then
            return UDim2.new(data.XScale, data.XOffset, data.YScale, data.YOffset)
        elseif data.Type == "EnumItem" then
            local enumType = Enum[data.EnumType]
            if enumType then
                return enumType[data.Name]
            end
        end
    end
    return data
end

function ConfigManager:SaveConfig(name)
    local configData = {}
    
    for id, element in pairs(self.Elements) do
        if element.GetValue then
            configData[id] = self:SerializeValue(element:GetValue())
        end
    end
    
    self.Configs[name] = configData
    self.CurrentConfig = name
    
    if writefile then
        local success, err = pcall(function()
            if not isfolder(self.SaveFolder) then
                makefolder(self.SaveFolder)
            end
            writefile(self.SaveFolder .. "/" .. name .. ".json", HttpService:JSONEncode(configData))
        end)
    end
    
    if self.Library.NotificationManager then
        self.Library.NotificationManager:Notify("Config Saved", "Configuration '" .. name .. "' has been saved.", "Success", 3)
    end
    
    self:UpdateConfigList()
    
    return true
end

function ConfigManager:LoadConfig(name)
    local configData = self.Configs[name]
    
    if not configData and readfile then
        local success, data = pcall(function()
            return HttpService:JSONDecode(readfile(self.SaveFolder .. "/" .. name .. ".json"))
        end)
        if success then
            configData = data
            self.Configs[name] = configData
        end
    end
    
    if configData then
        for id, value in pairs(configData) do
            local element = self.Elements[id]
            if element and element.SetValue then
                local deserializedValue = self:DeserializeValue(value)
                element:SetValue(deserializedValue, true)
            end
        end
        
        self.CurrentConfig = name
        self.LastLoadedConfig = name
        
        if self.Library.NotificationManager then
            self.Library.NotificationManager:Notify("Config Loaded", "Configuration '" .. name .. "' has been loaded.", "Success", 3)
        end
        
        return true
    end
    
    if self.Library.NotificationManager then
        self.Library.NotificationManager:Notify("Error", "Configuration '" .. name .. "' not found.", "Error", 3)
    end
    
    return false
end

function ConfigManager:DeleteConfig(name)
    self.Configs[name] = nil
    
    if delfile then
        pcall(function()
            delfile(self.SaveFolder .. "/" .. name .. ".json")
        end)
    end
    
    if self.CurrentConfig == name then
        self.CurrentConfig = nil
    end
    
    if self.Library.NotificationManager then
        self.Library.NotificationManager:Notify("Config Deleted", "Configuration '" .. name .. "' has been deleted.", "Warning", 3)
    end
    
    self:UpdateConfigList()
    
    return true
end

function ConfigManager:GetConfigList()
    local configs = {}
    
    for name, _ in pairs(self.Configs) do
        table.insert(configs, name)
    end
    
    if listfiles then
        pcall(function()
            if isfolder(self.SaveFolder) then
                for _, file in ipairs(listfiles(self.SaveFolder)) do
                    local fileName = file:match("([^/\\]+)%.json$")
                    if fileName and not self.Configs[fileName] then
                        table.insert(configs, fileName)
                    end
                end
            end
        end)
    end
    
    return configs
end

function ConfigManager:UpdateConfigList()
    if self.ConfigListCallback then
        self.ConfigListCallback(self:GetConfigList())
    end
end

function ConfigManager:SetConfigListCallback(callback)
    self.ConfigListCallback = callback
end

function ConfigManager:AutoLoadLastConfig()
    if self.LastLoadedConfig then
        self:LoadConfig(self.LastLoadedConfig)
    end
end

function LayerManager.new(screenGui)
    local self = setmetatable({}, LayerManager)
    self.ScreenGui = screenGui
    self.ActiveOverlays = {}
    self.BaseZIndex = 100
    self.OverlayZIndex = 1000
    
    self.OverlayContainer = Utility.Create("Frame", {
        Name = "OverlayContainer",
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        ZIndex = self.OverlayZIndex,
        Parent = screenGui
    })
    
    self.ModalContainer = Utility.Create("Frame", {
        Name = "ModalContainer",
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        ZIndex = self.OverlayZIndex + 100,
        Parent = screenGui
    })
    
    self.ModalBackground = Utility.Create("TextButton", {
        Name = "ModalBackground",
        BackgroundColor3 = Color3.fromRGB(0, 0, 0),
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        Text = "",
        AutoButtonColor = false,
        ZIndex = self.OverlayZIndex + 99,
        Visible = false,
        Parent = screenGui
    })
    
    return self
end

function LayerManager:CreateOverlay(content, position, size)
    local overlay = Utility.Create("Frame", {
        Name = "Overlay",
        BackgroundTransparency = 1,
        Position = position,
        Size = size,
        ZIndex = self.OverlayZIndex + #self.ActiveOverlays,
        Parent = self.OverlayContainer
    })
    
    table.insert(self.ActiveOverlays, overlay)
    
    return overlay
end

function LayerManager:RemoveOverlay(overlay)
    for i, activeOverlay in ipairs(self.ActiveOverlays) do
        if activeOverlay == overlay then
            table.remove(self.ActiveOverlays, i)
            overlay:Destroy()
            break
        end
    end
end

function LayerManager:CloseAllOverlays()
    for _, overlay in ipairs(self.ActiveOverlays) do
        overlay:Destroy()
    end
    self.ActiveOverlays = {}
end

function LayerManager:ShowModal(content, onClose)
    self.ModalBackground.Visible = true
    Utility.Tween(self.ModalBackground, {BackgroundTransparency = 0.5}, 0.2)
    
    content.Parent = self.ModalContainer
    content.ZIndex = self.OverlayZIndex + 101
    
    local connection
    connection = self.ModalBackground.MouseButton1Click:Connect(function()
        connection:Disconnect()
        self:HideModal(content)
        if onClose then
            onClose()
        end
    end)
    
    return content
end

function LayerManager:HideModal(content)
    Utility.Tween(self.ModalBackground, {BackgroundTransparency = 1}, 0.2).Completed:Connect(function()
        self.ModalBackground.Visible = false
    end)
    
    if content then
        content:Destroy()
    end
end

function NotificationManager.new(screenGui, themeManager)
    local self = setmetatable({}, NotificationManager)
    self.ScreenGui = screenGui
    self.ThemeManager = themeManager
    self.Notifications = {}
    self.MaxNotifications = 5
    
    self.Container = Utility.Create("Frame", {
        Name = "NotificationContainer",
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -20, 1, -20),
        Size = UDim2.new(0, 300, 0, 400),
        AnchorPoint = Vector2.new(1, 1),
        ZIndex = 2000,
        Parent = screenGui
    })
    
    Utility.Create("UIListLayout", {
        SortOrder = Enum.SortOrder.LayoutOrder,
        VerticalAlignment = Enum.VerticalAlignment.Bottom,
        Padding = UDim.new(0, 8),
        Parent = self.Container
    })
    
    return self
end

function NotificationManager:Notify(title, message, notificationType, duration)
    notificationType = notificationType or "Info"
    duration = duration or 5
    
    local colors = {
        Info = self.ThemeManager:GetColor("Accent"),
        Success = self.ThemeManager:GetColor("Success"),
        Warning = self.ThemeManager:GetColor("Warning"),
        Error = self.ThemeManager:GetColor("Error")
    }
    
    local accentColor = colors[notificationType] or colors.Info
    
    local notification = Utility.Create("Frame", {
        Name = "Notification",
        BackgroundColor3 = self.ThemeManager:GetColor("Secondary"),
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        ZIndex = 2001,
        Parent = self.Container
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 8),
        Parent = notification
    })
    
    Utility.Create("UIStroke", {
        Color = self.ThemeManager:GetColor("Border"),
        Thickness = 1,
        Parent = notification
    })
    
    local accentBar = Utility.Create("Frame", {
        Name = "AccentBar",
        BackgroundColor3 = accentColor,
        BorderSizePixel = 0,
        Size = UDim2.new(0, 4, 1, 0),
        ZIndex = 2002,
        Parent = notification
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 8),
        Parent = accentBar
    })
    
    local contentFrame = Utility.Create("Frame", {
        Name = "Content",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 12, 0, 0),
        Size = UDim2.new(1, -20, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        ZIndex = 2002,
        Parent = notification
    })
    
    Utility.Create("UIPadding", {
        PaddingTop = UDim.new(0, 12),
        PaddingBottom = UDim.new(0, 12),
        PaddingLeft = UDim.new(0, 8),
        PaddingRight = UDim.new(0, 8),
        Parent = contentFrame
    })
    
    Utility.Create("UIListLayout", {
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 4),
        Parent = contentFrame
    })
    
    Utility.Create("TextLabel", {
        Name = "Title",
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        Font = Enum.Font.GothamBold,
        Text = title,
        TextColor3 = self.ThemeManager:GetColor("Text"),
        TextSize = 14,
        TextXAlignment = Enum.TextXAlignment.Left,
        ZIndex = 2003,
        LayoutOrder = 1,
        Parent = contentFrame
    })
    
    Utility.Create("TextLabel", {
        Name = "Message",
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        Font = Enum.Font.Gotham,
        Text = message,
        TextColor3 = self.ThemeManager:GetColor("TextDark"),
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextWrapped = true,
        ZIndex = 2003,
        LayoutOrder = 2,
        Parent = contentFrame
    })
    
    local progressBar = Utility.Create("Frame", {
        Name = "ProgressBar",
        BackgroundColor3 = accentColor,
        BackgroundTransparency = 0.5,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 0, 1, -3),
        Size = UDim2.new(1, 0, 0, 3),
        ZIndex = 2002,
        Parent = notification
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 2),
        Parent = progressBar
    })
    
    notification.Position = UDim2.new(1, 50, 0, 0)
    Utility.Tween(notification, {Position = UDim2.new(0, 0, 0, 0)}, 0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
    
    table.insert(self.Notifications, notification)
    
    while #self.Notifications > self.MaxNotifications do
        local oldNotification = table.remove(self.Notifications, 1)
        oldNotification:Destroy()
    end
    
    Utility.Tween(progressBar, {Size = UDim2.new(0, 0, 0, 3)}, duration, Enum.EasingStyle.Linear)
    
    task.delay(duration, function()
        if notification and notification.Parent then
            Utility.Tween(notification, {Position = UDim2.new(1, 50, 0, 0)}, 0.3).Completed:Connect(function()
                for i, n in ipairs(self.Notifications) do
                    if n == notification then
                        table.remove(self.Notifications, i)
                        break
                    end
                end
                notification:Destroy()
            end)
        end
    end)
    
    return notification
end

function WindowManager.new()
    local self = setmetatable({}, WindowManager)
    self.Windows = {}
    self.ActiveWindow = nil
    self.NextZIndex = 10
    return self
end

function WindowManager:RegisterWindow(window)
    table.insert(self.Windows, window)
    window.ZIndex = self.NextZIndex
    self.NextZIndex = self.NextZIndex + 10
end

function WindowManager:FocusWindow(window)
    if self.ActiveWindow == window then return end
    
    self.ActiveWindow = window
    window.ZIndex = self.NextZIndex
    self.NextZIndex = self.NextZIndex + 10
    window:UpdateZIndex()
end

function WindowManager:GetActiveWindow()
    return self.ActiveWindow
end

function WindowManager:CloseAllWindows()
    for _, window in ipairs(self.Windows) do
        window:Destroy()
    end
    self.Windows = {}
    self.ActiveWindow = nil
end

function ActiveElementPanel.new(screenGui, themeManager)
    local self = setmetatable({}, ActiveElementPanel)
    self.ScreenGui = screenGui
    self.ThemeManager = themeManager
    self.ActiveToggles = {}
    self.Visible = true
    self.Connections = {}
    
    self:CreateUI()
    self:SetupDragging()
    
    return self
end

function ActiveElementPanel:CreateUI()
    self.Container = Utility.Create("Frame", {
        Name = "ActiveElementPanel",
        BackgroundColor3 = self.ThemeManager:GetColor("Primary"),
        BackgroundTransparency = 0.1,
        Position = UDim2.new(0, 20, 0.5, 0),
        Size = UDim2.new(0, 180, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        AnchorPoint = Vector2.new(0, 0.5),
        ZIndex = 500,
        Parent = self.ScreenGui
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 8),
        Parent = self.Container
    })
    
    Utility.Create("UIStroke", {
        Color = self.ThemeManager:GetColor("Border"),
        Thickness = 1,
        Parent = self.Container
    })
    
    self.Header = Utility.Create("Frame", {
        Name = "Header",
        BackgroundColor3 = self.ThemeManager:GetColor("Secondary"),
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, 28),
        ZIndex = 501,
        Parent = self.Container
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 8),
        Parent = self.Header
    })
    
    local headerCover = Utility.Create("Frame", {
        Name = "HeaderCover",
        BackgroundColor3 = self.ThemeManager:GetColor("Secondary"),
        BorderSizePixel = 0,
        Position = UDim2.new(0, 0, 0.5, 0),
        Size = UDim2.new(1, 0, 0.5, 0),
        ZIndex = 501,
        Parent = self.Header
    })
    
    Utility.Create("TextLabel", {
        Name = "Title",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 10, 0, 0),
        Size = UDim2.new(1, -40, 1, 0),
        Font = Enum.Font.GothamBold,
        Text = "Active",
        TextColor3 = self.ThemeManager:GetColor("Text"),
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Left,
        ZIndex = 502,
        Parent = self.Header
    })
    
    local hideButton = Utility.Create("TextButton", {
        Name = "HideButton",
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -28, 0, 0),
        Size = UDim2.new(0, 28, 0, 28),
        Font = Enum.Font.GothamBold,
        Text = "−",
        TextColor3 = self.ThemeManager:GetColor("TextDark"),
        TextSize = 16,
        ZIndex = 502,
        Parent = self.Header
    })
    
    hideButton.MouseButton1Click:Connect(function()
        self:Toggle()
    end)
    
    self.Content = Utility.Create("Frame", {
        Name = "Content",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0, 28),
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        ZIndex = 501,
        Parent = self.Container
    })
    
    Utility.Create("UIPadding", {
        PaddingTop = UDim.new(0, 8),
        PaddingBottom = UDim.new(0, 8),
        PaddingLeft = UDim.new(0, 10),
        PaddingRight = UDim.new(0, 10),
        Parent = self.Content
    })
    
    Utility.Create("UIListLayout", {
        SortOrder = Enum.SortOrder.Name,
        Padding = UDim.new(0, 4),
        Parent = self.Content
    })
    
    self.EmptyLabel = Utility.Create("TextLabel", {
        Name = "EmptyLabel",
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 20),
        Font = Enum.Font.Gotham,
        Text = "No active toggles",
        TextColor3 = self.ThemeManager:GetColor("TextDisabled"),
        TextSize = 11,
        TextXAlignment = Enum.TextXAlignment.Left,
        ZIndex = 502,
        Parent = self.Content
    })
end

function ActiveElementPanel:SetupDragging()
    local dragging = false
    local dragStart, startPos
    
    self.Header.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = self.Container.Position
        end
    end)
    
    self.Header.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = false
        end
    end)
    
    table.insert(self.Connections, UserInputService.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local delta = input.Position - dragStart
            self.Container.Position = UDim2.new(
                startPos.X.Scale,
                startPos.X.Offset + delta.X,
                startPos.Y.Scale,
                startPos.Y.Offset + delta.Y
            )
        end
    end))
end

function ActiveElementPanel:AddToggle(id, name)
    if self.ActiveToggles[id] then return end
    
    self.EmptyLabel.Visible = false
    
    local toggleLabel = Utility.Create("TextLabel", {
        Name = id,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 16),
        Font = Enum.Font.Gotham,
        Text = "• " .. name,
        TextColor3 = self.ThemeManager:GetColor("Success"),
        TextSize = 11,
        TextXAlignment = Enum.TextXAlignment.Left,
        ZIndex = 502,
        Parent = self.Content
    })
    
    self.ActiveToggles[id] = toggleLabel
end

function ActiveElementPanel:RemoveToggle(id)
    if self.ActiveToggles[id] then
        self.ActiveToggles[id]:Destroy()
        self.ActiveToggles[id] = nil
        
        local count = 0
        for _ in pairs(self.ActiveToggles) do
            count = count + 1
        end
        
        if count == 0 then
            self.EmptyLabel.Visible = true
        end
    end
end

function ActiveElementPanel:Toggle()
    self.Visible = not self.Visible
    
    if self.Visible then
        self.Content.Visible = true
        Utility.Tween(self.Container, {Size = UDim2.new(0, 180, 0, 0)}, 0.2)
    else
        Utility.Tween(self.Container, {Size = UDim2.new(0, 180, 0, 28)}, 0.2).Completed:Connect(function()
            if not self.Visible then
                self.Content.Visible = false
            end
        end)
    end
end

function ActiveElementPanel:SetVisible(visible)
    self.Container.Visible = visible
end

function ActiveElementPanel:Destroy()
    for _, connection in ipairs(self.Connections) do
        connection:Disconnect()
    end
    self.Container:Destroy()
end

local Window = {}
Window.__index = Window

function Window.new(library, config)
    local self = setmetatable({}, Window)
    
    self.Library = library
    self.Title = config.Title or "Window"
    self.Size = config.Size or UDim2.new(0, 550, 0, 400)
    self.MinSize = config.MinSize or Vector2.new(400, 300)
    self.MaxSize = config.MaxSize or Vector2.new(800, 600)
    self.Position = config.Position or UDim2.new(0.5, 0, 0.5, 0)
    self.ZIndex = 10
    self.Tabs = {}
    self.ActiveTab = nil
    self.Connections = {}
    self.Minimized = false
    self.UIScale = config.UIScale or 1
    
    self:CreateUI()
    self:SetupDragging()
    self:SetupResizing()
    self:SetupFocus()
    
    library.WindowManager:RegisterWindow(self)
    
    return self
end

function Window:CreateUI()
    local theme = self.Library.ThemeManager
    
    self.Container = Utility.Create("Frame", {
        Name = "Window_" .. self.Title,
        BackgroundColor3 = theme:GetColor("Primary"),
        Position = self.Position,
        Size = self.Size,
        AnchorPoint = Vector2.new(0.5, 0.5),
        ZIndex = self.ZIndex,
        Parent = self.Library.ScreenGui
    })
    
    self.UIScaleInstance = Utility.Create("UIScale", {
        Scale = self.UIScale,
        Parent = self.Container
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 10),
        Parent = self.Container
    })
    
    local shadow = Utility.Create("ImageLabel", {
        Name = "Shadow",
        BackgroundTransparency = 1,
        Position = UDim2.new(0.5, 0, 0.5, 4),
        Size = UDim2.new(1, 30, 1, 30),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Image = "rbxassetid://5554236805",
        ImageColor3 = Color3.fromRGB(0, 0, 0),
        ImageTransparency = 0.6,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(23, 23, 277, 277),
        ZIndex = self.ZIndex - 1,
        Parent = self.Container
    })
    
    self.TitleBar = Utility.Create("Frame", {
        Name = "TitleBar",
        BackgroundColor3 = theme:GetColor("Secondary"),
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, 35),
        ZIndex = self.ZIndex + 1,
        Parent = self.Container
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 10),
        Parent = self.TitleBar
    })
    
    local titleBarCover = Utility.Create("Frame", {
        Name = "TitleBarCover",
        BackgroundColor3 = theme:GetColor("Secondary"),
        BorderSizePixel = 0,
        Position = UDim2.new(0, 0, 0.5, 0),
        Size = UDim2.new(1, 0, 0.5, 0),
        ZIndex = self.ZIndex + 1,
        Parent = self.TitleBar
    })
    
    self.TitleLabel = Utility.Create("TextLabel", {
        Name = "Title",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 15, 0, 0),
        Size = UDim2.new(0.5, 0, 1, 0),
        Font = Enum.Font.GothamBold,
        Text = self.Title,
        TextColor3 = theme:GetColor("Text"),
        TextSize = 14,
        TextXAlignment = Enum.TextXAlignment.Left,
        ZIndex = self.ZIndex + 2,
        Parent = self.TitleBar
    })
    
    local buttonContainer = Utility.Create("Frame", {
        Name = "ButtonContainer",
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -90, 0, 0),
        Size = UDim2.new(0, 85, 1, 0),
        ZIndex = self.ZIndex + 2,
        Parent = self.TitleBar
    })
    
    Utility.Create("UIListLayout", {
        FillDirection = Enum.FillDirection.Horizontal,
        HorizontalAlignment = Enum.HorizontalAlignment.Right,
        VerticalAlignment = Enum.VerticalAlignment.Center,
        Padding = UDim.new(0, 5),
        Parent = buttonContainer
    })
    
    local minimizeButton = Utility.Create("TextButton", {
        Name = "Minimize",
        BackgroundColor3 = theme:GetColor("Tertiary"),
        Size = UDim2.new(0, 25, 0, 25),
        Font = Enum.Font.GothamBold,
        Text = "−",
        TextColor3 = theme:GetColor("Text"),
        TextSize = 16,
        ZIndex = self.ZIndex + 3,
        Parent = buttonContainer
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 6),
        Parent = minimizeButton
    })
    
    minimizeButton.MouseButton1Click:Connect(function()
        self:ToggleMinimize()
    end)
    
    local closeButton = Utility.Create("TextButton", {
        Name = "Close",
        BackgroundColor3 = theme:GetColor("Error"),
        Size = UDim2.new(0, 25, 0, 25),
        Font = Enum.Font.GothamBold,
        Text = "×",
        TextColor3 = Color3.fromRGB(255, 255, 255),
        TextSize = 16,
        ZIndex = self.ZIndex + 3,
        Parent = buttonContainer
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 6),
        Parent = closeButton
    })
    
    closeButton.MouseButton1Click:Connect(function()
        self:Destroy()
    end)
    
    self.TabContainer = Utility.Create("Frame", {
        Name = "TabContainer",
        BackgroundColor3 = theme:GetColor("Secondary"),
        BorderSizePixel = 0,
        Position = UDim2.new(0, 0, 0, 35),
        Size = UDim2.new(0, 140, 1, -35),
        ZIndex = self.ZIndex + 1,
        Parent = self.Container
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 10),
        Parent = self.TabContainer
    })
    
    local tabContainerCover = Utility.Create("Frame", {
        Name = "TabContainerCover",
        BackgroundColor3 = theme:GetColor("Secondary"),
        BorderSizePixel = 0,
        Position = UDim2.new(0.5, 0, 0, 0),
        Size = UDim2.new(0.5, 0, 1, 0),
        ZIndex = self.ZIndex + 1,
        Parent = self.TabContainer
    })
    
    local tabContainerCover2 = Utility.Create("Frame", {
        Name = "TabContainerCover2",
        BackgroundColor3 = theme:GetColor("Secondary"),
        BorderSizePixel = 0,
        Position = UDim2.new(0, 0, 0, 0),
        Size = UDim2.new(1, 0, 0, 20),
        ZIndex = self.ZIndex + 1,
        Parent = self.TabContainer
    })
    
    self.TabList = Utility.Create("ScrollingFrame", {
        Name = "TabList",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 8, 0, 10),
        Size = UDim2.new(1, -16, 1, -20),
        CanvasSize = UDim2.new(0, 0, 0, 0),
        ScrollBarThickness = 2,
        ScrollBarImageColor3 = theme:GetColor("Accent"),
        ZIndex = self.ZIndex + 2,
        Parent = self.TabContainer
    })
    
    Utility.Create("UIListLayout", {
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 5),
        Parent = self.TabList
    })
    
    self.ContentContainer = Utility.Create("Frame", {
        Name = "ContentContainer",
        BackgroundColor3 = theme:GetColor("Primary"),
        BorderSizePixel = 0,
        Position = UDim2.new(0, 145, 0, 40),
        Size = UDim2.new(1, -150, 1, -45),
        ZIndex = self.ZIndex + 1,
        ClipsDescendants = true,
        Parent = self.Container
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 8),
        Parent = self.ContentContainer
    })
    
    self.ResizeHandle = Utility.Create("TextButton", {
        Name = "ResizeHandle",
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -15, 1, -15),
        Size = UDim2.new(0, 15, 0, 15),
        Text = "",
        ZIndex = self.ZIndex + 5,
        Parent = self.Container
    })
    
    local resizeIcon = Utility.Create("Frame", {
        Name = "ResizeIcon",
        BackgroundColor3 = theme:GetColor("TextDark"),
        Position = UDim2.new(0.5, 0, 0.5, 0),
        Size = UDim2.new(0, 8, 0, 8),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Rotation = 45,
        ZIndex = self.ZIndex + 6,
        Parent = self.ResizeHandle
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 2),
        Parent = resizeIcon
    })
end

function Window:SetupDragging()
    local dragging = false
    local dragStart, startPos
    
    self.TitleBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = self.Container.Position
            self.Library.WindowManager:FocusWindow(self)
        end
    end)
    
    self.TitleBar.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = false
        end
    end)
    
    table.insert(self.Connections, UserInputService.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local delta = input.Position - dragStart
            self.Container.Position = UDim2.new(
                startPos.X.Scale,
                startPos.X.Offset + delta.X,
                startPos.Y.Scale,
                startPos.Y.Offset + delta.Y
            )
        end
    end))
end

function Window:SetupResizing()
    local resizing = false
    local resizeStart, startSize
    
    self.ResizeHandle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            resizing = true
            resizeStart = input.Position
            startSize = self.Container.AbsoluteSize
            self.Library.WindowManager:FocusWindow(self)
        end
    end)
    
    self.ResizeHandle.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            resizing = false
        end
    end)
    
    table.insert(self.Connections, UserInputService.InputChanged:Connect(function(input)
        if resizing and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local delta = input.Position - resizeStart
            local newWidth = math.clamp(startSize.X + delta.X, self.MinSize.X, self.MaxSize.X)
            local newHeight = math.clamp(startSize.Y + delta.Y, self.MinSize.Y, self.MaxSize.Y)
            self.Container.Size = UDim2.new(0, newWidth, 0, newHeight)
        end
    end))
end

function Window:SetupFocus()
    self.Container.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            self.Library.WindowManager:FocusWindow(self)
        end
    end)
end

function Window:UpdateZIndex()
    local function updateZIndexRecursive(instance, baseIndex)
        for _, child in ipairs(instance:GetChildren()) do
            if child:IsA("GuiObject") then
                child.ZIndex = baseIndex + (child.ZIndex % 10)
                updateZIndexRecursive(child, baseIndex)
            end
        end
    end
    
    self.Container.ZIndex = self.ZIndex
    updateZIndexRecursive(self.Container, self.ZIndex)
end

function Window:ToggleMinimize()
    self.Minimized = not self.Minimized
    
    if self.Minimized then
        self.OriginalSize = self.Container.Size
        Utility.Tween(self.Container, {Size = UDim2.new(0, self.Container.AbsoluteSize.X, 0, 35)}, 0.2)
        self.TabContainer.Visible = false
        self.ContentContainer.Visible = false
        self.ResizeHandle.Visible = false
    else
        Utility.Tween(self.Container, {Size = self.OriginalSize}, 0.2)
        self.TabContainer.Visible = true
        self.ContentContainer.Visible = true
        self.ResizeHandle.Visible = true
    end
end

function Window:SetUIScale(scale)
    self.UIScale = scale
    Utility.Tween(self.UIScaleInstance, {Scale = scale}, 0.2)
end

function Window:CreateTab(name, config)
    config = config or {}
    local tab = Tab.new(self, name, config)
    table.insert(self.Tabs, tab)
    
    if #self.Tabs == 1 then
        self:SetActiveTab(tab)
    end
    
    self:UpdateTabListCanvas()
    
    return tab
end

function Window:SetActiveTab(tab)
    if self.ActiveTab then
        self.ActiveTab:SetActive(false)
    end
    
    self.ActiveTab = tab
    tab:SetActive(true)
end

function Window:UpdateTabListCanvas()
    local listLayout = self.TabList:FindFirstChildOfClass("UIListLayout")
    if listLayout then
        self.TabList.CanvasSize = UDim2.new(0, 0, 0, listLayout.AbsoluteContentSize.Y + 10)
    end
end

function Window:Destroy()
    for _, connection in ipairs(self.Connections) do
        connection:Disconnect()
    end
    
    for _, tab in ipairs(self.Tabs) do
        tab:Destroy()
    end
    
    self.Container:Destroy()
end

local Tab = {}
Tab.__index = Tab

function Tab.new(window, name, config)
    local self = setmetatable({}, Tab)
    
    self.Window = window
    self.Library = window.Library
    self.Name = name
    self.Icon = config.Icon
    self.SubTabs = {}
    self.ActiveSubTab = nil
    self.Active = false
    self.LayoutOrder = #window.Tabs + 1
    
    self:CreateUI()
    
    return self
end

function Tab:CreateUI()
    local theme = self.Library.ThemeManager
    
    self.Button = Utility.Create("TextButton", {
        Name = "Tab_" .. self.Name,
        BackgroundColor3 = theme:GetColor("Tertiary"),
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 35),
        Text = "",
        AutoButtonColor = false,
        LayoutOrder = self.LayoutOrder,
        ZIndex = self.Window.ZIndex + 3,
        Parent = self.Window.TabList
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 6),
        Parent = self.Button
    })
    
    if self.Icon then
        local iconImage = Utility.Create("ImageLabel", {
            Name = "Icon",
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 10, 0.5, 0),
            Size = UDim2.new(0, 18, 0, 18),
            AnchorPoint = Vector2.new(0, 0.5),
            Image = self.Icon,
            ImageColor3 = theme:GetColor("TextDark"),
            ZIndex = self.Window.ZIndex + 4,
            Parent = self.Button
        })
        
        self.IconImage = iconImage
    end
    
    self.Label = Utility.Create("TextLabel", {
        Name = "Label",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, self.Icon and 35 or 10, 0, 0),
        Size = UDim2.new(1, self.Icon and -45 or -20, 1, 0),
        Font = Enum.Font.GothamMedium,
        Text = self.Name,
        TextColor3 = theme:GetColor("TextDark"),
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextTruncate = Enum.TextTruncate.AtEnd,
        ZIndex = self.Window.ZIndex + 4,
        Parent = self.Button
    })
    
    self.Indicator = Utility.Create("Frame", {
        Name = "Indicator",
        BackgroundColor3 = theme:GetColor("Accent"),
        Position = UDim2.new(0, 0, 0.5, 0),
        Size = UDim2.new(0, 3, 0.6, 0),
        AnchorPoint = Vector2.new(0, 0.5),
        ZIndex = self.Window.ZIndex + 4,
        Visible = false,
        Parent = self.Button
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 2),
        Parent = self.Indicator
    })
    
    self.Button.MouseButton1Click:Connect(function()
        self.Window:SetActiveTab(self)
    end)
    
    self.Button.MouseEnter:Connect(function()
        if not self.Active then
            Utility.Tween(self.Button, {BackgroundTransparency = 0.8}, 0.15)
        end
    end)
    
    self.Button.MouseLeave:Connect(function()
        if not self.Active then
            Utility.Tween(self.Button, {BackgroundTransparency = 1}, 0.15)
        end
    end)
    
    self.ContentFrame = Utility.Create("ScrollingFrame", {
        Name = "TabContent_" .. self.Name,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0, 0),
        Size = UDim2.new(1, 0, 1, 0),
        CanvasSize = UDim2.new(0, 0, 0, 0),
        ScrollBarThickness = 4,
        ScrollBarImageColor3 = self.Library.ThemeManager:GetColor("Accent"),
        Visible = false,
        ZIndex = self.Window.ZIndex + 2,
        Parent = self.Window.ContentContainer
    })
    
    Utility.Create("UIPadding", {
        PaddingTop = UDim.new(0, 10),
        PaddingBottom = UDim.new(0, 10),
        PaddingLeft = UDim.new(0, 10),
        PaddingRight = UDim.new(0, 10),
        Parent = self.ContentFrame
    })
    
    Utility.Create("UIListLayout", {
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 8),
        Parent = self.ContentFrame
    })
end

function Tab:SetActive(active)
    self.Active = active
    local theme = self.Library.ThemeManager
    
    if active then
        Utility.Tween(self.Button, {BackgroundTransparency = 0.5}, 0.2)
        Utility.Tween(self.Label, {TextColor3 = theme:GetColor("Text")}, 0.2)
        if self.IconImage then
            Utility.Tween(self.IconImage, {ImageColor3 = theme:GetColor("Text")}, 0.2)
        end
        self.Indicator.Visible = true
        self.ContentFrame.Visible = true
        
        if self.ActiveSubTab then
            self.ActiveSubTab.ContentFrame.Visible = true
        elseif #self.SubTabs > 0 then
            self:SetActiveSubTab(self.SubTabs[1])
        end
    else
        Utility.Tween(self.Button, {BackgroundTransparency = 1}, 0.2)
        Utility.Tween(self.Label, {TextColor3 = theme:GetColor("TextDark")}, 0.2)
        if self.IconImage then
            Utility.Tween(self.IconImage, {ImageColor3 = theme:GetColor("TextDark")}, 0.2)
        end
        self.Indicator.Visible = false
        self.ContentFrame.Visible = false
        
        for _, subTab in ipairs(self.SubTabs) do
            subTab.ContentFrame.Visible = false
        end
    end
end

function Tab:CreateSubTab(name)
    local subTab = SubTab.new(self, name)
    table.insert(self.SubTabs, subTab)
    
    if #self.SubTabs == 1 and self.Active then
        self:SetActiveSubTab(subTab)
    end
    
    self:UpdateContentCanvas()
    
    return subTab
end

function Tab:SetActiveSubTab(subTab)
    if self.ActiveSubTab then
        self.ActiveSubTab:SetActive(false)
    end
    
    self.ActiveSubTab = subTab
    subTab:SetActive(true)
end

function Tab:UpdateContentCanvas()
    local listLayout = self.ContentFrame:FindFirstChildOfClass("UIListLayout")
    if listLayout then
        self.ContentFrame.CanvasSize = UDim2.new(0, 0, 0, listLayout.AbsoluteContentSize.Y + 20)
    end
end

function Tab:Destroy()
    for _, subTab in ipairs(self.SubTabs) do
        subTab:Destroy()
    end
    
    self.Button:Destroy()
    self.ContentFrame:Destroy()
end

local SubTab = {}
SubTab.__index = SubTab

function SubTab.new(tab, name)
    local self = setmetatable({}, SubTab)
    
    self.Tab = tab
    self.Window = tab.Window
    self.Library = tab.Library
    self.Name = name
    self.Sections = {}
    self.Active = false
    self.Expanded = true
    self.LayoutOrder = #tab.SubTabs + 1
    
    self:CreateUI()
    
    return self
end

function SubTab:CreateUI()
    local theme = self.Library.ThemeManager
    
    self.Container = Utility.Create("Frame", {
        Name = "SubTab_" .. self.Name,
        BackgroundColor3 = theme:GetColor("Secondary"),
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        LayoutOrder = self.LayoutOrder,
        ZIndex = self.Window.ZIndex + 3,
        Parent = self.Tab.ContentFrame
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 8),
        Parent = self.Container
    })
    
    self.Header = Utility.Create("TextButton", {
        Name = "Header",
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 32),
        Text = "",
        AutoButtonColor = false,
        ZIndex = self.Window.ZIndex + 4,
        Parent = self.Container
    })
    
    self.HeaderLabel = Utility.Create("TextLabel", {
        Name = "Label",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 12, 0, 0),
        Size = UDim2.new(1, -40, 1, 0),
        Font = Enum.Font.GothamBold,
        Text = self.Name,
        TextColor3 = theme:GetColor("Text"),
        TextSize = 13,
        TextXAlignment = Enum.TextXAlignment.Left,
        ZIndex = self.Window.ZIndex + 5,
        Parent = self.Header
    })
    
    self.ExpandIcon = Utility.Create("TextLabel", {
        Name = "ExpandIcon",
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -30, 0.5, 0),
        Size = UDim2.new(0, 20, 0, 20),
        AnchorPoint = Vector2.new(0, 0.5),
        Font = Enum.Font.GothamBold,
        Text = "▼",
        TextColor3 = theme:GetColor("TextDark"),
        TextSize = 10,
        ZIndex = self.Window.ZIndex + 5,
        Parent = self.Header
    })
    
    self.ContentFrame = Utility.Create("Frame", {
        Name = "Content",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0, 32),
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        ClipsDescendants = true,
        ZIndex = self.Window.ZIndex + 4,
        Parent = self.Container
    })
    
    Utility.Create("UIPadding", {
        PaddingTop = UDim.new(0, 5),
        PaddingBottom = UDim.new(0, 10),
        PaddingLeft = UDim.new(0, 10),
        PaddingRight = UDim.new(0, 10),
        Parent = self.ContentFrame
    })
    
    Utility.Create("UIListLayout", {
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 8),
        Parent = self.ContentFrame
    })
    
    self.Header.MouseButton1Click:Connect(function()
        if self.Active then
            self:ToggleExpand()
        else
            self.Tab:SetActiveSubTab(self)
        end
    end)
end

function SubTab:SetActive(active)
    self.Active = active
    local theme = self.Library.ThemeManager
    
    if active then
        Utility.Tween(self.Container, {BackgroundColor3 = theme:GetColor("Tertiary")}, 0.2)
        self.ContentFrame.Visible = true
        if self.Expanded then
            self.ContentFrame.AutomaticSize = Enum.AutomaticSize.Y
        end
    else
        Utility.Tween(self.Container, {BackgroundColor3 = theme:GetColor("Secondary")}, 0.2)
        self.ContentFrame.Visible = false
    end
end

function SubTab:ToggleExpand()
    self.Expanded = not self.Expanded
    local theme = self.Library.ThemeManager
    
    if self.Expanded then
        self.ContentFrame.AutomaticSize = Enum.AutomaticSize.Y
        Utility.Tween(self.ExpandIcon, {Rotation = 0}, 0.2)
    else
        self.ContentFrame.AutomaticSize = Enum.AutomaticSize.None
        Utility.Tween(self.ContentFrame, {Size = UDim2.new(1, 0, 0, 0)}, 0.2)
        Utility.Tween(self.ExpandIcon, {Rotation = -90}, 0.2)
    end
    
    task.delay(0.1, function()
        self.Tab:UpdateContentCanvas()
    end)
end

function SubTab:CreateSection(name)
    local section = Section.new(self, name)
    table.insert(self.Sections, section)
    
    task.defer(function()
        self.Tab:UpdateContentCanvas()
    end)
    
    return section
end

function SubTab:Destroy()
    for _, section in ipairs(self.Sections) do
        section:Destroy()
    end
    
    self.Container:Destroy()
end

local Section = {}
Section.__index = Section

function Section.new(subTab, name)
    local self = setmetatable({}, Section)
    
    self.SubTab = subTab
    self.Tab = subTab.Tab
    self.Window = subTab.Window
    self.Library = subTab.Library
    self.Name = name
    self.Elements = {}
    self.LayoutOrder = #subTab.Sections + 1
    
    self:CreateUI()
    
    return self
end

function Section:CreateUI()
    local theme = self.Library.ThemeManager
    
    self.Container = Utility.Create("Frame", {
        Name = "Section_" .. self.Name,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        LayoutOrder = self.LayoutOrder,
        ZIndex = self.Window.ZIndex + 5,
        Parent = self.SubTab.ContentFrame
    })
    
    if self.Name and self.Name ~= "" then
        self.Label = Utility.Create("TextLabel", {
            Name = "SectionLabel",
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 0, 20),
            Font = Enum.Font.GothamMedium,
            Text = self.Name,
            TextColor3 = theme:GetColor("TextDark"),
            TextSize = 11,
            TextXAlignment = Enum.TextXAlignment.Left,
            LayoutOrder = 0,
            ZIndex = self.Window.ZIndex + 6,
            Parent = self.Container
        })
    end
    
    self.ElementContainer = Utility.Create("Frame", {
        Name = "Elements",
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        LayoutOrder = 1,
        ZIndex = self.Window.ZIndex + 5,
        Parent = self.Container
    })
    
    Utility.Create("UIListLayout", {
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 6),
        Parent = self.ElementContainer
    })
end

function Section:CreateToggle(config)
    local toggle = Toggle.new(self, config)
    table.insert(self.Elements, toggle)
    
    task.defer(function()
        self.Tab:UpdateContentCanvas()
    end)
    
    return toggle
end

function Section:CreateSlider(config)
    local slider = Slider.new(self, config)
    table.insert(self.Elements, slider)
    
    task.defer(function()
        self.Tab:UpdateContentCanvas()
    end)
    
    return slider
end

function Section:CreateDropdown(config)
    local dropdown = Dropdown.new(self, config)
    table.insert(self.Elements, dropdown)
    
    task.defer(function()
        self.Tab:UpdateContentCanvas()
    end)
    
    return dropdown
end

function Section:CreateColorPicker(config)
    local colorPicker = ColorPicker.new(self, config)
    table.insert(self.Elements, colorPicker)
    
    task.defer(function()
        self.Tab:UpdateContentCanvas()
    end)
    
    return colorPicker
end

function Section:CreateTextBox(config)
    local textBox = TextBox.new(self, config)
    table.insert(self.Elements, textBox)
    
    task.defer(function()
        self.Tab:UpdateContentCanvas()
    end)
    
    return textBox
end

function Section:CreateKeybind(config)
    local keybind = Keybind.new(self, config)
    table.insert(self.Elements, keybind)
    
    task.defer(function()
        self.Tab:UpdateContentCanvas()
    end)
    
    return keybind
end

function Section:CreateButton(config)
    local button = Button.new(self, config)
    table.insert(self.Elements, button)
    
    task.defer(function()
        self.Tab:UpdateContentCanvas()
    end)
    
    return button
end

function Section:CreateLabel(config)
    local label = Label.new(self, config)
    table.insert(self.Elements, label)
    
    task.defer(function()
        self.Tab:UpdateContentCanvas()
    end)
    
    return label
end

function Section:Destroy()
    for _, element in ipairs(self.Elements) do
        element:Destroy()
    end
    
    self.Container:Destroy()
end

local Toggle = {}
Toggle.__index = Toggle

function Toggle.new(section, config)
    local self = setmetatable({}, Toggle)
    
    self.Section = section
    self.Library = section.Library
    self.Name = config.Name or "Toggle"
    self.Description = config.Description
    self.Default = config.Default or false
    self.Value = self.Default
    self.Callback = config.Callback
    self.Flag = config.Flag
    self.LayoutOrder = #section.Elements + 1
    self.Connections = {}
    
    self:CreateUI()
    self:SetValue(self.Default, true)
    
    if self.Flag then
        self.Library.ConfigManager:RegisterElement(self.Flag, self)
    end
    
    return self
end

function Toggle:CreateUI()
    local theme = self.Library.ThemeManager
    local window = self.Section.Window
    
    self.Container = Utility.Create("Frame", {
        Name = "Toggle_" .. self.Name,
        BackgroundColor3 = theme:GetColor("Primary"),
        Size = UDim2.new(1, 0, 0, self.Description and 50 or 36),
        LayoutOrder = self.LayoutOrder,
        ZIndex = window.ZIndex + 6,
        Parent = self.Section.ElementContainer
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 6),
        Parent = self.Container
    })
    
    self.Button = Utility.Create("TextButton", {
        Name = "Button",
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        Text = "",
        ZIndex = window.ZIndex + 7,
        Parent = self.Container
    })
    
    self.Label = Utility.Create("TextLabel", {
        Name = "Label",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 10, 0, self.Description and 8 or 0),
        Size = UDim2.new(1, -60, 0, self.Description and 18 or 36),
        Font = Enum.Font.GothamMedium,
        Text = self.Name,
        TextColor3 = theme:GetColor("Text"),
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Left,
        ZIndex = window.ZIndex + 8,
        Parent = self.Container
    })
    
    if self.Description then
        self.DescriptionLabel = Utility.Create("TextLabel", {
            Name = "Description",
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 10, 0, 26),
            Size = UDim2.new(1, -60, 0, 16),
            Font = Enum.Font.Gotham,
            Text = self.Description,
            TextColor3 = theme:GetColor("TextDark"),
            TextSize = 10,
            TextXAlignment = Enum.TextXAlignment.Left,
            TextTruncate = Enum.TextTruncate.AtEnd,
            ZIndex = window.ZIndex + 8,
            Parent = self.Container
        })
    end
    
    self.ToggleFrame = Utility.Create("Frame", {
        Name = "ToggleFrame",
        BackgroundColor3 = theme:GetColor("Tertiary"),
        Position = UDim2.new(1, -50, 0.5, 0),
        Size = UDim2.new(0, 40, 0, 20),
        AnchorPoint = Vector2.new(0, 0.5),
        ZIndex = window.ZIndex + 8,
        Parent = self.Container
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(1, 0),
        Parent = self.ToggleFrame
    })
    
    self.ToggleCircle = Utility.Create("Frame", {
        Name = "Circle",
        BackgroundColor3 = theme:GetColor("TextDark"),
        Position = UDim2.new(0, 3, 0.5, 0),
        Size = UDim2.new(0, 14, 0, 14),
        AnchorPoint = Vector2.new(0, 0.5),
        ZIndex = window.ZIndex + 9,
        Parent = self.ToggleFrame
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(1, 0),
        Parent = self.ToggleCircle
    })
    
    self.Button.MouseButton1Click:Connect(function()
        self:SetValue(not self.Value)
    end)
    
    self.Button.MouseEnter:Connect(function()
        Utility.Tween(self.Container, {BackgroundColor3 = theme:GetColor("Secondary")}, 0.15)
    end)
    
    self.Button.MouseLeave:Connect(function()
        Utility.Tween(self.Container, {BackgroundColor3 = theme:GetColor("Primary")}, 0.15)
    end)
end

function Toggle:SetValue(value, fromConfig)
    self.Value = value
    self:UpdateVisual()
    
    if self.Value then
        self.Library.ActiveElementPanel:AddToggle(self.Flag or self.Name, self.Name)
    else
        self.Library.ActiveElementPanel:RemoveToggle(self.Flag or self.Name)
    end
    
    if not fromConfig and self.Callback then
        task.spawn(self.Callback, self.Value)
    end
end

function Toggle:GetValue()
    return self.Value
end

function Toggle:UpdateVisual()
    local theme = self.Library.ThemeManager
    
    if self.Value then
        Utility.Tween(self.ToggleFrame, {BackgroundColor3 = theme:GetColor("Accent")}, 0.2)
        Utility.Tween(self.ToggleCircle, {
            Position = UDim2.new(1, -17, 0.5, 0),
            BackgroundColor3 = Color3.fromRGB(255, 255, 255)
        }, 0.2, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
    else
        Utility.Tween(self.ToggleFrame, {BackgroundColor3 = theme:GetColor("Tertiary")}, 0.2)
        Utility.Tween(self.ToggleCircle, {
            Position = UDim2.new(0, 3, 0.5, 0),
            BackgroundColor3 = theme:GetColor("TextDark")
        }, 0.2, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
    end
end

function Toggle:Destroy()
    for _, connection in ipairs(self.Connections) do
        connection:Disconnect()
    end
    
    if self.Flag then
        self.Library.ConfigManager:UnregisterElement(self.Flag)
    end
    
    self.Library.ActiveElementPanel:RemoveToggle(self.Flag or self.Name)
    self.Container:Destroy()
end

local Slider = {}
Slider.__index = Slider

function Slider.new(section, config)
    local self = setmetatable({}, Slider)
    
    self.Section = section
    self.Library = section.Library
    self.Name = config.Name or "Slider"
    self.Min = config.Min or 0
    self.Max = config.Max or 100
    self.Default = config.Default or self.Min
    self.Increment = config.Increment or 1
    self.Suffix = config.Suffix or ""
    self.Value = self.Default
    self.Callback = config.Callback
    self.Flag = config.Flag
    self.LayoutOrder = #section.Elements + 1
    self.Connections = {}
    self.Dragging = false
    
    self:CreateUI()
    self:SetValue(self.Default, true)
    
    if self.Flag then
        self.Library.ConfigManager:RegisterElement(self.Flag, self)
    end
    
    return self
end

function Slider:CreateUI()
    local theme = self.Library.ThemeManager
    local window = self.Section.Window
    
    self.Container = Utility.Create("Frame", {
        Name = "Slider_" .. self.Name,
        BackgroundColor3 = theme:GetColor("Primary"),
        Size = UDim2.new(1, 0, 0, 50),
        LayoutOrder = self.LayoutOrder,
        ZIndex = window.ZIndex + 6,
        Parent = self.Section.ElementContainer
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 6),
        Parent = self.Container
    })
    
    self.Label = Utility.Create("TextLabel", {
        Name = "Label",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 10, 0, 8),
        Size = UDim2.new(0.6, 0, 0, 16),
        Font = Enum.Font.GothamMedium,
        Text = self.Name,
        TextColor3 = theme:GetColor("Text"),
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Left,
        ZIndex = window.ZIndex + 8,
        Parent = self.Container
    })
    
    self.ValueLabel = Utility.Create("TextLabel", {
        Name = "Value",
        BackgroundTransparency = 1,
        Position = UDim2.new(0.6, 0, 0, 8),
        Size = UDim2.new(0.4, -10, 0, 16),
        Font = Enum.Font.GothamMedium,
        Text = tostring(self.Value) .. self.Suffix,
        TextColor3 = theme:GetColor("Accent"),
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Right,
        ZIndex = window.ZIndex + 8,
        Parent = self.Container
    })
    
    self.SliderBackground = Utility.Create("Frame", {
        Name = "SliderBackground",
        BackgroundColor3 = theme:GetColor("Tertiary"),
        Position = UDim2.new(0, 10, 0, 32),
        Size = UDim2.new(1, -20, 0, 8),
        ZIndex = window.ZIndex + 7,
        Parent = self.Container
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(1, 0),
        Parent = self.SliderBackground
    })
    
    self.SliderFill = Utility.Create("Frame", {
        Name = "Fill",
        BackgroundColor3 = theme:GetColor("Accent"),
        Size = UDim2.new(0, 0, 1, 0),
        ZIndex = window.ZIndex + 8,
        Parent = self.SliderBackground
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(1, 0),
        Parent = self.SliderFill
    })
    
    self.SliderButton = Utility.Create("TextButton", {
        Name = "SliderButton",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 10, 0, 28),
        Size = UDim2.new(1, -20, 0, 16),
        Text = "",
        ZIndex = window.ZIndex + 9,
        Parent = self.Container
    })
    
    self.SliderButton.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            self.Dragging = true
            self:UpdateFromInput(input.Position.X)
        end
    end)
    
    self.SliderButton.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            self.Dragging = false
        end
    end)
    
    table.insert(self.Connections, UserInputService.InputChanged:Connect(function(input)
        if self.Dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            self:UpdateFromInput(input.Position.X)
        end
    end))
end

function Slider:UpdateFromInput(inputX)
    local sliderPos = self.SliderBackground.AbsolutePosition.X
    local sliderSize = self.SliderBackground.AbsoluteSize.X
    
    local relativeX = math.clamp((inputX - sliderPos) / sliderSize, 0, 1)
    local rawValue = self.Min + (self.Max - self.Min) * relativeX
    local steppedValue = math.floor(rawValue / self.Increment + 0.5) * self.Increment
    local clampedValue = math.clamp(steppedValue, self.Min, self.Max)
    
    self:SetValue(clampedValue)
end

function Slider:SetValue(value, fromConfig)
    self.Value = Utility.ClampNumber(value, self.Min, self.Max)
    self.Value = Utility.Round(self.Value, self:GetDecimalPlaces())
    self:UpdateVisual()
    
    if not fromConfig and self.Callback then
        task.spawn(self.Callback, self.Value)
    end
end

function Slider:GetValue()
    return self.Value
end

function Slider:GetDecimalPlaces()
    local incrementStr = tostring(self.Increment)
    local decimalPos = incrementStr:find("%.")
    if decimalPos then
        return #incrementStr - decimalPos
    end
    return 0
end

function Slider:UpdateVisual()
    local percentage = (self.Value - self.Min) / (self.Max - self.Min)
    Utility.Tween(self.SliderFill, {Size = UDim2.new(percentage, 0, 1, 0)}, 0.1)
    self.ValueLabel.Text = tostring(self.Value) .. self.Suffix
end

function Slider:Destroy()
    for _, connection in ipairs(self.Connections) do
        connection:Disconnect()
    end
    
    if self.Flag then
        self.Library.ConfigManager:UnregisterElement(self.Flag)
    end
    
    self.Container:Destroy()
end

local Dropdown = {}
Dropdown.__index = Dropdown

function Dropdown.new(section, config)
    local self = setmetatable({}, Dropdown)
    
    self.Section = section
    self.Library = section.Library
    self.Name = config.Name or "Dropdown"
    self.Options = config.Options or {}
    self.Default = config.Default
    self.Multi = config.Multi or false
    self.Value = self.Multi and {} or nil
    self.Callback = config.Callback
    self.Flag = config.Flag
    self.LayoutOrder = #section.Elements + 1
    self.Connections = {}
    self.Open = false
    self.DropdownFrame = nil
    
    self:CreateUI()
    
    if self.Default then
        if self.Multi then
            for _, option in ipairs(self.Default) do
                self:SetValue(option, true)
            end
        else
            self:SetValue(self.Default, true)
        end
    end
    
    if self.Flag then
        self.Library.ConfigManager:RegisterElement(self.Flag, self)
    end
    
    return self
end

function Dropdown:CreateUI()
    local theme = self.Library.ThemeManager
    local window = self.Section.Window
    
    self.Container = Utility.Create("Frame", {
        Name = "Dropdown_" .. self.Name,
        BackgroundColor3 = theme:GetColor("Primary"),
        Size = UDim2.new(1, 0, 0, 50),
        LayoutOrder = self.LayoutOrder,
        ZIndex = window.ZIndex + 6,
        Parent = self.Section.ElementContainer
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 6),
        Parent = self.Container
    })
    
    self.Label = Utility.Create("TextLabel", {
        Name = "Label",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 10, 0, 6),
        Size = UDim2.new(1, -20, 0, 14),
        Font = Enum.Font.GothamMedium,
        Text = self.Name,
        TextColor3 = theme:GetColor("Text"),
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Left,
        ZIndex = window.ZIndex + 8,
        Parent = self.Container
    })
    
    self.DropdownButton = Utility.Create("TextButton", {
        Name = "DropdownButton",
        BackgroundColor3 = theme:GetColor("Tertiary"),
        Position = UDim2.new(0, 10, 0, 24),
        Size = UDim2.new(1, -20, 0, 22),
        Text = "",
        AutoButtonColor = false,
        ZIndex = window.ZIndex + 7,
        Parent = self.Container
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 4),
        Parent = self.DropdownButton
    })
    
    self.SelectedLabel = Utility.Create("TextLabel", {
        Name = "Selected",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 8, 0, 0),
        Size = UDim2.new(1, -30, 1, 0),
        Font = Enum.Font.Gotham,
        Text = "Select...",
        TextColor3 = theme:GetColor("TextDark"),
        TextSize = 11,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextTruncate = Enum.TextTruncate.AtEnd,
        ZIndex = window.ZIndex + 8,
        Parent = self.DropdownButton
    })
    
    self.Arrow = Utility.Create("TextLabel", {
        Name = "Arrow",
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -22, 0.5, 0),
        Size = UDim2.new(0, 16, 0, 16),
        AnchorPoint = Vector2.new(0, 0.5),
        Font = Enum.Font.GothamBold,
        Text = "▼",
        TextColor3 = theme:GetColor("TextDark"),
        TextSize = 10,
        ZIndex = window.ZIndex + 8,
        Parent = self.DropdownButton
    })
    
    self.DropdownButton.MouseButton1Click:Connect(function()
        self:Toggle()
    end)
    
    self.DropdownButton.MouseEnter:Connect(function()
        Utility.Tween(self.DropdownButton, {BackgroundColor3 = theme:GetColor("Secondary")}, 0.15)
    end)
    
    self.DropdownButton.MouseLeave:Connect(function()
        if not self.Open then
            Utility.Tween(self.DropdownButton, {BackgroundColor3 = theme:GetColor("Tertiary")}, 0.15)
        end
    end)
end

function Dropdown:Toggle()
    self.Open = not self.Open
    
    if self.Open then
        self:OpenDropdown()
    else
        self:CloseDropdown()
    end
end

function Dropdown:OpenDropdown()
    local theme = self.Library.ThemeManager
    local layerManager = self.Library.LayerManager
    
    local buttonAbsPos = self.DropdownButton.AbsolutePosition
    local buttonAbsSize = self.DropdownButton.AbsoluteSize
    
    local maxVisibleItems = 5
    local itemHeight = 28
    local dropdownHeight = math.min(#self.Options, maxVisibleItems) * itemHeight + 10
    
    self.DropdownFrame = Utility.Create("Frame", {
        Name = "DropdownList",
        BackgroundColor3 = theme:GetColor("Secondary"),
        Position = UDim2.new(0, buttonAbsPos.X, 0, buttonAbsPos.Y + buttonAbsSize.Y + 5),
        Size = UDim2.new(0, buttonAbsSize.X, 0, dropdownHeight),
        ZIndex = 1001,
        Parent = layerManager.OverlayContainer
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 6),
        Parent = self.DropdownFrame
    })
    
    Utility.Create("UIStroke", {
        Color = theme:GetColor("Border"),
        Thickness = 1,
        Parent = self.DropdownFrame
    })
    
    local scrollFrame = Utility.Create("ScrollingFrame", {
        Name = "ScrollFrame",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 5, 0, 5),
        Size = UDim2.new(1, -10, 1, -10),
        CanvasSize = UDim2.new(0, 0, 0, #self.Options * itemHeight),
        ScrollBarThickness = 3,
        ScrollBarImageColor3 = theme:GetColor("Accent"),
        ZIndex = 1002,
        Parent = self.DropdownFrame
    })
    
    Utility.Create("UIListLayout", {
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 2),
        Parent = scrollFrame
    })
    
    for i, option in ipairs(self.Options) do
        local isSelected = false
        if self.Multi then
            for _, v in ipairs(self.Value) do
                if v == option then
                    isSelected = true
                    break
                end
            end
        else
            isSelected = self.Value == option
        end
        
        local optionButton = Utility.Create("TextButton", {
            Name = "Option_" .. option,
            BackgroundColor3 = isSelected and theme:GetColor("Accent") or theme:GetColor("Tertiary"),
            BackgroundTransparency = isSelected and 0.5 or 1,
            Size = UDim2.new(1, 0, 0, itemHeight - 2),
            Font = Enum.Font.Gotham,
            Text = option,
            TextColor3 = isSelected and theme:GetColor("Text") or theme:GetColor("TextDark"),
            TextSize = 11,
            AutoButtonColor = false,
            LayoutOrder = i,
            ZIndex = 1003,
            Parent = scrollFrame
        })
        
        Utility.Create("UICorner", {
            CornerRadius = UDim.new(0, 4),
            Parent = optionButton
        })
        
        optionButton.MouseEnter:Connect(function()
            if not isSelected then
                Utility.Tween(optionButton, {BackgroundTransparency = 0.7}, 0.1)
            end
        end)
        
        optionButton.MouseLeave:Connect(function()
            if not isSelected then
                Utility.Tween(optionButton, {BackgroundTransparency = 1}, 0.1)
            end
        end)
        
        optionButton.MouseButton1Click:Connect(function()
            if self.Multi then
                local found = false
                for idx, v in ipairs(self.Value) do
                    if v == option then
                        table.remove(self.Value, idx)
                        found = true
                        break
                    end
                end
                if not found then
                    table.insert(self.Value, option)
                end
                self:UpdateVisual()
                self:CloseDropdown()
                self:OpenDropdown()
                
                if self.Callback then
                    task.spawn(self.Callback, self.Value)
                end
            else
                self:SetValue(option)
                self:CloseDropdown()
            end
        end)
    end
    
    Utility.Tween(self.Arrow, {Rotation = 180}, 0.2)
    
    self.OutsideClickConnection = UserInputService.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            local mousePos = UserInputService:GetMouseLocation()
            local dropdownPos = self.DropdownFrame.AbsolutePosition
            local dropdownSize = self.DropdownFrame.AbsoluteSize
            
            local buttonPos = self.DropdownButton.AbsolutePosition
            local buttonSize = self.DropdownButton.AbsoluteSize
            
            local inDropdown = mousePos.X >= dropdownPos.X and mousePos.X <= dropdownPos.X + dropdownSize.X and
                              mousePos.Y >= dropdownPos.Y and mousePos.Y <= dropdownPos.Y + dropdownSize.Y
            
            local inButton = mousePos.X >= buttonPos.X and mousePos.X <= buttonPos.X + buttonSize.X and
                            mousePos.Y >= buttonPos.Y and mousePos.Y <= buttonPos.Y + buttonSize.Y
            
            if not inDropdown and not inButton then
                self:CloseDropdown()
            end
        end
    end)
end

function Dropdown:CloseDropdown()
    self.Open = false
    
    if self.DropdownFrame then
        self.DropdownFrame:Destroy()
        self.DropdownFrame = nil
    end
    
    if self.OutsideClickConnection then
        self.OutsideClickConnection:Disconnect()
        self.OutsideClickConnection = nil
    end
    
    Utility.Tween(self.Arrow, {Rotation = 0}, 0.2)
    Utility.Tween(self.DropdownButton, {BackgroundColor3 = self.Library.ThemeManager:GetColor("Tertiary")}, 0.15)
end

function Dropdown:SetValue(value, fromConfig)
    if self.Multi then
        if type(value) == "table" then
            self.Value = value
        else
            local found = false
            for i, v in ipairs(self.Value) do
                if v == value then
                    table.remove(self.Value, i)
                    found = true
                    break
                end
            end
            if not found then
                table.insert(self.Value, value)
            end
        end
    else
        self.Value = value
    end
    
    self:UpdateVisual()
    
    if not fromConfig and self.Callback then
        task.spawn(self.Callback, self.Value)
    end
end

function Dropdown:GetValue()
    return self.Value
end

function Dropdown:UpdateVisual()
    local theme = self.Library.ThemeManager
    
    if self.Multi then
        if #self.Value == 0 then
            self.SelectedLabel.Text = "Select..."
            self.SelectedLabel.TextColor3 = theme:GetColor("TextDark")
        else
            self.SelectedLabel.Text = table.concat(self.Value, ", ")
            self.SelectedLabel.TextColor3 = theme:GetColor("Text")
        end
    else
        if self.Value then
            self.SelectedLabel.Text = tostring(self.Value)
            self.SelectedLabel.TextColor3 = theme:GetColor("Text")
        else
            self.SelectedLabel.Text = "Select..."
            self.SelectedLabel.TextColor3 = theme:GetColor("TextDark")
        end
    end
end

function Dropdown:SetOptions(options)
    self.Options = options
    if self.Open then
        self:CloseDropdown()
        self:OpenDropdown()
    end
end

function Dropdown:Destroy()
    self:CloseDropdown()
    
    for _, connection in ipairs(self.Connections) do
        connection:Disconnect()
    end
    
    if self.Flag then
        self.Library.ConfigManager:UnregisterElement(self.Flag)
    end
    
    self.Container:Destroy()
end

local ColorPicker = {}
ColorPicker.__index = ColorPicker

function ColorPicker.new(section, config)
    local self = setmetatable({}, ColorPicker)
    
    self.Section = section
    self.Library = section.Library
    self.Name = config.Name or "Color Picker"
    self.Default = config.Default or Color3.fromRGB(255, 255, 255)
    self.Value = self.Default
    self.Callback = config.Callback
    self.Flag = config.Flag
    self.LayoutOrder = #section.Elements + 1
    self.Connections = {}
    self.Open = false
    self.PickerFrame = nil
    
    self:CreateUI()
    self:SetValue(self.Default, true)
    
    if self.Flag then
        self.Library.ConfigManager:RegisterElement(self.Flag, self)
    end
    
    return self
end

function ColorPicker:CreateUI()
    local theme = self.Library.ThemeManager
    local window = self.Section.Window
    
    self.Container = Utility.Create("Frame", {
        Name = "ColorPicker_" .. self.Name,
        BackgroundColor3 = theme:GetColor("Primary"),
        Size = UDim2.new(1, 0, 0, 36),
        LayoutOrder = self.LayoutOrder,
        ZIndex = window.ZIndex + 6,
        Parent = self.Section.ElementContainer
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 6),
        Parent = self.Container
    })
    
    self.Label = Utility.Create("TextLabel", {
        Name = "Label",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 10, 0, 0),
        Size = UDim2.new(1, -60, 1, 0),
        Font = Enum.Font.GothamMedium,
        Text = self.Name,
        TextColor3 = theme:GetColor("Text"),
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Left,
        ZIndex = window.ZIndex + 8,
        Parent = self.Container
    })
    
    self.ColorButton = Utility.Create("TextButton", {
        Name = "ColorButton",
        BackgroundColor3 = self.Value,
        Position = UDim2.new(1, -50, 0.5, 0),
        Size = UDim2.new(0, 40, 0, 24),
        AnchorPoint = Vector2.new(0, 0.5),
        Text = "",
        AutoButtonColor = false,
        ZIndex = window.ZIndex + 7,
        Parent = self.Container
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 4),
        Parent = self.ColorButton
    })
    
    Utility.Create("UIStroke", {
        Color = theme:GetColor("Border"),
        Thickness = 1,
        Parent = self.ColorButton
    })
    
    self.ColorButton.MouseButton1Click:Connect(function()
        self:Toggle()
    end)
end

function ColorPicker:Toggle()
    self.Open = not self.Open
    
    if self.Open then
        self:OpenPicker()
    else
        self:ClosePicker()
    end
end

function ColorPicker:OpenPicker()
    local theme = self.Library.ThemeManager
    local layerManager = self.Library.LayerManager
    
    local buttonAbsPos = self.ColorButton.AbsolutePosition
    local buttonAbsSize = self.ColorButton.AbsoluteSize
    
    local pickerWidth = 220
    local pickerHeight = 260
    
    local screenSize = workspace.CurrentCamera.ViewportSize
    local xPos = buttonAbsPos.X + buttonAbsSize.X + 10
    local yPos = buttonAbsPos.Y
    
    if xPos + pickerWidth > screenSize.X then
        xPos = buttonAbsPos.X - pickerWidth - 10
    end
    
    if yPos + pickerHeight > screenSize.Y then
        yPos = screenSize.Y - pickerHeight - 10
    end
    
    self.PickerFrame = Utility.Create("Frame", {
        Name = "ColorPickerPanel",
        BackgroundColor3 = theme:GetColor("Secondary"),
        Position = UDim2.new(0, xPos, 0, yPos),
        Size = UDim2.new(0, pickerWidth, 0, pickerHeight),
        ZIndex = 1001,
        Parent = layerManager.OverlayContainer
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 8),
        Parent = self.PickerFrame
    })
    
    Utility.Create("UIStroke", {
        Color = theme:GetColor("Border"),
        Thickness = 1,
        Parent = self.PickerFrame
    })
    
    local h, s, v = Utility.RGBToHSV(self.Value)
    
    local satValPicker = Utility.Create("ImageButton", {
        Name = "SatValPicker",
        BackgroundColor3 = Color3.fromHSV(h, 1, 1),
        Position = UDim2.new(0, 10, 0, 10),
        Size = UDim2.new(1, -50, 0, 150),
        AutoButtonColor = false,
        ZIndex = 1002,
        Parent = self.PickerFrame
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 4),
        Parent = satValPicker
    })
    
    local satGradient = Utility.Create("UIGradient", {
        Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, Color3.new(1, 1, 1)),
            ColorSequenceKeypoint.new(1, Color3.new(1, 1, 1))
        }),
        Transparency = NumberSequence.new({
            NumberSequenceKeypoint.new(0, 0),
            NumberSequenceKeypoint.new(1, 1)
        }),
        Rotation = 0,
        Parent = satValPicker
    })
    
    local valOverlay = Utility.Create("Frame", {
        Name = "ValOverlay",
        BackgroundColor3 = Color3.new(0, 0, 0),
        BackgroundTransparency = 0,
        Size = UDim2.new(1, 0, 1, 0),
        ZIndex = 1003,
        Parent = satValPicker
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 4),
        Parent = valOverlay
    })
    
    local valGradient = Utility.Create("UIGradient", {
        Color = ColorSequence.new(Color3.new(0, 0, 0)),
        Transparency = NumberSequence.new({
            NumberSequenceKeypoint.new(0, 1),
            NumberSequenceKeypoint.new(1, 0)
        }),
        Rotation = 90,
        Parent = valOverlay
    })
    
    local satValCursor = Utility.Create("Frame", {
        Name = "Cursor",
        BackgroundColor3 = Color3.new(1, 1, 1),
        Position = UDim2.new(s, 0, 1 - v, 0),
        Size = UDim2.new(0, 10, 0, 10),
        AnchorPoint = Vector2.new(0.5, 0.5),
        ZIndex = 1004,
        Parent = satValPicker
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(1, 0),
        Parent = satValCursor
    })
    
    Utility.Create("UIStroke", {
        Color = Color3.new(0, 0, 0),
        Thickness = 2,
        Parent = satValCursor
    })
    
    local huePicker = Utility.Create("ImageButton", {
        Name = "HuePicker",
        BackgroundColor3 = Color3.new(1, 1, 1),
        Position = UDim2.new(1, -30, 0, 10),
        Size = UDim2.new(0, 20, 0, 150),
        AutoButtonColor = false,
        ZIndex = 1002,
        Parent = self.PickerFrame
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 4),
        Parent = huePicker
    })
    
    local hueGradient = Utility.Create("UIGradient", {
        Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, Color3.fromHSV(0, 1, 1)),
            ColorSequenceKeypoint.new(0.167, Color3.fromHSV(0.167, 1, 1)),
            ColorSequenceKeypoint.new(0.333, Color3.fromHSV(0.333, 1, 1)),
            ColorSequenceKeypoint.new(0.5, Color3.fromHSV(0.5, 1, 1)),
            ColorSequenceKeypoint.new(0.667, Color3.fromHSV(0.667, 1, 1)),
            ColorSequenceKeypoint.new(0.833, Color3.fromHSV(0.833, 1, 1)),
            ColorSequenceKeypoint.new(1, Color3.fromHSV(1, 1, 1))
        }),
        Rotation = 90,
        Parent = huePicker
    })
    
    local hueCursor = Utility.Create("Frame", {
        Name = "Cursor",
        BackgroundTransparency = 1,
        Position = UDim2.new(0.5, 0, h, 0),
        Size = UDim2.new(1, 4, 0, 4),
        AnchorPoint = Vector2.new(0.5, 0.5),
        ZIndex = 1003,
        Parent = huePicker
    })
    
    Utility.Create("UIStroke", {
        Color = Color3.new(1, 1, 1),
        Thickness = 2,
        Parent = hueCursor
    })
    
    local previewFrame = Utility.Create("Frame", {
        Name = "Preview",
        BackgroundColor3 = self.Value,
        Position = UDim2.new(0, 10, 0, 170),
        Size = UDim2.new(0, 40, 0, 40),
        ZIndex = 1002,
        Parent = self.PickerFrame
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 4),
        Parent = previewFrame
    })
    
    local hexInput = Utility.Create("TextBox", {
        Name = "HexInput",
        BackgroundColor3 = theme:GetColor("Tertiary"),
        Position = UDim2.new(0, 60, 0, 170),
        Size = UDim2.new(1, -70, 0, 30),
        Font = Enum.Font.GothamMedium,
        Text = Utility.ColorToHex(self.Value),
        TextColor3 = theme:GetColor("Text"),
        TextSize = 12,
        PlaceholderText = "#FFFFFF",
        ClearTextOnFocus = false,
        ZIndex = 1002,
        Parent = self.PickerFrame
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 4),
        Parent = hexInput
    })
    
    local rgbLabels = {"R", "G", "B"}
    local rgbInputs = {}
    
    for i, label in ipairs(rgbLabels) do
        local container = Utility.Create("Frame", {
            Name = label .. "Container",
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 10 + (i - 1) * 70, 0, 215),
            Size = UDim2.new(0, 60, 0, 35),
            ZIndex = 1002,
            Parent = self.PickerFrame
        })
        
        Utility.Create("TextLabel", {
            Name = "Label",
            BackgroundTransparency = 1,
            Size = UDim2.new(0, 15, 1, 0),
            Font = Enum.Font.GothamMedium,
            Text = label,
            TextColor3 = theme:GetColor("TextDark"),
            TextSize = 11,
            ZIndex = 1003,
            Parent = container
        })
        
        local input = Utility.Create("TextBox", {
            Name = label .. "Input",
            BackgroundColor3 = theme:GetColor("Tertiary"),
            Position = UDim2.new(0, 18, 0, 0),
            Size = UDim2.new(0, 42, 1, 0),
            Font = Enum.Font.Gotham,
            Text = tostring(math.floor(self.Value[label] * 255)),
            TextColor3 = theme:GetColor("Text"),
            TextSize = 11,
            ClearTextOnFocus = false,
            ZIndex = 1003,
            Parent = container
        })
        
        Utility.Create("UICorner", {
            CornerRadius = UDim.new(0, 4),
            Parent = input
        })
        
        rgbInputs[label] = input
    end
    
    local function updateColor()
        local newColor = Color3.fromHSV(h, s, v)
        self:SetValue(newColor)
        previewFrame.BackgroundColor3 = newColor
        hexInput.Text = Utility.ColorToHex(newColor)
        satValPicker.BackgroundColor3 = Color3.fromHSV(h, 1, 1)
        
        rgbInputs.R.Text = tostring(math.floor(newColor.R * 255))
        rgbInputs.G.Text = tostring(math.floor(newColor.G * 255))
        rgbInputs.B.Text = tostring(math.floor(newColor.B * 255))
    end
    
    local satValDragging = false
    local hueDragging = false
    
    satValPicker.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            satValDragging = true
            local relX = math.clamp((input.Position.X - satValPicker.AbsolutePosition.X) / satValPicker.AbsoluteSize.X, 0, 1)
            local relY = math.clamp((input.Position.Y - satValPicker.AbsolutePosition.Y) / satValPicker.AbsoluteSize.Y, 0, 1)
            s = relX
            v = 1 - relY
            satValCursor.Position = UDim2.new(s, 0, 1 - v, 0)
            updateColor()
        end
    end)
    
    satValPicker.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            satValDragging = false
        end
    end)
    
    huePicker.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            hueDragging = true
            local relY = math.clamp((input.Position.Y - huePicker.AbsolutePosition.Y) / huePicker.AbsoluteSize.Y, 0, 1)
            h = relY
            hueCursor.Position = UDim2.new(0.5, 0, h, 0)
            updateColor()
        end
    end)
    
    huePicker.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            hueDragging = false
        end
    end)
    
    self.PickerInputConnection = UserInputService.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            if satValDragging then
                local relX = math.clamp((input.Position.X - satValPicker.AbsolutePosition.X) / satValPicker.AbsoluteSize.X, 0, 1)
                local relY = math.clamp((input.Position.Y - satValPicker.AbsolutePosition.Y) / satValPicker.AbsoluteSize.Y, 0, 1)
                s = relX
                v = 1 - relY
                satValCursor.Position = UDim2.new(s, 0, 1 - v, 0)
                updateColor()
            elseif hueDragging then
                local relY = math.clamp((input.Position.Y - huePicker.AbsolutePosition.Y) / huePicker.AbsoluteSize.Y, 0, 1)
                h = relY
                hueCursor.Position = UDim2.new(0.5, 0, h, 0)
                updateColor()
            end
        end
    end)
    
    hexInput.FocusLost:Connect(function()
        local success, color = pcall(function()
            return Utility.HexToColor(hexInput.Text)
        end)
        if success then
            h, s, v = Utility.RGBToHSV(color)
            satValCursor.Position = UDim2.new(s, 0, 1 - v, 0)
            hueCursor.Position = UDim2.new(0.5, 0, h, 0)
            updateColor()
        else
            hexInput.Text = Utility.ColorToHex(self.Value)
        end
    end)
    
    for label, input in pairs(rgbInputs) do
        input.FocusLost:Connect(function()
            local value = tonumber(input.Text)
            if value then
                value = math.clamp(value, 0, 255)
                local r = tonumber(rgbInputs.R.Text) or 0
                local g = tonumber(rgbInputs.G.Text) or 0
                local b = tonumber(rgbInputs.B.Text) or 0
                local newColor = Color3.fromRGB(r, g, b)
                h, s, v = Utility.RGBToHSV(newColor)
                satValCursor.Position = UDim2.new(s, 0, 1 - v, 0)
                hueCursor.Position = UDim2.new(0.5, 0, h, 0)
                updateColor()
            else
                input.Text = tostring(math.floor(self.Value[label] * 255))
            end
        end)
    end
    
    self.OutsideClickConnection = UserInputService.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            local mousePos = UserInputService:GetMouseLocation()
            local pickerPos = self.PickerFrame.AbsolutePosition
            local pickerSize = self.PickerFrame.AbsoluteSize
            
            local buttonPos = self.ColorButton.AbsolutePosition
            local buttonSize = self.ColorButton.AbsoluteSize
            
            local inPicker = mousePos.X >= pickerPos.X and mousePos.X <= pickerPos.X + pickerSize.X and
                            mousePos.Y >= pickerPos.Y and mousePos.Y <= pickerPos.Y + pickerSize.Y
            
            local inButton = mousePos.X >= buttonPos.X and mousePos.X <= buttonPos.X + buttonSize.X and
                            mousePos.Y >= buttonPos.Y and mousePos.Y <= buttonPos.Y + buttonSize.Y
            
            if not inPicker and not inButton then
                self:ClosePicker()
            end
        end
    end)
end

function ColorPicker:ClosePicker()
    self.Open = false
    
    if self.PickerFrame then
        self.PickerFrame:Destroy()
        self.PickerFrame = nil
    end
    
    if self.OutsideClickConnection then
        self.OutsideClickConnection:Disconnect()
        self.OutsideClickConnection = nil
    end
    
    if self.PickerInputConnection then
        self.PickerInputConnection:Disconnect()
        self.PickerInputConnection = nil
    end
end

function ColorPicker:SetValue(value, fromConfig)
    self.Value = value
    self:UpdateVisual()
    
    if not fromConfig and self.Callback then
        task.spawn(self.Callback, self.Value)
    end
end

function ColorPicker:GetValue()
    return self.Value
end

function ColorPicker:UpdateVisual()
    self.ColorButton.BackgroundColor3 = self.Value
end

function ColorPicker:Destroy()
    self:ClosePicker()
    
    for _, connection in ipairs(self.Connections) do
        connection:Disconnect()
    end
    
    if self.Flag then
        self.Library.ConfigManager:UnregisterElement(self.Flag)
    end
    
    self.Container:Destroy()
end

local TextBox = {}
TextBox.__index = TextBox

function TextBox.new(section, config)
    local self = setmetatable({}, TextBox)
    
    self.Section = section
    self.Library = section.Library
    self.Name = config.Name or "TextBox"
    self.Placeholder = config.Placeholder or ""
    self.Default = config.Default or ""
    self.Value = self.Default
    self.Callback = config.Callback
    self.Flag = config.Flag
    self.LayoutOrder = #section.Elements + 1
    self.Connections = {}
    self.ClearOnFocus = config.ClearOnFocus or false
    
    self:CreateUI()
    self:SetValue(self.Default, true)
    
    if self.Flag then
        self.Library.ConfigManager:RegisterElement(self.Flag, self)
    end
    
    return self
end

function TextBox:CreateUI()
    local theme = self.Library.ThemeManager
    local window = self.Section.Window
    
    self.Container = Utility.Create("Frame", {
        Name = "TextBox_" .. self.Name,
        BackgroundColor3 = theme:GetColor("Primary"),
        Size = UDim2.new(1, 0, 0, 50),
        LayoutOrder = self.LayoutOrder,
        ZIndex = window.ZIndex + 6,
        Parent = self.Section.ElementContainer
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 6),
        Parent = self.Container
    })
    
    self.Label = Utility.Create("TextLabel", {
        Name = "Label",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 10, 0, 6),
        Size = UDim2.new(1, -20, 0, 14),
        Font = Enum.Font.GothamMedium,
        Text = self.Name,
        TextColor3 = theme:GetColor("Text"),
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Left,
        ZIndex = window.ZIndex + 8,
        Parent = self.Container
    })
    
    self.Input = Utility.Create("TextBox", {
        Name = "Input",
        BackgroundColor3 = theme:GetColor("Tertiary"),
        Position = UDim2.new(0, 10, 0, 24),
        Size = UDim2.new(1, -20, 0, 22),
        Font = Enum.Font.Gotham,
        Text = self.Value,
        TextColor3 = theme:GetColor("Text"),
        TextSize = 11,
        PlaceholderText = self.Placeholder,
        PlaceholderColor3 = theme:GetColor("TextDisabled"),
        ClearTextOnFocus = self.ClearOnFocus,
        ZIndex = window.ZIndex + 7,
        Parent = self.Container
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 4),
        Parent = self.Input
    })
    
    Utility.Create("UIPadding", {
        PaddingLeft = UDim.new(0, 8),
        PaddingRight = UDim.new(0, 8),
        Parent = self.Input
    })
    
    self.Input.FocusLost:Connect(function(enterPressed)
        self:SetValue(self.Input.Text)
    end)
    
    self.Input.Focused:Connect(function()
        Utility.Tween(self.Input, {BackgroundColor3 = theme:GetColor("Secondary")}, 0.15)
    end)
    
    self.Input:GetPropertyChangedSignal("Text"):Connect(function()
        if self.Input:IsFocused() then
            self.Value = self.Input.Text
        end
    end)
end

function TextBox:SetValue(value, fromConfig)
    self.Value = value
    self:UpdateVisual()
    
    if not fromConfig and self.Callback then
        task.spawn(self.Callback, self.Value)
    end
end

function TextBox:GetValue()
    return self.Value
end

function TextBox:UpdateVisual()
    self.Input.Text = self.Value
end

function TextBox:Destroy()
    for _, connection in ipairs(self.Connections) do
        connection:Disconnect()
    end
    
    if self.Flag then
        self.Library.ConfigManager:UnregisterElement(self.Flag)
    end
    
    self.Container:Destroy()
end

local Keybind = {}
Keybind.__index = Keybind

function Keybind.new(section, config)
    local self = setmetatable({}, Keybind)
    
    self.Section = section
    self.Library = section.Library
    self.Name = config.Name or "Keybind"
    self.Default = config.Default or Enum.KeyCode.Unknown
    self.Value = self.Default
    self.Callback = config.Callback
    self.OnPress = config.OnPress
    self.Flag = config.Flag
    self.LayoutOrder = #section.Elements + 1
    self.Connections = {}
    self.Listening = false
    self.Mode = config.Mode or "Toggle"
    self.Blacklist = config.Blacklist or {Enum.KeyCode.Unknown, Enum.KeyCode.W, Enum.KeyCode.A, Enum.KeyCode.S, Enum.KeyCode.D}
    
    self:CreateUI()
    self:SetValue(self.Default, true)
    self:SetupInputListener()
    
    if self.Flag then
        self.Library.ConfigManager:RegisterElement(self.Flag, self)
    end
    
    return self
end

function Keybind:CreateUI()
    local theme = self.Library.ThemeManager
    local window = self.Section.Window
    
    self.Container = Utility.Create("Frame", {
        Name = "Keybind_" .. self.Name,
        BackgroundColor3 = theme:GetColor("Primary"),
        Size = UDim2.new(1, 0, 0, 36),
        LayoutOrder = self.LayoutOrder,
        ZIndex = window.ZIndex + 6,
        Parent = self.Section.ElementContainer
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 6),
        Parent = self.Container
    })
    
    self.Label = Utility.Create("TextLabel", {
        Name = "Label",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 10, 0, 0),
        Size = UDim2.new(1, -90, 1, 0),
        Font = Enum.Font.GothamMedium,
        Text = self.Name,
        TextColor3 = theme:GetColor("Text"),
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Left,
        ZIndex = window.ZIndex + 8,
        Parent = self.Container
    })
    
    self.KeyButton = Utility.Create("TextButton", {
        Name = "KeyButton",
        BackgroundColor3 = theme:GetColor("Tertiary"),
        Position = UDim2.new(1, -80, 0.5, 0),
        Size = UDim2.new(0, 70, 0, 24),
        AnchorPoint = Vector2.new(0, 0.5),
        Font = Enum.Font.GothamMedium,
        Text = self:GetKeyName(),
        TextColor3 = theme:GetColor("Text"),
        TextSize = 11,
        AutoButtonColor = false,
        ZIndex = window.ZIndex + 7,
        Parent = self.Container
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 4),
        Parent = self.KeyButton
    })
    
    self.KeyButton.MouseButton1Click:Connect(function()
        self:StartListening()
    end)
    
    self.KeyButton.MouseEnter:Connect(function()
        Utility.Tween(self.KeyButton, {BackgroundColor3 = theme:GetColor("Secondary")}, 0.15)
    end)
    
    self.KeyButton.MouseLeave:Connect(function()
        if not self.Listening then
            Utility.Tween(self.KeyButton, {BackgroundColor3 = theme:GetColor("Tertiary")}, 0.15)
        end
    end)
end

function Keybind:GetKeyName()
    if self.Value == Enum.KeyCode.Unknown then
        return "None"
    end
    return self.Value.Name
end

function Keybind:StartListening()
    self.Listening = true
    local theme = self.Library.ThemeManager
    
    self.KeyButton.Text = "..."
    Utility.Tween(self.KeyButton, {BackgroundColor3 = theme:GetColor("Accent")}, 0.15)
end

function Keybind:StopListening(keyCode)
    self.Listening = false
    local theme = self.Library.ThemeManager
    
    if keyCode then
        self:SetValue(keyCode)
    end
    
    self.KeyButton.Text = self:GetKeyName()
    Utility.Tween(self.KeyButton, {BackgroundColor3 = theme:GetColor("Tertiary")}, 0.15)
end

function Keybind:SetupInputListener()
    table.insert(self.Connections, UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if gameProcessed then return end
        
        if self.Listening then
            if input.UserInputType == Enum.UserInputType.Keyboard then
                local isBlacklisted = false
                for _, key in ipairs(self.Blacklist) do
                    if input.KeyCode == key then
                        isBlacklisted = true
                        break
                    end
                end
                
                if input.KeyCode == Enum.KeyCode.Escape then
                    self:StopListening(Enum.KeyCode.Unknown)
                elseif not isBlacklisted then
                    self:StopListening(input.KeyCode)
                end
            elseif input.UserInputType == Enum.UserInputType.MouseButton1 then
                self:StopListening()
            end
        else
            if input.UserInputType == Enum.UserInputType.Keyboard and input.KeyCode == self.Value then
                if self.OnPress then
                    task.spawn(self.OnPress)
                end
            end
        end
    end))
end

function Keybind:SetValue(value, fromConfig)
    if typeof(value) == "EnumItem" then
        self.Value = value
    elseif type(value) == "string" then
        local success, keyCode = pcall(function()
            return Enum.KeyCode[value]
        end)
        if success then
            self.Value = keyCode
        end
    end
    
    self:UpdateVisual()
    
    if not fromConfig and self.Callback then
        task.spawn(self.Callback, self.Value)
    end
end

function Keybind:GetValue()
    return self.Value
end

function Keybind:UpdateVisual()
    self.KeyButton.Text = self:GetKeyName()
end

function Keybind:Destroy()
    for _, connection in ipairs(self.Connections) do
        connection:Disconnect()
    end
    
    if self.Flag then
        self.Library.ConfigManager:UnregisterElement(self.Flag)
    end
    
    self.Container:Destroy()
end

local Button = {}
Button.__index = Button

function Button.new(section, config)
    local self = setmetatable({}, Button)
    
    self.Section = section
    self.Library = section.Library
    self.Name = config.Name or "Button"
    self.Description = config.Description
    self.Callback = config.Callback
    self.LayoutOrder = #section.Elements + 1
    
    self:CreateUI()
    
    return self
end

function Button:CreateUI()
    local theme = self.Library.ThemeManager
    local window = self.Section.Window
    
    self.Container = Utility.Create("Frame", {
        Name = "Button_" .. self.Name,
        BackgroundColor3 = theme:GetColor("Primary"),
        Size = UDim2.new(1, 0, 0, self.Description and 50 or 36),
        LayoutOrder = self.LayoutOrder,
        ZIndex = window.ZIndex + 6,
        Parent = self.Section.ElementContainer
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 6),
        Parent = self.Container
    })
    
    self.Button = Utility.Create("TextButton", {
        Name = "Button",
        BackgroundColor3 = theme:GetColor("Accent"),
        Position = UDim2.new(0, 10, 0.5, 0),
        Size = UDim2.new(1, -20, 0, self.Description and 32 or 24),
        AnchorPoint = Vector2.new(0, 0.5),
        Font = Enum.Font.GothamMedium,
        Text = self.Name,
        TextColor3 = Color3.fromRGB(255, 255, 255),
        TextSize = 12,
        AutoButtonColor = false,
        ClipsDescendants = true,
        ZIndex = window.ZIndex + 7,
        Parent = self.Container
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 4),
        Parent = self.Button
    })
    
    if self.Description then
        self.DescriptionLabel = Utility.Create("TextLabel", {
            Name = "Description",
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 0, 1, 2),
            Size = UDim2.new(1, 0, 0, 14),
            Font = Enum.Font.Gotham,
            Text = self.Description,
            TextColor3 = theme:GetColor("TextDark"),
            TextSize = 10,
            ZIndex = window.ZIndex + 8,
            Parent = self.Button
        })
    end
    
    self.Button.MouseButton1Click:Connect(function()
        Utility.Ripple(self.Button, UserInputService:GetMouseLocation().X, UserInputService:GetMouseLocation().Y)
        
        if self.Callback then
            task.spawn(self.Callback)
        end
    end)
    
    self.Button.MouseEnter:Connect(function()
        Utility.Tween(self.Button, {BackgroundColor3 = theme:GetColor("AccentDark")}, 0.15)
    end)
    
    self.Button.MouseLeave:Connect(function()
        Utility.Tween(self.Button, {BackgroundColor3 = theme:GetColor("Accent")}, 0.15)
    end)
end

function Button:SetValue() end
function Button:GetValue() return nil end
function Button:UpdateVisual() end

function Button:Destroy()
    self.Container:Destroy()
end

local Label = {}
Label.__index = Label

function Label.new(section, config)
    local self = setmetatable({}, Label)
    
    self.Section = section
    self.Library = section.Library
    self.Text = config.Text or "Label"
    self.LayoutOrder = #section.Elements + 1
    
    self:CreateUI()
    
    return self
end

function Label:CreateUI()
    local theme = self.Library.ThemeManager
    local window = self.Section.Window
    
    self.Container = Utility.Create("Frame", {
        Name = "Label",
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 20),
        LayoutOrder = self.LayoutOrder,
        ZIndex = window.ZIndex + 6,
        Parent = self.Section.ElementContainer
    })
    
    self.Label = Utility.Create("TextLabel", {
        Name = "Text",
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        Font = Enum.Font.Gotham,
        Text = self.Text,
        TextColor3 = theme:GetColor("TextDark"),
        TextSize = 11,
        TextXAlignment = Enum.TextXAlignment.Left,
        ZIndex = window.ZIndex + 7,
        Parent = self.Container
    })
end

function Label:SetText(text)
    self.Text = text
    self.Label.Text = text
end

function Label:SetValue() end
function Label:GetValue() return nil end
function Label:UpdateVisual() end

function Label:Destroy()
    self.Container:Destroy()
end

function UILibrary.new(config)
    local self = setmetatable({}, UILibrary)
    
    config = config or {}
    self.Name = config.Name or "UI Library"
    self.Theme = config.Theme or "Dark"
    
    self.ScreenGui = Utility.Create("ScreenGui", {
        Name = self.Name,
        ResetOnSpawn = false,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
        Parent = PlayerGui
    })
    
    self.ThemeManager = ThemeManager.new()
    self.ThemeManager:SetTheme(self.Theme)
    
    self.LayerManager = LayerManager.new(self.ScreenGui)
    self.NotificationManager = NotificationManager.new(self.ScreenGui, self.ThemeManager)
    self.WindowManager = WindowManager.new()
    self.ConfigManager = ConfigManager.new(self)
    self.ActiveElementPanel = ActiveElementPanel.new(self.ScreenGui, self.ThemeManager)
    
    self.Windows = {}
    
    return self
end

function UILibrary:CreateWindow(config)
    local window = Window.new(self, config)
    table.insert(self.Windows, window)
    return window
end

function UILibrary:SetTheme(themeName)
    self.ThemeManager:SetTheme(themeName)
end

function UILibrary:Notify(title, message, notificationType, duration)
    return self.NotificationManager:Notify(title, message, notificationType, duration)
end

function UILibrary:SaveConfig(name)
    return self.ConfigManager:SaveConfig(name)
end

function UILibrary:LoadConfig(name)
    return self.ConfigManager:LoadConfig(name)
end

function UILibrary:DeleteConfig(name)
    return self.ConfigManager:DeleteConfig(name)
end

function UILibrary:GetConfigList()
    return self.ConfigManager:GetConfigList()
end

function UILibrary:Destroy()
    for _, window in ipairs(self.Windows) do
        window:Destroy()
    end
    
    self.ActiveElementPanel:Destroy()
    self.ScreenGui:Destroy()
end

local Library = UILibrary.new({
    Name = "Advanced Settings Panel",
    Theme = "Dark"
})

local MainWindow = Library:CreateWindow({
    Title = "Game Settings",
    Size = UDim2.new(0, 600, 0, 450),
    MinSize = Vector2.new(450, 350),
    MaxSize = Vector2.new(900, 700),
    Position = UDim2.new(0.5, 0, 0.5, 0)
})

local CombatTab = MainWindow:CreateTab("Combat", {Icon = "rbxassetid://3926305904"})

local AimbotSubTab = CombatTab:CreateSubTab("Aimbot")
local AimbotMain = AimbotSubTab:CreateSection("Main Settings")

AimbotMain:CreateToggle({
    Name = "Enable Aimbot",
    Description = "Automatically aim at enemies",
    Default = false,
    Flag = "AimbotEnabled",
    Callback = function(value)
        print("Aimbot:", value)
    end
})

AimbotMain:CreateSlider({
    Name = "FOV",
    Min = 10,
    Max = 500,
    Default = 100,
    Increment = 5,
    Suffix = "px",
    Flag = "AimbotFOV",
    Callback = function(value)
        print("FOV:", value)
    end
})

AimbotMain:CreateDropdown({
    Name = "Target Part",
    Options = {"Head", "Torso", "HumanoidRootPart", "Random"},
    Default = "Head",
    Flag = "AimbotTargetPart",
    Callback = function(value)
        print("Target Part:", value)
    end
})

AimbotMain:CreateSlider({
    Name = "Smoothness",
    Min = 0,
    Max = 1,
    Default = 0.5,
    Increment = 0.05,
    Flag = "AimbotSmoothness",
    Callback = function(value)
        print("Smoothness:", value)
    end
})

local AimbotAdvanced = AimbotSubTab:CreateSection("Advanced")

AimbotAdvanced:CreateToggle({
    Name = "Prediction",
    Description = "Predict enemy movement",
    Default = true,
    Flag = "AimbotPrediction",
    Callback = function(value)
        print("Prediction:", value)
    end
})

AimbotAdvanced:CreateToggle({
    Name = "Wall Check",
    Default = true,
    Flag = "AimbotWallCheck",
    Callback = function(value)
        print("Wall Check:", value)
    end
})

AimbotAdvanced:CreateKeybind({
    Name = "Aim Key",
    Default = Enum.KeyCode.E,
    Flag = "AimbotKey",
    Callback = function(key)
        print("Aim Key:", key.Name)
    end,
    OnPress = function()
        print("Aim key pressed!")
    end
})

local SilentAimSubTab = CombatTab:CreateSubTab("Silent Aim")
local SilentMain = SilentAimSubTab:CreateSection("Settings")

SilentMain:CreateToggle({
    Name = "Enable Silent Aim",
    Default = false,
    Flag = "SilentAimEnabled",
    Callback = function(value)
        print("Silent Aim:", value)
    end
})

SilentMain:CreateSlider({
    Name = "Hit Chance",
    Min = 0,
    Max = 100,
    Default = 75,
    Increment = 1,
    Suffix = "%",
    Flag = "SilentHitChance",
    Callback = function(value)
        print("Hit Chance:", value)
    end
})

local VisualsTab = MainWindow:CreateTab("Visuals", {Icon = "rbxassetid://3926305904"})

local ESPSubTab = VisualsTab:CreateSubTab("ESP")
local ESPMain = ESPSubTab:CreateSection("Player ESP")

ESPMain:CreateToggle({
    Name = "Enable ESP",
    Description = "Show players through walls",
    Default = false,
    Flag = "ESPEnabled",
    Callback = function(value)
        print("ESP:", value)
    end
})

ESPMain:CreateToggle({
    Name = "Show Boxes",
    Default = true,
    Flag = "ESPBoxes",
    Callback = function(value)
        print("Boxes:", value)
    end
})

ESPMain:CreateToggle({
    Name = "Show Names",
    Default = true,
    Flag = "ESPNames",
    Callback = function(value)
        print("Names:", value)
    end
})

ESPMain:CreateToggle({
    Name = "Show Health",
    Default = true,
    Flag = "ESPHealth",
    Callback = function(value)
        print("Health:", value)
    end
})

ESPMain:CreateToggle({
    Name = "Show Distance",
    Default = false,
    Flag = "ESPDistance",
    Callback = function(value)
        print("Distance:", value)
    end
})

ESPMain:CreateColorPicker({
    Name = "Box Color",
    Default = Color3.fromRGB(255, 0, 0),
    Flag = "ESPBoxColor",
    Callback = function(color)
        print("Box Color:", color)
    end
})

ESPMain:CreateColorPicker({
    Name = "Name Color",
    Default = Color3.fromRGB(255, 255, 255),
    Flag = "ESPNameColor",
    Callback = function(color)
        print("Name Color:", color)
    end
})

local ESPAdvanced = ESPSubTab:CreateSection("Advanced Options")

ESPAdvanced:CreateSlider({
    Name = "Max Distance",
    Min = 100,
    Max = 5000,
    Default = 1000,
    Increment = 100,
    Suffix = " studs",
    Flag = "ESPMaxDistance",
    Callback = function(value)
        print("Max Distance:", value)
    end
})

ESPAdvanced:CreateDropdown({
    Name = "Box Type",
    Options = {"2D", "3D", "Corner"},
    Default = "2D",
    Flag = "ESPBoxType",
    Callback = function(value)
        print("Box Type:", value)
    end
})

local ChamSubTab = VisualsTab:CreateSubTab("Chams")
local ChamMain = ChamSubTab:CreateSection("Settings")

ChamMain:CreateToggle({
    Name = "Enable Chams",
    Default = false,
    Flag = "ChamsEnabled",
    Callback = function(value)
        print("Chams:", value)
    end
})

ChamMain:CreateColorPicker({
    Name = "Visible Color",
    Default = Color3.fromRGB(0, 255, 0),
    Flag = "ChamsVisibleColor",
    Callback = function(color)
        print("Visible Color:", color)
    end
})

ChamMain:CreateColorPicker({
    Name = "Hidden Color",
    Default = Color3.fromRGB(255, 0, 0),
    Flag = "ChamsHiddenColor",
    Callback = function(color)
        print("Hidden Color:", color)
    end
})

ChamMain:CreateSlider({
    Name = "Transparency",
    Min = 0,
    Max = 1,
    Default = 0.5,
    Increment = 0.1,
    Flag = "ChamsTransparency",
    Callback = function(value)
        print("Transparency:", value)
    end
})

local MiscTab = MainWindow:CreateTab("Misc", {Icon = "rbxassetid://3926305904"})

local MovementSubTab = MiscTab:CreateSubTab("Movement")
local MovementMain = MovementSubTab:CreateSection("Speed & Flight")

MovementMain:CreateToggle({
    Name = "Speed Hack",
    Default = false,
    Flag = "SpeedEnabled",
    Callback = function(value)
        print("Speed:", value)
    end
})

MovementMain:CreateSlider({
    Name = "Walk Speed",
    Min = 16,
    Max = 200,
    Default = 16,
    Increment = 1,
    Flag = "WalkSpeed",
    Callback = function(value)
        print("Walk Speed:", value)
    end
})

MovementMain:CreateToggle({
    Name = "Fly",
    Default = false,
    Flag = "FlyEnabled",
    Callback = function(value)
        print("Fly:", value)
    end
})

MovementMain:CreateSlider({
    Name = "Fly Speed",
    Min = 10,
    Max = 500,
    Default = 50,
    Increment = 5,
    Flag = "FlySpeed",
    Callback = function(value)
        print("Fly Speed:", value)
    end
})

MovementMain:CreateKeybind({
    Name = "Fly Toggle Key",
    Default = Enum.KeyCode.F,
    Flag = "FlyKey",
    Callback = function(key)
        print("Fly Key:", key.Name)
    end
})

local TeleportSection = MovementSubTab:CreateSection("Teleport")

TeleportSection:CreateTextBox({
    Name = "Player Name",
    Placeholder = "Enter player name...",
    Flag = "TeleportPlayer",
    Callback = function(text)
        print("Player:", text)
    end
})

TeleportSection:CreateButton({
    Name = "Teleport to Player",
    Callback = function()
        print("Teleporting...")
        Library:Notify("Teleport", "Teleporting to player...", "Info", 2)
    end
})

local SettingsTab = MainWindow:CreateTab("Settings", {Icon = "rbxassetid://3926305904"})

local ConfigSubTab = SettingsTab:CreateSubTab("Configs")
local ConfigMain = ConfigSubTab:CreateSection("Configuration")

ConfigMain:CreateTextBox({
    Name = "Config Name",
    Placeholder = "my_config",
    Default = "default",
    Flag = "ConfigName",
    Callback = function(text)
        print("Config Name:", text)
    end
})

ConfigMain:CreateButton({
    Name = "Save Config",
    Description = "Save current settings to a config file",
    Callback = function()
        local configName = Library.ConfigManager.Elements["ConfigName"]
        if configName then
            Library:SaveConfig(configName:GetValue())
        end
    end
})

ConfigMain:CreateButton({
    Name = "Load Config",
    Description = "Load settings from a config file",
    Callback = function()
        local configName = Library.ConfigManager.Elements["ConfigName"]
        if configName then
            Library:LoadConfig(configName:GetValue())
        end
    end
})

ConfigMain:CreateButton({
    Name = "Delete Config",
    Description = "Delete a saved config file",
    Callback = function()
        local configName = Library.ConfigManager.Elements["ConfigName"]
        if configName then
            Library:DeleteConfig(configName:GetValue())
        end
    end
})

local configDropdown = ConfigMain:CreateDropdown({
    Name = "Saved Configs",
    Options = Library:GetConfigList(),
    Flag = "SelectedConfig",
    Callback = function(value)
        local configNameElement = Library.ConfigManager.Elements["ConfigName"]
        if configNameElement then
            configNameElement:SetValue(value)
        end
    end
})

Library.ConfigManager:SetConfigListCallback(function(configs)
    configDropdown:SetOptions(configs)
end)

local UISubTab = SettingsTab:CreateSubTab("UI Settings")
local UIMain = UISubTab:CreateSection("Appearance")

UIMain:CreateDropdown({
    Name = "Theme",
    Options = {"Dark", "Light"},
    Default = "Dark",
    Flag = "UITheme",
    Callback = function(value)
        Library:SetTheme(value)
    end
})

UIMain:CreateSlider({
    Name = "UI Scale",
    Min = 0.7,
    Max = 1.3,
    Default = 1,
    Increment = 0.1,
    Flag = "UIScale",
    Callback = function(value)
        MainWindow:SetUIScale(value)
    end
})

UIMain:CreateToggle({
    Name = "Show Active Panel",
    Default = true,
    Flag = "ShowActivePanel",
    Callback = function(value)
        Library.ActiveElementPanel:SetVisible(value)
    end
})

local InfoSection = UISubTab:CreateSection("Information")

InfoSection:CreateLabel({
    Text = "Version: 1.0.0"
})

InfoSection:CreateLabel({
    Text = "Made with UI Library"
})

InfoSection:CreateButton({
    Name = "Show Notification",
    Callback = function()
        Library:Notify("Test", "This is a test notification!", "Success", 3)
    end
})

InfoSection:CreateButton({
    Name = "Destroy UI",
    Description = "Close and destroy the UI library",
    Callback = function()
        Library:Destroy()
    end
})

Library:Notify("Welcome", "UI Library loaded successfully!", "Success", 5)
